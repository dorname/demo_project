Ext.define('Rs.ext.overrides.field.Text',{override:'Ext.field.Text',maskRe:new RegExp('[^\']'),stripCharsRe:new RegExp('[\']','gi')});Ext.define('Rs.ext.window.MessageAlert',{extend:'Ext.MessageBox',alias:'widget.msgalert',closable:!1,initialize:function(){this.callParent()},getErrorMsg:function(c){var b={},a;b.sql="select err_code,err_des_c,err_des_e from sys_err_info where err_code = '"+c+"'";Ext.Ajax.request({url:'/base/sql/excute',jsonData:b,async:!1,method:'POST',success:function(d,e){var b=Ext.decode(d.responseText);if(b.success){a=b.data[0]}else {Ext.Msg.alert("系统提示",b.mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}});return a},messageAlert:function(a,l,k){var b=this,i;if(Rs.LANG==="en"){i="ERR_DES_E"}else if(Rs.LANG==="zh"){i="ERR_DES_C"}else {i="ERR_DES_C"}if(!Ext.isEmpty(a.stateCode)){var j=b.getErrorMsg(a.stateCode);Ext.Object.each(j,function(c,b,d){if(i===c){a.message=b}})}if(Ext.isEmpty(a.title)){a.title="提示"}if(Ext.isEmpty(a.width)){a.width=this.minWidth}if(Ext.isEmpty(a.height)){a.height=this.minHeight}if(Ext.isEmpty(a.autoCloseDistance)){a.autoCloseDistance=500}if(Ext.isEmpty(a.isAutoCloseDistance)){a.isAutoCloseDistance=!1}if(!(Ext.isEmpty(a.closable))){b.closable=a.closable}if(Ext.isEmpty(a.modal)){a.modal=!0}if(Ext.isEmpty(a.time)){a.time=5}if(Ext.isEmpty(a.autoTimeClose)){a.autoTimeClose=!1}if(Ext.isString(a.title)){a.title={title:a.title,height:a.height,width:a.width,message:a.message,fn:l,modal:a.modal,scope:k,minWidth:this.minWidth,minHeight:this.minHeight}}if(a.autoTimeClose){var c={taskFlag:1,run:function(){c.taskFlag++;b.show(a.title);if(c.taskFlag>a.time){b.close()}},interval:1000,repeat:a.time};var g=new Ext.util.TaskRunner();g.start(c);var h=window.top,f=0,d=0,e=0;if(!Ext.isEmpty(h)){if(a.isAutoCloseDistance){h.onmousemove=function(h){if(h.movementX<0){d-=h.movementX}else {d+=h.movementX}if(h.movementY<0){e-=h.movementY}else {e+=h.movementY}f=d*d+e*e;if(d>=a.autoCloseDistance||e>=a.autoCloseDistance||f>=(a.autoCloseDistance*a.autoCloseDistance)){d=0;e=0;f=0;if(!Ext.isEmpty(c)){g.stop(c)}b.close()}}}}else {Ext.Msg.alert("无法捕获外层窗口异常","按光标移动距离自动关闭方法失效")}}else {b.on('focusleave',function(){if(!Ext.isEmpty(c)){g.stop(c)}b.close()});b.on('blur',function(){if(!Ext.isEmpty(c)){g.stop(c)}b.close()});var m=b.show(a.title);var h=window.top,f=0,d=0,e=0;if(!Ext.isEmpty(h)){if(a.isAutoCloseDistance){h.onmousemove=function(h){if(h.movementX<0){d-=h.movementX}else {d+=h.movementX}if(h.movementY<0){e-=h.movementY}else {e+=h.movementY}f=d*d+e*e;if(d>=a.autoCloseDistance||e>=a.autoCloseDistance||f>=(a.autoCloseDistance*a.autoCloseDistance)){d=0;e=0;f=0;if(!Ext.isEmpty(c)){g.stop(c)}b.close()}}}}else {Ext.Msg.alert("无法捕获外层窗口异常","按光标移动距离自动关闭方法失效")}}if(!Ext.isEmpty(b.getFocusEl())){b.getFocusEl().on({keydown:function(){if(!Ext.isEmpty(c)){g.stop(c)}b.close()}})}document.onclick=function(c){if(!Ext.Array.contains(c.srcElement.classList,"x-messagebox-body-el")&&!Ext.Array.contains(c.srcElement.classList,"x-innerhtml")&&!Ext.Array.contains(c.srcElement.classList,"x-text-el")&&!Ext.Array.contains(c.srcElement.classList,"x-messageboxtitle")&&!Ext.Array.contains(c.srcElement.classList,"x-toolbar-body-el")){b.fireEvent("focusleave")}};if(Ext.isEmpty(b.hasFocusLeave)){b.on('focusleave',function(){b.hasFocusLeave=!0;if(!Ext.isEmpty(c)){g.stop(c)}b.close()})}}},function(a){Ext.onInternalReady(function(){Rs.ext.window.MessageBox=Rs.Msg=new a()})});Ext.define('Rs.ext.util.Marker',{singleton:!0,alternateClassName:['Rs.Marker'],getErrorMsg:function(c){var b={},a={};b.sql="select err_code,err_des_c as ZH,err_des_e as EN from sys_err_info where err_code = '"+c+"'";Ext.Ajax.request({url:'/base/sql/excute',jsonData:b,async:!1,method:'POST',success:function(d,e){var b=Ext.decode(d.responseText);if(b.success){a=b.data[0]}else {Ext.Msg.alert("系统提示",b.mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}});return a},showMsg:function(e){var d=this,a,b=[],c=d.getWin();Ext.each(e,function(c){a=d.getErrorMsg(c);console.log(a);b.push({code:c,msg:a["ZH"]})});c.store.setData(b);c.show()},getWin:function(){var b=this,a=b.msgWindow;if(a){return a}var c=Ext.create('Ext.data.JsonStore',{fields:['code','msg']});a=Ext.create('Ext.Dialog',{height:200,layout:'fit',closable:!1,defaultFocus:'#itemId',maxWidth:300,listeners:{'focusleave':function(a){a.hide()},'hide':function(){Ext.defer(b.focusFirst,10,b)}},items:[{xtype:'grid',border:!1,header:!1,id:'itemId',store:c,columns:[{width:50,dataIndex:'code'},{flex:1,dataIndex:'msg'}]}]});a.store=c;console.log(a.store);b.msgWindow=a;return a},mark:function(b){var a=this,c={};a.records={},a.panelIds=[],a.markerEls={};if(!Ext.isArray(b)){b=[b]}Ext.each(b,function(g,j){var e,h=g.panelId,d=Ext.getCmp(h),f=g.errArr,i=g.errorMsg;Ext.each(i,function(a){c[a]=a});if(!d){return}a.panelIds.push(d);a.unmark(d);if(d.isXType('grid')){e=a.getMarkElsOfGrid(d,f)}else {e=a.getMarkElsOfCard(d,f)}a.markerEls[h]=e;d.invalidEls=e;a.records[h]=f;a.markStyle(e)});var d=Ext.Object.getKeys(c);if(Ext.isEmpty(d)){Ext.defer(a.focusFirst,10,a)}else {a.showMsg(d)}},focusFirst:function(){var b=this,c,a;Ext.each(b.panelIds,function(d){c=d.getId();a=b.markerEls[c];if(a.getCount()){b.focusOnEl(d,a.first());return !1}})},focusOnEl:function(a,b){var c=this;if(!Ext.isEmpty(b)){if(a.isXType('grid')){c.focusOfGrid(a,b)}else {c.focusOfCard(a,b)}}},focusOfGrid:function(a,h){var g=this,f=a.getStore(),b=g.records[a.id],e=f.getById(b[0].uuid),d=a.getColumnForField(b[0].checkField[0]),c=a.findPlugin("gridcellediting");c.startEdit(e,d)},focusOfCard:function(b,a){a.focus()},getMarkElsOfGrid:function(c,b){var a=new Ext.CompositeElementLite(null,!0);Ext.each(b,function(d){Ext.each(d.checkField,function(f){var e=d.index;var g=c.getColumnForField(f).getCells()[e].element;a.add(g)})});return a},getMarkElsOfCard:function(c,b){var a=new Ext.CompositeElementLite(null,!0);Ext.each(b,function(d){Ext.each(d.checkField,function(e){a.add(c.down('#'+e).inputElement)})});return a},markStyle:function(a){Ext.each(a.elements,function(b){b.style.background="#ffdfd7"})},unmark:function(a){var b=a.invalidEls;if(!Ext.isEmpty(b)){b.applyStyles({background:'none'})}a.invalidEls=null}});(function(){Ext.require(['Rs.ext.overrides.field.Text','Rs.ext.window.MessageAlert','Rs.ext.util.Marker']);var b=Ext.manifest,a=b.locale;Ext.Loader.loadScript({url:b.paths['Rs.ext']+'/../locale/'+a+'/rs-ext-locale-'+a+'.js'})}());Ext.define('Rs.ext.button.RsButton',{extend:'Ext.Button',alias:'widget.rsbutton',initialize:function(){var a=this;tempStyle={};tempStyle.background='linear-gradient(#e4f3ff 45%,#c3d9f3 50%,#c9dffa 90%,#d7ecff 95%)';tempStyle.borderColor='#aac8f1';a.style=Ext.Object.merge(tempStyle,a.style);a.addCls(Ext.baseCSSPrefix+'unselectable');a.callParent();if(a.menu){a.split=!0;a.setMenu(a.menu,!1,!0)}if(a.url){a.href=a.url}a.configuredWithPreventDefault=a.hasOwnProperty('preventDefault');if(a.href&&!a.configuredWithPreventDefault){a.preventDefault=!1}if(Ext.isString(a.toggleGroup)&&a.toggleGroup!==''){a.enableToggle=!0}if(a.html&&!a.text){a.text=a.html;delete a.html}}});Ext.define('Rs.ext.data.FrontCachedStore',{extend:'Ext.data.Store',alias:'store.frontcachedstore',configs:{gridPanelId:'',isCacheDataToFront:!1,paramsFormStrict:!0},paramsFormStrict:!0,paramKey:"params",isCacheDataToFront:!1,isDynamicStore:!0,forceChangeStore:!1,constructor:function(b){var a=this,d;if(b){if(b.buffered){return new Ext.data['BufferedStore'](b)}}a.callParent([b]);d=a.inlineData;if(d){delete a.inlineData;a.loadInlineData(d)}var c=a.getProxy();a.initCachedStore();a.cachedStore.on('load',function(a){var c=[];a.totalCount=a.queryStaticDataCondintion["noRelatedDataTotalCount"];if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===a.currentPage&&d["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){if(d["queryRecord"].phantom){a.totalCount=e["data"].length}else {a.totalCount=e["relatedDataTotalCount"]}}if(!Ext.isEmpty(a.getDynamicStore().removedRecord)){Ext.each(a.getDynamicStore().removedRecord,function(e,i,h){if(d["queryRecord"]===e){c.push(d)}})}});Ext.each(c,function(c){Ext.Array.remove(a.relationStaticDataArry,c)})}});a.cachedStore.on('add',function(c,e,d){if(d===0){c.totalCount=1}a.synchroData(c,c)});a.cachedStore.on('remove',function(c,d,e){a.synchroData(c,c)});a.cachedStore.onAfter('remove',function(g,d,f,e){var c=Ext.getCmp(a.gridPanelId);if(!Ext.Object.isEmpty(c.relationGridStoreSet)){Ext.Object.eachValue(c.relationGridStoreSet,function(a){a.removedRecord=d})}});a.on('beforeload',function(g){var f={},d,e;d=c.getConfig("extraParams");if(!Ext.isEmpty(d)){if(!Ext.isEmpty(d[a.paramKey])){if(!Ext.isEmpty(a.queryConditionField)&&!Ext.isString(d[a.paramKey])){e=Ext.Object.merge(d,a.queryConditionField)}else if(!Ext.isEmpty(a.queryConditionField)&&Ext.isString(d[a.paramKey])){e=Ext.Object.merge(Ext.decode(d[a.paramKey]),a.queryConditionField)}else {if(Ext.isString(d[a.paramKey])){e=Ext.decode(d[a.paramKey])}else {e=d[a.paramKey]}}}else {if(!Ext.isEmpty(a.queryConditionField)){e=Ext.Object.merge(d,a.queryConditionField)}else {e=d}}if(a.paramsFormStrict&&!Ext.Object.isEmpty(e)){f[a.paramKey]=Ext.encode(e)}else {f=e}}if(c.type!=="memory"){c.setConfig("extraParams",f)}});a.on('clear',function(c){a.cachedDataAllClear()});a.on('add',function(e,c,d){a.synchroData(a.getCachedStore(),a)});a.on('remove',function(e,c,d){a.synchroData(a.getCachedStore(),a)});a.onAfter('remove',function(d,c,f,e){var a=Ext.getCmp(d.gridPanelId);if(!Ext.Object.isEmpty(a.relationGridStoreSet)){Ext.Object.eachValue(a.relationGridStoreSet,function(a){a.removedRecord=c})}});a.on('load',function(c){var e=c.getCachedStore().getRelationStaticDataArry(),d=[];if(!Ext.isEmpty(e)&&!Ext.isEmpty(c.removedRecord)){Ext.each(e,function(a,g,f){var e=a.cachedPageData;Ext.each(c.removedRecord,function(e,i,h){if(a["queryRecord"]===e){d.push(a)}})});Ext.each(d,function(a){Ext.Array.remove(c.relationStaticDataArry,a)})}a.synchroData(a.getCachedStore(),a)})},loadPage:function(c,b){var a=this,e=a.getPageSize(),d=Ext.getCmp(a.gridPanelId);a.currentPage=c;if(Ext.isEmpty(b)){b={newRecord:!1}}if((b.newRecord&&(!a.isHaveCachData(c)))||(a.isHaveCachData(c)&&a.isCacheDataToFront&&(!a.forceChangeStore))){d.setStore(a.cachedStore);a.cachedStore.loadPage(c,b)}else {d.setStore(a);b=Ext.apply({page:c,start:(c-1)*e,limit:e,addRecords:!a.getClearOnPageLoad()},b);a.read(b);a.forceChangeStore=!1}},cachedLoadPage:function(b,c){var a=this,f=a.getPageSize(),g=Ext.getCmp(a.dynamicStore.gridPanelId),d=[],e;if(Ext.isEmpty(c)){c={newRecord:!1}}if((c.newRecord&&(!a.isHaveCachData(b)))||(a.isHaveCachData(b)&&a.isCacheDataToFront&&(!a.forceChangeStore))){a.removeAll();if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(e){var f=e.cachedPageData;if(e["currentPage"]===b&&e["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){d=f.data}})}else {if(!Ext.Object.isEmpty(a.noRelationStaticDataObj)){d=a.noRelationStaticDataObj[b]}}if(d.length===0){e=!0}else {e=!1}a.currentPage=b;a.setData(d);c=Ext.apply({page:b,start:(b-1)*f,limit:f,addRecords:!0,canRemoved:e},c);a.read(c)}else {a.forceChangeStore=!1;g.setStore(a.dynamicStore);a.dynamicStore.loadPage(b,c)}},isHaveCachData:function(c){var a=this,b=!1;if(a.isDynamicStore){if(!Ext.isEmpty(a.cachedStore.relationStaticDataArry)){Ext.each(a.cachedStore.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===c&&d["queryRecord"]===a.cachedStore.queryStaticDataCondintion["queryRecord"]){b=!0}})}if(!Ext.isEmpty(a.cachedStore.noRelationStaticDataObj[c])){b=!0}}if(a.isCachedStore){if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===c&&d["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){b=!0}})}if(!Ext.isEmpty(a.noRelationStaticDataObj)){if(!Ext.isEmpty(a.noRelationStaticDataObj[c])){b=!0}}}return b},initCachedStore:function(){var a=this,b=Ext.create('Ext.data.Store',{id:a.id+"Cached",dynamicStore:a,isCachedStore:!0,pageSize:a.getPageSize(),noRelationStaticDataObj:{},relationStaticDataArry:[],isCacheDataToFront:a.isCacheDataToFront,model:a.getModel(),queryStaticDataCondintion:{},proxy:{type:'memory',enablePaging:!0,reader:{type:'json'}},loadPage:a.cachedLoadPage,isHaveCachData:a.isHaveCachData,getCachedStore:a.getCachedStore,getDynamicStore:a.getDynamicStore,getRelationStaticDataArry:function(){return a.getCachedStore().relationStaticDataArry},getNoRelationStaticDataObj:function(){return a.getCachedStore().noRelationStaticDataObj}});a.cachedStore=b},getCachedStore:function(){var a=this;if(a.isDynamicStore){return a.cachedStore}return a},getDynamicStore:function(){var a=this;if(a.isCachedStore){return a.dynamicStore}return a},cachedDataAllClear:function(){var a=this;if(!Ext.isEmpty(a.getCachedStore().getRelationStaticDataArry())){a.getCachedStore().getRelationStaticDataArry().length=0}if(!Ext.isEmpty(a.getCachedStore().getNoRelationStaticDataObj())){Ext.Object.clear(a.getCachedStore().getNoRelationStaticDataObj())}},synchroData:function(a,b){var d=!0;a.queryStaticDataCondintion["noRelatedDataTotalCount"]=b.totalCount;if(b.totalCount===0){a.queryStaticDataCondintion["noRelatedDataTotalCount"]=1;b.totalCount=1}a.queryStaticDataCondintion["currentPage"]=b.currentPage;if(!Ext.isEmpty(a.queryStaticDataCondintion["queryRecord"])){var e={relatedDataTotalCount:a.queryStaticDataCondintion["noRelatedDataTotalCount"],data:b.getRange()},c={currentPage:a.queryStaticDataCondintion["currentPage"],queryRecord:a.queryStaticDataCondintion["queryRecord"],cachedPageData:e};if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(e,f){if(e["currentPage"]===c["currentPage"]&&e["queryRecord"]===c["queryRecord"]){d=!1;Ext.Array.replace(a.relationStaticDataArry,f,1,[c])}});if(d){a.relationStaticDataArry.push(c)}}else {a.relationStaticDataArry.push(c)}}else {a.noRelationStaticDataObj[b.currentPage]=b.getRange()}}});Ext.define('Rs.ext.field.plugin.ControlStatusPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.controlstatus',requires:'Ext.field.Field',configs:{panelId:'',controlObj:'',errorCode:'',tipType:''},init:function(){var b=this;var d=b.getCmp();var a=b.config.controlObj;if(a){for(var c=0;c<a.length;c++){(function(){var e=a[c];var g=/\[(.*?)\]/gi;var d=e.match(g);if(d&&d.length==1){var f=d[0].replace(g,"$1");Ext.getCmp(f).on('blur',function(a){var c=e.replace(d[0],a.getValue());b.formFieldsControlStatus(c,f,a.getValue())})}})()}}},formFieldsControlStatus:function(a,b,e){if(!e){return !1}var c={};var d=a.toUpperCase().indexOf('FROM');a=a.slice(0,d)+' AS COUNT '+a.slice(d);c.sql=a;Ext.Ajax.request({url:'/base/sql/excute',jsonData:c,async:!1,method:'POST',success:function(f,h){var d=[];var c=Ext.decode(f.responseText);if(c.success){d=c.data}else {console.log("系统提示",c.mesg)}if(d.length<1){Ext.getCmp(b).setValue()}else {var g=d[0]['COUNT'];if(g<1){Ext.getCmp(b).setValue()}}},failure:function(c,d){Ext.getCmp(b).setValue();console.log("系统提示","服务器未连接")}})}});Ext.define('Rs.ext.form.PagePanel',{extend:'Ext.form.Panel',alias:'widget.Pageform',alternateClassName:['Ext.PageFormPanel','Ext.form.PageFormPanel'],configs:{store:'',insertFlag:!1},layout:'auto',bodyAriaRole:'form',initialize:function(){var a=this;if(Ext.isEmpty(a.insertFlag)){a.insertFlag=!1}this.callParent();this.element.on('submit','onSubmit',this);if(a.store){var b=Ext.getStore(a.store);var c=b.model;var d=Ext.create('Ext.field.Text',{name:c.idProperty,hidden:!0});b.on('load',function(d,b,c){if(!Ext.isEmpty(b)&&b.length>0){a.page=0;a.loadRecord(b[0])}else {if(a.insertFlag){a.addNewRecord()}}});a.startPolling(500)}},startPolling:function(a){this.stopPolling();this.pollTask=Ext.util.TaskManager.start({interval:a,run:this.checkChange,scope:this})},stopPolling:function(){var a=this.pollTask;if(a){Ext.util.TaskManager.stop(a,!0);this.pollTask=null}},loadRecord:function(a){this._record=a;return this.setValues(a.getData())},getRecord:function(){return this._record},updateRecord:function(a){a=a||this._record;if(!a){return this}var d=a.self.fields,e=this.getValues(),f={},c=0,g=d.length,b;for(;c<g;++c){b=d[c].name;if(e.hasOwnProperty(b)){f[b]=e[b]}}a.beginEdit();a.set(f);a.endEdit();return this},checkChange:function(){var b=this._record,c;if(this.isDirty()){var a=this._record;if(Ext.isEmpty(a)){if(this.insertFlag){this.addNewRecord()}else {return !1}}this.updateRecord(this._record)}else {var a=this._record;if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.crudState)&&!Ext.isEmpty(a.modified)){if(a.crudState==='U'){this.updateRecord(this._record)}else if(a.crudState==='C'){this.updateRecord(this._record)}}}},getStore:function(){return Ext.getStore(this.store)},revertModified:function(a){var b=Object.keys(a.modified);Ext.each(b,function(b){a.set(b,a.modified[b])})},addNewRecord:function(){var a=Ext.getStore(this.store),d=a.model,b=Ext.create(d,{}),c=this.items.items;if(this.page!=undefined){this.page+=1}else {this.page=0}a.insert(this.page,b);if(a.data.length>1){Ext.each(c,function(a){a.setValue()})}this.loadRecord(b)}});Ext.define('Rs.ext.form.field.DateInputField',{extend:'Ext.field.Text',alias:'widget.dateinputfield',configs:{format:""},regex:undefined,format:'Y/m/d',maxLength:10,initialize:function(){var c=this,d=new RegExp("Y(.|\n)*m(.|\n)*d"),e=new RegExp("d(.|\n)*m(.|\n)*Y"),f=new RegExp("m(.|\n)*d(.|\n)*Y"),b,a;c.callParent();c.on('afterrender',function(g){a="^(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})"+"(((0[13578]|1[02])(0[1-9]|[12][0-9]|3[01]))"+"|((0[469]|11)(0[1-9]|[12][0-9]|30))"+"|(02(0[1-9]|[1][0-9]|2[0-8]))))$"+"|^((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))0229)$";if(d.test(g.format)){b=new RegExp("(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})(.|\n)"+"(((0[13578]|1[02])(.|\n)(0[1-9]|[12][0-9]|3[01]))"+"|((0[469]|11)(.|\n)(0[1-9]|[12][0-9]|30))|(02(.|\n)(0[1-9]|[1][0-9]|2[0-8]))))"+"|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))(.|\n)02(.|\n)29)"+"|("+a+")")}if(e.test(g.format)){b=new RegExp("((((0[1-9]|[12][0-9]|3[01])(.|\n)(0[13578]|1[02]))"+"|((0[1-9]|[12][0-9]|30)(.|\n)(0[469]|11))"+"|((0[1-9]|[1][0-9]|2[0-8])(.|\n)02))(.|\n)([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3}))"+"|((29(.|\n)02)(.|\n)(((0[48]|[2468][048]|[3579][26])00)|(([0-9]{2})(0[48]|[2468][048]|[13579][26]))))"+"|("+a+")")}if(f.test(g.format)){b=new RegExp("(((0[13578]|1[02])(.|\n)(0[1-9]|[12][0-9]|3[01])"+"|(0[469]|11)(.|\n)(0[1-9]|[12][0-9]|30)"+"|02(.|\n)(0[1-9]|[1][0-9]|2[0-8]))(.|\n)([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3}))"+"|((02(.|\n)29)(.|\n)(((0[48]|[2468][048]|[3579][26])00)$|(([0-9]{2})(0[48]|[2468][048]|[13579][26]))))"+"|("+a+")")}c.regex=new RegExp(b)});c.on('blur',function(b){var e,c,f,g,h,a=b.getValue();if(Ext.isNumeric(a)){if(a.length<8||a.length>8){d=d&&!1}else {e=a.slice(0,4);c=a.slice(4,6);f=a.slice(6,8);var d=b.isLegalDate(e,c,f);if(d){g=c+"/"+f+"/"+e;h=Ext.Date.format(new Date(g),b.format);b.setValue(h)}}}else {if(Ext.Date.parse(a,'Y/m/d')){b.setValue(Ext.Date.format(new Date(a),b.format))}}})},isLegalDate:function(d,a,c){var b=!0;if(a-"12">0||a-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}if(a==="01"||a==="03"||a==="05"||a==="07"||a==="08"||a==="10"||a==="12"){if(c-"31">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}if(a==="04"||a==="06"||a==="09"||a==="11"){if(c-"30">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}if((d%4===0&&d%100===0)||d%400===0){if(a==="02"){if(c-"29">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}}else {if(a==="02"){if(c-"28">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}}return b}});Ext.define('Rs.ext.form.field.RsCheckBox',{extend:'Ext.field.Checkbox',alias:'widget.rscheckbox',checkedRe:/^(true|1|on|Y)/i,updateChecked:function(b,d){var a=this,c;if(!a.$onChange){a.inputElement.dom.checked=b}b=b=='Y'?!0:!1;a.toggleCls(a.checkedCls,b);b=b==!0?'Y':'N';if(a.initialized){c=b?'check':'uncheck';a.fireEvent(c,a);a.fireEvent('change',a,b,d)}a.setDirty(a.isDirty())},applyChecked:function(a){var b=this;if(this.isConfiguring){this.originalState=a}return !!this.checkedRe.test(String(a))?'Y':'N'}});Ext.define('Rs.ext.form.field.TimeInputField',{extend:'Ext.field.Text',alias:'widget.timeinputfield',configs:{format:"",strictFormat:undefined},strictFormat:!0,regex:undefined,format:'H:i',initialize:function(){var a=this,d=new RegExp("H(.|\n)i"),c,b;b=a.format[1];a.callParent();a.on('afterrender',function(e){if(d.test(e.format)){c="(^[0-9]$)"+"|^(([0-1][0-9])|(2[0-3]))$"+"|^(([0-1][0-9]|2[0-3])([0-5][0-9]))$"+"|^(([0-1][0-9]|2[0-3])([^\\w]|("+b+")|[_])([0-5][0-9]))$"+"|^(([0-9])([^\\w]|("+b+")|[_])([0-5][0-9]))$"}a.regex=new RegExp(c)});a.on('blur',function(f){var e,d,b,c;b;oldValue=f.getValue();if(Ext.isNumeric(oldValue)){if(oldValue.length===1){e="0"+oldValue;d="00";b=e+":"+d}if(oldValue.length===2){e=oldValue;d="00";b=e+":"+d}if(oldValue.length===4){e=oldValue.slice(0,2);d=oldValue.slice(2,4);b=e+":"+d}b="1995/10/09 "+b;c=Ext.Date.format(new Date(b),f.format);if(c.slice(0,1)==="0"){if(!a.strictFormat){c=c.slice(1,5)}}f.setValue(c)}else {b="1995/10/09 "+oldValue;if(Ext.Date.parse(b,'Y/m/d H:i')){c=Ext.Date.format(new Date(b),f.format);if(c.slice(0,1)==="0"){if(!a.strictFormat){c=c.slice(1,5)}f.setValue(c)}}}})}});Ext.define("Rs.ext.grid.RelationGridPanel",{extend:"Ext.grid.Grid",xtype:"relation-grid",isRelationGrid:!0,configs:{relationGridPanelId:"",relationGridQueryFieldArray:[],relationGridPanelAutoLoad:!0,moreRelationGridObj:{},clickAutoLoadRelationGridPanel:!0,isAddWhileNoRecords:!0},relationGridPanelId:"",relationGridQueryFieldArray:[],relationGridStoreSet:{},relationGridPanelAutoLoad:!0,moreRelationGridObj:{},clickAutoLoadRelationGridPanel:!0,isAddWhileNoRecords:!0,initialize:function(){var a=this;a.callParent();a.on('painted',function(a,g){var c=a.getStore(),d=c.getCachedStore(),e=a.getColumns(),b;Ext.each(e,function(c,e,d){if(c.xtype==="rsactioncolumn"){b=c}if(c.xtype==="rs-action-column-restricted"){b=c;a.actionColumn=b}});c.on('load',function(e,f,c,d,h){console.log(c,d,"<-------------",a.id);a.synchroAddDefaultValue(a,b,e,e,c,d,a.isAddWhileNoRecords)});d.on('load',function(c,f,d,e,h){a.synchroAddDefaultValue(a,b,c.getDynamicStore(),c,d,e,a.isAddWhileNoRecords)});if(!Ext.isEmpty(a.relationGridPanelId)){var f=a.getRelationObj(a.relationGridPanelId,a.relationGridQueryFieldArray);a.relationGridHandler(a,c,f);if(!Ext.Object.isEmpty(a.moreRelationGridObj)){Ext.Object.eachValue(a.moreRelationGridObj,function(b){var d=a.getRelationObj(b.relationGridPanelId,b.relationGridQueryFieldArray);a.relationGridHandler(a,c,d)})}}})},getRelationObj:function(b,d){var c=Ext.getCmp(b),a=c.getStore().getDynamicStore(),e=a.getCachedStore(),f={relationGridPanel:c,relationGridPanelId:b,relationGridQueryFieldArray:d,cachedStore:e,relationGridStore:a};a.queryConditionField={};return f},queryConditionHasNull:function(b){var a=!1;Ext.Object.each(b,function(e,d,c){if(d==="null"){c[e]="";a=!0}});return a},isArrayItemObj:function(a){if(a.length!==0){if(Ext.isObject(a[0])){return !0}}else {return !1}},isArrayHaveField:function(a,c){var b=!1;if(a.length!==0){if(Ext.isObject(a[0])){Ext.each(a,function(d,f,e){if(d["upField"]===c){b=!0}})}else {if(Ext.Array.contains(a,c)){b=!0}}}return b},synchroAddDefaultValue:function(l,b,a,c,g,m,f){var d={},p;if(!Ext.isEmpty(b)){if(!Ext.isEmpty(a.queryConditionField)){delete a.queryConditionField.id;l.queryConditionHasNull(a.queryConditionField);var e={},h,h=Ext.Object.merge(e,a.queryConditionField);b.queryAddValue=h;d=b.addDefaultValue}else {var e={};b.queryAddValue=e;d=b.addDefaultValue}}if(Ext.isEmpty(c.getRange())||((!g)&&g!==undefined)&&(m.canRemoved||c.isDynamicStore)){c.removeAll();if(!Ext.isEmpty(a.queryConditionField)){l.queryConditionHasNull(a.queryConditionField);var o={},k,i;k=Ext.Object.merge(o,a.queryConditionField);i=Ext.Object.merge(k,d);if(f){c.add(i)}}else {var n={},j;j=Ext.Object.merge(n,d);if(f){c.add(j)}}}},relationGridHandler:function(a,b,c){a.clickLoadRelationGrid(a,c);b.on('load',function(e,f,g,h){var d=e.getRange();if(a.relationGridPanelAutoLoad&&!Ext.isEmpty(d)){a.autoLoadRelationPanel(a,c,d[0])}if(Ext.isEmpty(d)){c.relationGridPanel.getStore().removeAll()}});b.fireEvent("load",b,b.getRange(),!0,{success:!0});b.getCachedStore().on('load',function(f,g,h,e){var d=f.getRange();if(a.relationGridPanelAutoLoad){if(Ext.isEmpty(e.isLoadRelationGridPanel)&&!Ext.isEmpty(d)){a.autoLoadRelationPanel(a,c,d[0])}if(Ext.isEmpty(d)){c.relationGridPanel.getStore().removeAll()}}});b.on('update',function(i,f,e,d,g,h){if(!Ext.isEmpty(d)){a.syncWhenDataUpdate(a,c,f,e,d)}});b.getCachedStore().on('update',function(i,f,e,d,g,h){if(!Ext.isEmpty(d)){a.syncWhenDataUpdate(a,c,f,e,d)}})},syncWhenDataUpdate:function(h,a,g,j,i){var b=i[0],d=[],f,e;if(h.isArrayHaveField(a.relationGridQueryFieldArray,b)&&!Ext.isEmpty(b)){if(!Ext.isEmpty(a.cachedStore.getRelationStaticDataArry())){Ext.each(a.cachedStore.getRelationStaticDataArry(),function(b){var c=b.cachedPageData;if(b["currentPage"]===a.cachedStore.currentPage&&b["queryRecord"]===g){f=c.data}});var c;if(h.isArrayItemObj(a.relationGridQueryFieldArray)){Ext.each(a.relationGridQueryFieldArray,function(d,f,e){if(b===d["upField"]){c=d["downField"]}})}else {c=b}Ext.each(f,function(d){d.data[c]=g.data[b]})}a.relationGridPanel.getStore().loadPage(a.relationGridPanel.getStore().currentPage);e=a.relationGridPanel.getStore().getRange()[0];d.push(c);a.relationGridPanel.getStore().fireEvent('update',a.relationGridPanel.getStore(),e,j,d)}},clickLoadRelationGrid:function(b,a){b.on('childtap',function(c,d){if(c.clickAutoLoadRelationGridPanel){c.autoLoadRelationPanel(c,a,d.record)}});b.relationGridStoreSet[a.relationGridStore.id]=a.relationGridStore},autoLoadRelationPanel:function(c,a,b,e,d){Ext.each(a.relationGridQueryFieldArray,function(f,h,g){if(Ext.isObject(f)){if(!Ext.isEmpty(b.data[f.upField])){a.relationGridStore.queryConditionField[f.downField]=b.data[f.upField]}else {a.relationGridStore.queryConditionField[f.downField]="null"}}else {if(!Ext.isEmpty(b.data[f])){a.relationGridStore.queryConditionField[f]=b.data[f]}else {a.relationGridStore.queryConditionField[f]="null"}}});a.cachedStore.queryStaticDataCondintion["queryRecord"]=b;a.relationGridStore.loadPage(1,{newRecord:b.phantom,callback:function(){}})}});Ext.define('Rs.ext.grid.column.RsAction',{extend:'Ext.grid.column.Column',alias:'widget.rsactioncolumn',configs:{addAltText:"",addIcon:"",addDisabled:undefined,addHidden:undefined,addToolTip:"",addDefaultValue:{},addHandler:function(e,c,b,f,h,d,g,a){},deleteAltText:"",deleteIcon:"",deleteDisabled:undefined,deleteHidden:undefined,deleteToolTip:"",deleteHandler:function(d,b,a,e,g,c,f){}},text:'操作',addDefaultValue:{},items:[{},{},{}],initMenu:function(){var a=this;var b=Ext.create('Ext.menu.Menu',Ext.apply({},{width:32,minWidth:0,plain:!0,floating:!0,hidden:!0,renderTo:Ext.getBody()}));a.Menu=b;Ext.each(a.items,function(b,c){if(c>=4){if(!Ext.isEmpty(b)){b.index=c;a.Menu.add(b);if(Ext.isEmpty(b.fn)){b.fn=b.handler}}a.Menu.on('hide',function(){b.hidden=!0})}})},initialize:function(){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}},cell:{tools:{approve:{iconCls:'addAction-button-item',handler:function(g,a){var d=a.column;var f=a.cell.row._recordIndex;var e,h,i,b,c;b=a.record;c=a.cell.row;d.addHandler(g,f,e,h,i,b,c,d.addDefaultValue)}},decline:{iconCls:'deleteAction1-button-item',handler:function(g,a){var d=a.column;var f=a.cell.row._recordIndex;var e,h,i,b,c;b=a.record;c=a.cell.row;d.deleteHandler(g,f,e,h,i,b,c,d.addDefaultValue)},weight:1}}},addHandler:function(f,c,h,j,l,i,k,b){var e=f.getStore();var g={},d=c+1,a=Ext.Object.merge(g,b);e.insert(d,a)},deleteHandler:function(b,e,d,f,g,a,c){if(!Ext.isEmpty(a.deleteFlag)&&a.deleteFlag=='D'){a.deleteFlag='';Ext.get(c.renderElement.dom.getElementsByClassName('x-icon-el x-font-icon deleteAction2-button-item')).replaceCls('deleteAction2-button-item','deleteAction1-button-item')}else {if(!Ext.isEmpty(a.crudState)&&a.crudState=='C'&&a.phantom){if(b.store.data.length>1){b.store.remove(a)}}else {a.deleteFlag='D';Ext.get(c.renderElement.dom.getElementsByClassName('x-icon-el x-font-icon deleteAction1-button-item')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}}}});Ext.define('Rs.ext.grid.column.RsUpDownloadAction',{extend:'Ext.grid.column.Column',alias:'widget.rsupdownloadactioncolumn',configs:{uploadAltText:"",uploadIcon:"",uploadDisabled:undefined,uploadHidden:undefined,uploadToolTip:"上传文件",uploadParams:{},uploadFileParam:"",limitFileSize:"",fileAccept:"",isMultiple:!1,isUploadThumb:!1,SynchronizedToSavePlugin:!1,savePluginPtype:'',submitUrl:"",uploadHandler:function(b,a,d,c,e){},thumbUploadSuccess:function(b,a){},uploadSuccess:function(a){},uploadFailure:function(a){}},text:'操作',fileAccept:"/*",limitFileSize:"100m",isMultiple:!1,isUploadThumb:!1,savePluginPtype:'saveplugin',SynchronizedToSavePlugin:!1,submitUrl:"",uploadToolTip:"上传文件",initialize:function(){var a=this;a.callParent();a.initIframe()},cell:{tools:{up:{handler:function(c,b){var a=b.column;a.uploadHandler(a,a.uploadParams,a.uploadFileParam,a.submitUrl,a.isMultiple,c)}}}},initIframe:function(){var b=this,a=Ext.DomHelper.createDom('<iframe>');a.setAttribute('name','formIframe');a.style.display="none";a.addEventListener('load',function(){if(!Ext.isEmpty(a.contentDocument.body.innerText)){var c=JSON.parse(a.contentDocument.body.innerText);if(!Ext.isEmpty(c)){if(c.info.success){b.uploadSuccess(c)}else {b.uploadFailure(c)}}}});b.iframe=a;document.body.append(b.iframe)},uploadHandler:function(a,l,k,n,o,p){if(!Ext.isEmpty(k)){var d=Ext.DomHelper.createDom('<input>'),b=Ext.DomHelper.createDom('<form>'),f=0,e=[],h=!0,g="",j=[],m,c;d.setAttribute('name',k);if(o){d.setAttribute('multiple','multiple')}d.setAttribute('type','file');if(!Ext.isEmpty(a.fileAccept)){d.setAttribute('accept',a.fileAccept);if(a.fileAccept.indexOf(",")!=-1){j=a.fileAccept.split(",");Ext.each(j,function(b,e,d){if(b.lastIndexOf(".")!=-1){c=b.split(".")[1];if(c==="*"){c="/*"}g+="("+c+")";if(e!==(d.length-1)){g+="|"}}if(b.lastIndexOf("/")!=-1){c=b.split("/")[1];if(c==="*"){c="/*"}g+="("+c+")";if(e!==(d.length-1)){g+="|"}}})}else {g=a.fileAccept}m=new RegExp(g)}d.style.opacity=0;if(!Ext.isEmpty(l)){Ext.Object.each(l,function(d,c,g){e[f]=Ext.DomHelper.createDom('<input>');e[f].setAttribute('name',d);e[f].setAttribute('value',c);e[f].setAttribute('type','text');e[f].style.opacity=0;b.appendChild(e[f++])})}b.appendChild(d);b.setAttribute("enctype","multipart/form-data");if(!Ext.isEmpty(n)){b.setAttribute('action',n)}else {}b.setAttribute('method','post');b.setAttribute('target','formIframe');if(Ext.isEmpty(a.iframe.children.item(0))){a.iframe.append(b)}else {a.iframe.children.item(0).replaceWith(b)}d.click();d.addEventListener('change',function(d){var c=d.srcElement.files;for(i in c){if(Ext.isNumeric(i)){if(!m.test(c[i].type)){h=!1;a.uploadFailure();break}if(!a.overLimitSize(a.limitFileSize,c[i].size)){h=!1;a.uploadFailure();break}}}if(a.SynchronizedToSavePlugin){gridPluginsArray=p.getPlugins();Ext.each(gridPluginsArray,function(c){if(a.savePluginPtype===c.ptype){c.addButton.on('click',function(){if(h){b.submit()}})}},this)}else {if(h){b.submit()}}})}else {}},uploadSuccess:function(a){},uploadFailure:function(a){},overLimitSize:function(e,d){var c=Ext.util.Format.uppercase(e),f,a,b;if(c.lastIndexOf("G")!=-1){a=c.split("G")[0];b=(d/Math.pow(1024,3)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("M")!=-1){a=c.split("M")[0];b=(d/Math.pow(1024,2)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("K")!=-1){a=c.split("K")[0];b=(d/Math.pow(1024,1)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}return (parseFloat(d)<parseFloat(e))}});Ext.define('Rs.ext.grid.plugin.CalculateAssign',{extend:'Ext.plugin.Abstract',alias:'plugin.calculateassign',requires:'Ext.field.Field',configs:{relyOn:[],assignValue:'',rule:''},init:function(b){var a=this;if(!a.relyOn||!a.assignValue||!a.rule){return !1}if(b.isXType('grid')){a.grid=b;a.grid.store.on('update',function(h,d,e,c,f,g){a.gridCalculate(d,c)})}else {for(j=0;j<a.relyOn.length;j++){var c=a.relyOn[j];Ext.getCmp(c).on('blur',function(){a.formCalculate(a.relyOn,a.assignValue,a.rule)})}}},formCalculate:function(h,f,c){var b="";var e=!1;var d="";var a=0;var g=this;for(i=0;i<c.length;i++){if(c.charAt(i)=="["){e=!0;d=""}else if(c.charAt(i)=="]"){e=!1;if(Ext.getCmp(d).rawValue){b=b+Ext.getCmp(d).rawValue.toString()}else {return !1}}else if(!e){b=b+c.charAt(i)}else if(e){d=d+c.charAt(i)}}a=g.doStr(b);if(isNaN(a)||Ext.isEmpty(a)){Ext.Msg.alert('提示','公式字段配置错误');return !1}a=a.toFixed(2);Ext.getCmp(f).setValue(a);return !0},gridCalculate:function(g,h){var f=this;var j=f.assignValue;var c=f.rule;var b='';var e=!1;var d="";var a=0;if((f.relyOn).includes(h[0])){for(i=0;i<c.length;i++){if(c.charAt(i)=="["){e=!0;d=""}else if(c.charAt(i)=="]"){e=!1;if(g.get(d)){b=b+g.get(d).toString()}else {return !1}}else if(!e){b=b+c.charAt(i)}else if(e){d=d+c.charAt(i)}}a=f.doStr(b);if(isNaN(a)||Ext.isEmpty(a)){Ext.Msg.alert('提示','公式字段配置错误');return !1}a=a.toFixed(2);g.set(j,a);return !0}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.FieldDiffentControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fielddiffentcontrolf',configs:{itemIds:'',panelId:'',checkField:[],errorCode:''},init:function(b){var a=this;a.grid=b;a.grid.store.on('update',function(h,f,d,c,e,g){a.gridAttributeUnsame(h,f,d,c,e,g)})},gridAttributeUnsame:function(f,b,i,d,j,k){var c=this,g=c.itemIds,a=c.checkField,h=d;rowIndex=f.indexOf(b);if(h!=g){return !0}if(rowIndex==0){return !0}if(Ext.isEmpty(b.get(a))){return !0}var e=c.grid.getStore().getAt(rowIndex-1).get(a);if(b.get(a).toString()==e.toString()){b.set(a,'');console.log('提示','业务属性一致');return !1}else {return !0}}});Ext.define('Rs.ext.grid.plugin.FieldSameControlB',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsamecontrolb',configs:{itemIds:'',panelId:'',dataPanelId:'',tableCode:'',fields:'',condition:'',errorCode:'',tipType:''},init:function(a){},doSql:function(d){var b=0;var c=d;var a={};a.sql=c;Ext.Ajax.request({url:'/base/sql/excute',jsonData:a,async:!1,method:'POST',success:function(a,c){if(Ext.decode(a.responseText).success){b=Ext.decode(a.responseText).data[0].COUNT;return b}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}})},doSql123:function(b){var a=0;return a},gridFunction:function(a,b){},singleGridFunction:function(t,p,r,q){var b=this;var h="select ";var e="";var g;var k=!1;var a=new Array();a=b.fields.split(",");if(a.length==0){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<a.length;j++){if(j==0){e=e+a[j]}else {e=e+", "+a[j]}}h=h+e+" from "+b.tableCode+" where 1=1 ";var d=b.condition;var c="";var m=new Array();var n=new Array();var f=p;var l;if(r==b.itemIds){l=q;if(l!=0){for(i=0;i<a.length;i++){m[i]=Ext.getCmp(b.panelId).getStore().getAt(l-1).get(a[i])}c="";if(!Ext.isEmpty(d)){for(i=0;i<d.length;i++){if(d.charAt(i)=="["){k=!0;g=""}else if(d.charAt(i)=="]"){k=!1;if(Ext.isEmpty(f.get(g))){value="''";c=c+value.toString()}else {value="'"+f.get(g)+"'";c=c+value.toString()}}else if(!k){c=c+d.charAt(i)}else if(k){g=g+d.charAt(i)}}}h=h+c;var s=h;var o={};o.sql=s;Ext.Ajax.request({url:'/base/sql/excute',jsonData:o,async:!1,method:'POST',success:function(c,d){if(Ext.decode(c.responseText).success){if(Ext.decode(c.responseText).data.length>1){Ext.Msg.alert("系统提示","找到多条记录");f.set(b.itemIds,"");return !1}else if(Ext.decode(c.responseText).data.length==0){Ext.Msg.alert("系统提示","未找到记录");f.set(b.itemIds,"");return !1}else {for(i=0;i<a.length;i++){n[i]=Ext.decode(c.responseText).data[0][a[i].toUpperCase()]}}}else {Ext.Msg.alert("系统提示",Ext.decode(c.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}});if(b.arraryCompare(m,n)){return !0}else {f.set(b.itemIds,"");return !1}}else {return !0}}else {return !1}},mixFunction:function(){var a=this;var f="select ";var g="";var h=!1;var c="";var d=a.condition;var e;var b=new Array();b=a.fields.split(",");if(b.length==0){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<b.length;j++){if(j==0){g=g+b[j]}else {g=g+", "+b[j]}}if(Ext.isEmpty(a.itemIds)){return !1}var k=Ext.getCmp(a.itemIds);k.on('blur',function(o,p){var j=new Array();var k=new Array();var n=Ext.getCmp(a.dataPanelId).getStore().data.length;for(i=0;i<b.length;i++){j[i]=Ext.getCmp(a.dataPanelId).getStore().getAt(n-1).get(b[i])}f="select ";f=f+g+" from "+a.tableCode+" where 1=1 ";c="";if(!Ext.isEmpty(d)){for(i=0;i<d.length;i++){if(d.charAt(i)=="["){h=!0;e=""}else if(d.charAt(i)=="]"){h=!1;if(Ext.isEmpty(Ext.getCmp(e))){Ext.Msg.alert('提示','插件配置错误-匹配条件中未找到对应的控件');Ext.getCmp(a.itemIds).setValue("");return !1}else if(Ext.isEmpty(Ext.getCmp(e).getValue())){value="''";c=c+value.toString()}else {value="'"+Ext.getCmp(e).getValue()+"'";c=c+value.toString()}}else if(!h){c=c+d.charAt(i)}else if(h){e=e+d.charAt(i)}}}f=f+c;var m=f;var l={};l.sql=m;Ext.Ajax.request({url:'/base/sql/excute',jsonData:l,async:!1,method:'POST',success:function(c,d){if(Ext.decode(c.responseText).success){if(Ext.decode(c.responseText).data.length>1){Ext.Msg.alert("系统提示","找到多条记录");Ext.getCmp(a.itemIds).setValue("");return !1}else if(Ext.decode(c.responseText).data.length==0){Ext.Msg.alert("系统提示","未找到记录");Ext.getCmp(a.itemIds).setValue("");return !1}else {for(i=0;i<b.length;i++){k[i]=Ext.decode(c.responseText).data[0][b[i].toUpperCase()]}}}else {Ext.Msg.alert("系统提示",Ext.decode(c.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}});if(a.arraryCompare(j,k)){return !0}else {Ext.getCmp(a.itemIds).setValue("");return !1}})},arraryCompare:function(a,c){var b=!0;if(a.length!=c.length){Ext.Msg.alert("系统提示","验证模型报错");return !1}for(i=0;i<a.length;i++){if(a[i]==c[i]){}else {b=!1}}return b}});Ext.define('Rs.ext.grid.plugin.FieldSameControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsamecontrolf',configs:{itemIds:'',panelId:'',checkField:[],errorCode:''},init:function(b){var a=this;a.grid=b;a.grid.store.on('update',function(h,f,d,c,e,g){a.gridAttributeSame(h,f,d,c,e,g)})},gridAttributeSame:function(f,b,i,d,j,k){var c=this,g=c.itemIds,a=c.checkField,h=d;rowIndex=f.indexOf(b);if(h!=g){return !0}if(rowIndex==0){return !0}if(Ext.isEmpty(b.get(a))){return !0}var e=c.grid.getStore().getAt(rowIndex-1).get(a);if(b.get(a).toString()!=e.toString()){b.set(a,'');console.log('提示','业务属性不一致');return !1}else {return !0}}});Ext.define('Rs.ext.grid.plugin.FieldsCompareControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsCompare',requires:'Ext.field.Field',configs:{itemIds:'',panelId:'',checkField:'',controlRule:'',errorCode:''},init:function(b){var a=this;if(b.isXType('grid')){a.grid=b;a.grid.store.on('update',function(h,d,e,c,f,g){a.gridCompareControl(d,c)})}else {if(!Ext.getCmp(a.itemIds)||!Ext.getCmp(a.checkField)){Ext.Msg.alert('提示','控件配置错误');return !1}Ext.getCmp(a.itemIds).on('blur',function(){a.formCompareControl(a.itemIds,a.checkField,a.controlRule)});Ext.getCmp(a.checkField).on('blur',function(){a.formCompareControl(a.itemIds,a.checkField,a.controlRule)})}},formCompareControl:function(d,e,c){var b=Ext.getCmp(d).getValue();var a=Ext.getCmp(e).getValue();if(isNaN(b)||Ext.isEmpty(b)){return !1}if(isNaN(a)||Ext.isEmpty(a)){return !1}if(['>','<','>=','<=','==','!=='].includes(c)){if(!this.doStr('parseFloat('+b+')'+c+'parseFloat('+a+')')){console.log('提示','不满足控制规则');Ext.getCmp(d).setValue();return !1}else {return !0}}else {console.log('提示','控制规则配置错误');return !1}},gridCompareControl:function(b,d){var c=this,a=c.itemIds,f=c.checkField,e=c.controlRule;newValue=b.get(a),compareValue=b.get(f);if(d!=a&&d!=f){return !0}if(isNaN(newValue)||Ext.isEmpty(newValue)){return !1}if(isNaN(compareValue)||Ext.isEmpty(compareValue)){return !1}if(['>','<','>=','<=','==','!=='].includes(e)){if(!this.doStr('parseFloat('+newValue+')'+e+'parseFloat('+compareValue+')')){console.log('提示','不满足控制规则');b.set(a,'');return !1}else {return !0}}else {console.log('提示','控制规则配置错误');return !1}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.FieldsDifferentControlB',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsdifferentb',requires:'Ext.field.Field',configs:{itemIds:'',panelId:'',tableCode:'',fields:'',condition:'',errorCode:'',tipType:''},init:function(){},formFieldsDifferentControlB:function(j){var f=this;var a='1 = 1';var i=(typeof (USERINFO)=="undefined"?"00":USERINFO.COMPANYCODE);var e=f.config.condition.split(',');var c=f.config.fields.split(',');for(var d=0;d<e.length;d++){if(e[d]=="company_code"){a=a+" AND company_code = '"+i+"'"}else {a=a+" AND "+e[d]}}for(var b=0;b<c.length;b++){if(Ext.isEmpty(Ext.getCmp(c[b]).getValue())){return !0}else {a=a+" AND "+c[b]+" = "+"'"+Ext.getCmp(c[b]).getValue()+"'"}}var g="select count(*) AS NUM from "+f.config.tableCode+" where "+a;console.log("controlSql:",g);var h={};h.sql=g;Ext.Ajax.request({url:'/base/sql/excute',jsonData:h,async:!1,method:'POST',success:function(a,b){if(Ext.decode(a.responseText).success){if(Ext.decode(a.responseText).data[0].NUM===0){return !0}else {Ext.Msg.alert("系统提示","后台验证不一致未通过");j.setValue('');return !1}}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}})},gridFieldsDifferentControlB:function(i){var g=this;var d=i.record;var a='1 = 1';var k=(typeof (USERINFO)=="undefined"?"00":USERINFO.COMPANYCODE);var f=g.config.condition.split(',');var c=g.config.fields.split(',');for(var e=0;e<f.length;e++){if(f[e]=="company_code"){a=a+" AND company_code = '"+k+"'"}else {a=a+" AND "+f[e]}}for(var b=0;b<c.length;b++){if(c[b] in d.data){if(Ext.isEmpty(d.get(c[b]))){return !0}else {a=a+" AND "+c[b]+" = "+"'"+d.get(c[b])+"'"}}}var h="select count(*) AS NUM from "+g.config.tableCode+" where "+a;console.log("controlSql:",h);var j={};j.sql=h;Ext.Ajax.request({url:'/base/sql/excute',jsonData:j,async:!1,method:'POST',success:function(a,b){if(Ext.decode(a.responseText).success){if(Ext.decode(a.responseText).data[0].NUM===0){return !0}else {Ext.Msg.alert("系统提示","后台验证不一致未通过");d.set(i.field,'');return !1}}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}})}});Ext.define('Rs.ext.grid.plugin.FieldsHeadDetailCalculatePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.headDetailCalculate',requires:'Ext.field.Field',configs:{hPanelID:'',hFields:'',dFields:'',errorCode:''},init:function(b){var a=this;a.getCmp().store.on('update',function(c,g,e,d,f,h){a.headCalculate(c)})},headCalculate:function(k){var c=this;var e=c.config.hPanelID;if(!Ext.getCmp(e)){console.log('提示:头面板ID配置错误')}var i=c.config.hFields;var f=c.toArr(c.config.dFields);var g=0;var a=0;var h=!1;var b='';for(var d=0;d<f.length;d++){a=0;h=!1;var l=k.model.getFieldsMap();k.each(function(c,e){if(f[d] in l){h=!0;var b=c.get(f[d].trim());b=b?b:0;a=(isNaN(parseFloat(a))?0:parseFloat(a))+(isNaN(parseFloat(b))?0:parseFloat(b))}});if(h){a=a.toFixed(2);b=b+'parseFloat('+a+')'}else {b=b+f[d]}}a=c.doStr(b);if(isNaN(a)||Ext.isEmpty(a)){console.log('提示:明细字段配置错误');return !1}g=a.toFixed(2);if(Ext.getCmp(e).isXType('grid')){var j=Ext.getCmp(e).getStore();j.each(function(c,d){var b=Ext.getCmp(e).getSelection();var a=j.indexOf(b);if(d==a&&a>-1){c.set(i,g);return !0}})}else {if(!Ext.getCmp(i)){console.log('提示:头字段配置错误');return !1}else {Ext.getCmp(i).setValue(g);return !0}}},doStr:function(b){var a=Function;return new a("return "+b)()},toArr:function(h){var d=[];if(h.indexOf('+')>-1){var b=h.split('+');for(var a=0;a<b.length;a++){d.push(b[a].trim());a<b.length-1&&d.push('+')}}else {d.push(h)}var e=[];for(var a=0;a<d.length;a++){var c=d[a];if(c.indexOf('-')>-1){var b=c.split('-');for(var a=0;a<b.length;a++){e.push(b[a].trim());a<b.length-1&&e.push('-')}}else {e=d}}var f=[];for(var a=0;a<e.length;a++){var c=e[a];if(c.indexOf('*')>-1){var b=c.split('*');for(var a=0;a<b.length;a++){f.push(b[a].trim());a<b.length-1&&f.push('*')}}else {f=e}}var g=[];for(var a=0;a<f.length;a++){var c=f[a];if(c.indexOf('/')>-1){var b=c.split('/');for(var a=0;a<b.length;a++){g.push(b[a].trim());a<b.length-1&&g.push('/')}}else {g=f}}return g}});Ext.define('Rs.ext.grid.plugin.FieldsSumComparePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.sumCompare',requires:'Ext.field.Field',configs:{hPanelID:'',dPanelID:'',hFields:'',dFields:'',formula:'',errorCode:''},headDetailSumCompareControl:function(){var a=this;if(!Ext.getCmp(a.config.hPanelID)){Ext.Msg.alert('提示','头面板ID配置错误');return {"success":!1,"panelID":"","errorMsg":[],"errArr":[]}}if(!Ext.getCmp(a.config.dPanelID)){Ext.Msg.alert('提示','明细面板ID配置错误');return {"success":!1,"panelID":"","errorMsg":[],"errArr":[]}}var g=a.config.hFields.split(',');var h=a.config.dFields.split(',');var b=0;var d=0;var f=!1;var e='';for(var c=0;c<g.length;c++){b=0;f=!1;if(Ext.getCmp(a.config.hPanelID).isXType('grid')){var i=Ext.getCmp(a.config.hPanelID).getStore();i.each(function(d,j){var h=Ext.getCmp(a.config.hPanelID).getSelected();var e=i.indexOfId(h.items[0].id);if(j==e){if(g[c] in d.data){f=!0;b=parseFloat(b)+parseFloat(d.get(g[c]))}}})}else {if(Ext.getCmp(a.config.hPanelID).items.items.includes(Ext.getCmp(g[c]))){f=!0;b=parseFloat(b)+parseFloat(Ext.getCmp(g[c])._value)}}if(f){b=b.toFixed(2);e=e+'parseFloat('+b+')'}else {e=e+g[c]}}b=a.doStr(e);if(isNaN(b)||Ext.isEmpty(b)){Ext.Msg.alert('提示','头字段配置错误');return {"success":!1,"panelID":"","errorMsg":[],"errArr":[]}}b=b.toFixed(2);e='';for(var c=0;c<h.length;c++){d=0;f=!1;Ext.getCmp(a.config.dPanelID).getStore().each(function(a,b){if(h[c] in a.data){f=!0;d=parseFloat(d)+parseFloat(a.get(h[c]))}});if(f){d=d.toFixed(2);e=e+'parseFloat('+d+')'}else {e=e+h[c]}}d=a.doStr(e);if(isNaN(d)||Ext.isEmpty(d)){Ext.Msg.alert('提示','明细字段配置错误');return {"success":!1,"panelID":"","errorMsg":[],"errArr":[]}}d=d.toFixed(2);if(['>','<','>=','<=','==','!=='].includes(a.config.formula)){if(!this.doStr('parseFloat('+b+')'+a.config.formula+'parseFloat('+d+')')){return {"success":!1,"panelID":a.config.dPanelID,"errorMsg":a.config.errorCode,"errArr":[{}]}}else {return {"success":!0,"panelID":"","errorMsg":[],"errArr":[]}}}else {Ext.Msg.alert('提示','控制规则配置错误');return {"success":!1,"panelID":"","errorMsg":[],"errArr":[]}}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.GridDataCheckRepeatPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.griddatacheckrepeat',requires:[],configs:{fields:[],panelID:'',errCode:[]},init:function(){},checkRepeat:function(c){var a=this;a.panel=c;panelID=a.panelID;fields=a.fields;errCode=a.errCode;errArr=[];if(fields!==null&&!Ext.isEmpty(fields)){var d=a.checkFieldsConfig(fields);if(d){var b=a.checkRepeatDo(fields);var e=b.success;errArr=b.errArr;b={success:e,panelID:panelID,errorMsg:errCode,errArr:errArr};return b}}},checkRepeatDo:function(d){var b=this;errorMsg={},retVlaue={},store=b.panel.getStore(),errArr=[];checkField=b.fields;var c=store.getModel().idProperty;var a=new Ext.util.MixedCollection();store.each(function(f,h,j){if(b.checkIsValidRec(f,checkField)){var e='';Ext.each(d,function(b,g,c){var a=f.get(b);e+='?'+(Ext.isEmpty(a)?'':a)},this);if(!Ext.isEmpty(e)&&a.containsKey(e)){var g=errorMsg[e]||[];if(Ext.isEmpty(g)){var i=(a.get(e))[0]+1;g.push(i);errArr.push({uuid:((a.get(e))[1]),checkField:checkField,index:i-1})}g.push(h+1);errorMsg[e]=g;errArr.push({uuid:f.get(c),checkField:checkField,index:h})}else {a.add(e,[h,f.get(c)])}}},this);if(errArr.length>0){retVlaue={success:!1,errArr:errArr}}else {retVlaue={success:!0,errArr:errArr}}return retVlaue},checkFieldsConfig:function(b){var e=this;store=e.panel.getStore();var d=store.getModel().fields.items;var c=[];if(Ext.isArray(b)){for(var a=0;a<d.length;a++){c[a]=d[a].getName()}for(var f in b){if(c.indexOf(b[f])==-1){return !1}}}else {return !1}return !0},checkIsValidRec:function(a,d){var f=this,b=!1,c=!1;if(a.dirty){var e=Object.keys(a.modified);Ext.each(e,function(c){if(!Ext.isEmpty(a.data[c])){b=!0;return !1}})}if(a.deleteFlag=='D'){b=!1}else {if(a.crudState=='R'||a.crudState=='U'){b=!0}}if(b){Ext.each(d,function(b){if(!Ext.isEmpty(a.data[b])){c=!0;return !1}})}return c}});Ext.define('Rs.ext.grid.plugin.GridDataMustInputPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.griddatamustinput',requires:[],configs:{fields:[],panelID:'',otherCdt:'',errCode:[]},init:function(){},checkMustInput:function(c){var a=this;a.panel=c,panelID=a.panelID,fields=a.fields,errCode=a.errCode,errArr=[];if(fields!==null&&!Ext.isEmpty(fields)){var d=a.checkFieldsConfig(fields);if(d){var b=a.checkMustInputDo(fields);var e=b.success;errArr=b.errArr;b={success:e,panelID:panelID,errorMsg:errCode,errArr:errArr};return b}}},checkMustInputDo:function(h){var d=this,e={},g=d.panel.getStore(),c=[],a=[],b=g.getModel().idProperty,f=d.otherCdt,i=new Ext.util.MixedCollection();g.each(function(e,g,i){if(d.checkIsValidRec(e)){Ext.each(h,function(m,o,p){var k=m;var n=e.get(m);if(f){var l=!0;l=d.checkComp(e,f);if(!l){l=!1}if(l&&!n){if(c.indexOf(e.get(b))==-1){c.push(e.get(b));a.push({uuid:e.get(b),checkField:[k],index:g})}else {for(var j in a){if(a[j].uuid==e.get(b)){a[j].checkField.push(k);break}}}}}else {if(!n){if(c.indexOf(e.get(b))==-1){c.push(e.get(b));a.push({uuid:e.get(b),checkField:[k],index:g})}else {for(var j in a){if(a[j].uuid==e.get(b)){a[j].checkField.push(k);break}}}}}},this)}});if(a.length>0){e={success:!1,errArr:a}}else {e={success:!0,errArr:a}}return e},checkFieldsConfig:function(e){var a=this,g=a.panel.getStore(),f=g.getModel().fields.items,d=[],c=[];if(Ext.isArray(e)){for(var b=0;b<f.length;b++){d[b]=f[b].getName()}for(var h in e){if(d.indexOf(e[h])==-1){console.log('您的必输字段配置错误，请检查');return !1}}}else {console.log('您的必输字段配置错误，请检查');return !1}if(a.panel.isXType('grid')){Ext.each(a.panel.getColumns(),function(a){if(!Ext.isEmpty(a.dataIndex)){c.push(a.dataIndex)}})}else {c=d}a.myDataIndex=c;return !0},checkIsValidRec:function(a){var d=this,b=!1;if(a.dirty){var c=Object.keys(a.modified);Ext.each(c,function(c){if(!Ext.isEmpty(a.data[c])){b=!0;return !1}})}if(a.deleteFlag=='D'){b=!1}else {if(a.crudState=='R'||a.crudState=='U'){b=!0}}return b},doStr:function(b){var a=Function;return new a("return "+b)()},checkComp:function(d,a){var f=this.strReplace(a,[]);var c=this.strFeArr;for(var b=0;b<c.length;b++){a=a.replaceAll("["+c[b]+"]",'"'+d.get(c[b])+'"')}var e=this.doStr(a);return e},strReplace:function(a,b){b=b||[];var e=a.substring(a.indexOf("[")+1,a.indexOf("]"));if(a.indexOf("[")==-1||a.indexOf("]")==-1){return 1}if(this.myDataIndex.indexOf(e)==-1){var c=a.indexOf("]");var d=a.substring(c+1);return this.strReplace(d,this.strFeArr)}else {var c=a.indexOf("]");var d=a.substring(c+1);b.push(e);this.strFeArr=b;return this.strReplace(d,this.strFeArr)}}});Ext.define('Rs.ext.grid.plugin.deleteHeadControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.deleteHead',requires:'Ext.Button',configs:{itemIds:'',relatePanelId:'',checkFields:'',errorCode:''},deleteHeadControl:function(){var c=this;var d=!0;var b=c.config.relatePanelId.split(',');for(var a=0;a<b.length;a++){if(Ext.getCmp(b[a]).getStore().getCount()<1||Ext.getCmp(b[a]).getStore().data.items[0].phantom){continue}else {d=!1;if(!Ext.isEmpty(c.config.errorCode)){Rs.Msg.messageAlert({stateCode:c.config.errorCode})}break}}return d}});Ext.define('Rs.ext.grid.plugin.RelateStateControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.relatestatecontrolf',configs:{itemIds:'',relatePanelId:'',relateFields:'',checkFields:'',targetValues:'',controlRule:'',allRowEnable:!1,erroCode:''},init:function(a){var b=this,d,c=a.getPlugins();if(a.isXType('grid')){b.grid=a;b.grid.store.on('update',function(e,d,f,c,g,h){b.relateStateControl(e,d,c)})}},gridFunction:function(a,b){},relateStateControl:function(v,t,u){var d=this;var c=!1;var q=new Array();q=d.itemIds.split(",");var k=new Array();k=u;var n=new Array();n=d.checkFields.split(",");var h=new Array();h=d.targetValues.split(",");var o=new Array();o=d.controlRule.split(",");var e=new Array();e=d.relateFields.split(",");if(h.length!=n.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(h.length!=o.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}console.log(k);var p=!1;if(d.allRowEnable){p=!0}else {for(j=0;j<q.length;j++){for(i=0;i<k.length;i++){if(k[i]==q[j]){p=!0}}}}if(p){for(j=0;j<h.length;j++){var g=new Array();for(i=0;i<e.length;i++){g[i]=t.get(e[i])}var r=!0;for(i=0;i<g.length;i++){if(!isNaN(g[i])||!Ext.isEmpty(g[i])){r=!1}}if(r){return !0}var l;var s;var m=0;var b;Ext.getCmp(d.relatePanelId).getStore().each(function(a){l=!0;for(z=0;z<e.length;z++){if(a.get(e[z])!=undefined){s=a.get(e[z]).toString();if(s!=g[z]){l=!1}}else {l=!1}}if(l){b=a.get(n[j]).toString();m=m+1}});if(m==0){Ext.Msg.alert('提示','未找到关联的记录，请重新定义关联字段');return !1}else if(m>1){return !1;Ext.Msg.alert('提示','找到多个关联的记录，请重新定义关联字段')}var f=h[j].toString();var a=o[j];if(a=='>'){if(b>f){c=!0}}else if(a=='<'){if(b<f){c=!0}}else if(a=='>='){if(b>=f){c=!0}}else if(a=='<='){if(b<=f){c=!0}}else if(a=='='){if(b==f){c=!0}}else if(a=='<>'||a=='!='){if(b!=f){c=!0}}else {}}if(c){return !1}else {return !0}}else {return !0}}});Ext.define('Rs.ext.panel.plugin.SavePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.saveplugin',requires:['Ext.Toolbar','Rs.ext.button.RsButton'],configs:{panelIds:[],buttonText:'',buttonIcon:'',buttonStyle:{},url:'',personCodeField:'',personNameField:'',autoLoad:!0,needLoadPanels:[],needReplaceFields:{},beforeExecute:function(a){},executeSuccess:function(a,b){},executeFailures:function(a,b){}},init:function(b){var a=this;a.initAddButton(b);Ext.defer(a.initAddPlugins,100,a)},initAddButton:function(c){var a=this,e,b={},b=Ext.Object.merge(b,a.buttonStyle);if(Ext.isEmpty(a.buttonIcon)){a.buttonIcon='saveAction-button-item'}if(Ext.isEmpty(a.buttonText)){a.buttonText='保存'}var d=Ext.create('Rs.ext.button.RsButton',{text:a.buttonText,iconCls:a.buttonIcon,style:b,iconAlign:"left",handler:function(){a.doSave()}});if(Ext.isEmpty(a.autoLoad)){a.autoLoad=!0}if(c.xtype=='rs-pagingtoolbar'){c.insert(2,d)}else {c.add(d)}},doSave:function(){var a=this,b={},c=new Array();if(!Ext.isEmpty(a.beforeExecute)){if(!a.beforeExecute(a)){return !1}}if(!a.checkPanelsModified(a.panelIds)){return !1}if(!a.checkDatas()){return !1}Ext.each(a.panelIds,function(b){panel=Ext.getCmp(b);store=Ext.getStore(panel.store);c.push(a.integratedData(b,store))});var d=a.url.indexOf("auto/");var e=a.url.indexOf("/crud");b.pagCode=a.url.substring(d+5,e);b.funCode=a.id;b.panels=c;returnData=a.doExecuteAction(b);if(returnData.errorFlag){return !1}if(a.autoLoad){if(!Ext.isEmpty(a.needLoadPanels)){Ext.each(a.needLoadPanels,function(c){var b=Ext.getCmp(c),a=Ext.getStore(b.store);if(a.isDynamicStore||a.isCachedStore){if(!Ext.isEmpty(a.dynamicStore)){a.dynamicStore.cachedDataAllClear()}}if(a.isCachedStore){a.getDynamicStore().forceChangeStore=!0;a.loadPage(a.currentPage)}else {a.reload()}if(b.isXType('grid')){b.setSelection()}})}else {Ext.each(a.panelIds,function(a){panel=Ext.getCmp(a);store=Ext.getStore(panel.store);if(store.isDynamicStore||store.isCachedStore){if(!Ext.isEmpty(store.dynamicStore)){store.dynamicStore.cachedDataAllClear()}}if(store.isCachedStore){store.getDynamicStore().forceChangeStore=!0;store.loadPage(store.currentPage)}else {store.reload()}if(panel.isXType('grid')){panel.setSelection()}})}}else {a.replaceIdToal(b,returnData.responseData)}return},checkModifieData:function(b,f){var g=this,d=b.getUpdatedRecords(),e=b.getNewRecords(),a,c,h;if(b.isDynamicStore||b.isCachedStore){a=g.checkCaCheStoreModified(b)}else {if(d.length>0){if(f.xtype=='gridpanel'){return !0}else {Ext.each(d,function(d){c=Object.keys(d.modified);Ext.each(c,function(c){if(c!=b.model.idProperty&&d.data[c]!=d.modified[c]){if(d.data[c]==null&&d.modified[c]=='undefined'){}else {a=!0;return !1}}});if(a){return !1}});if(a){return !0}}}Ext.each(e,function(d){if(d.dirty){c=Object.keys(d.modified);Ext.each(c,function(c){if(!Ext.isEmpty(d.data[c])){a=!0}})}});if(a){return !0}b.each(function(c){if(c.deleteFlag=='D'){a=!0}},this)}if(a){return !0}return !1},checkCaCheStoreModified:function(b){var e=this,a,i,h,f,g,c,d;if(b.isCachedStore){c=b.noRelationStaticDataObj}else {c=b.cachedStore.noRelationStaticDataObj}h=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(h,function(d){i=c[d];if(d==b.currentPage){newRecordsP=e.getNewRecordsData(b);deleteRecordsP=e.getDeleteRecordsData(b);updateRecordsP=e.getUpdateRecordsData(b);if(!Ext.isEmpty(newRecordsP.recordData)||!Ext.isEmpty(deleteRecordsP.recordData)||!Ext.isEmpty(updateRecordsP.recordData)){a=!0}if(a){return !1}}else {Ext.each(i,function(c){if(c.crudState=='R'&&c.deleteFlag!='D'){}else if(c.deleteFlag=='D'){a=!0}else if(c.crudState=='U'){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(c.modified[e])&&Ext.isEmpty(c.data[e])){}else {if(e!=b.model.idProperty&&c.data[e]!=c.modified[e]){if(c.data[e]==null&&c.modified[e]=='undefined'){}else {a=!0;return !1}}}})}}if(c.phantom){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(c.data[e])){a=!0;return !1}})}}if(a){return !1}});if(a){return !1}}});if(a){return !0}}else {if(b.isCachedStore){d=b.relationStaticDataArry}else {d=b.cachedStore.relationStaticDataArry}f=Object.keys(d);Ext.each(f,function(c){g=d[c];Ext.each(g.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){a=!0}else if(d.crudState=='U'){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(d.modified[e])&&Ext.isEmpty(d.data[e])){}else {if(e!=b.model.idProperty&&d.data[e]!=d.modified[e]){if(d.data[e]==null&&d.modified[e]=='undefined'){}else {a=!0;return !1}}}})}}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(d.data[e])){a=!0;return !1}});if(a){a=!0}}}if(a){return !1}});if(a){return !1}});if(a){return !0}}},checkPanelsModified:function(c){var d=this,b,a;Ext.each(c,function(e){b=Ext.getCmp(e);store=Ext.getStore(b.store);a=d.checkModifieData(store,b);if(a){return !1}});if(a){return !0}else {Rs.Msg.messageAlert({title:'提示',message:'数据没有发生变化，不需要保存'});return !1}},integratedData:function(e,c){var a=this,f={},b={},d={};a.comCode=typeof (USERINFO)=='undefined'?'':USERINFO.COMPANYCODE;a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTCODE,a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTNAME;if(Ext.isEmpty(a.userCode)){a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.USERCODE;a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.USERNAME}Ext.each(c.model.getFields(),function(b){if(b.name=='COM_CODE'){a.comFlag=!0}else if(b.name=='UPD_CODE'){a.updFlag=!0}});if(!Ext.isEmpty(a.personCodeField)||!Ext.isEmpty(a.personNameField)){a.personFlag=!0}if(c.isDynamicStore||c.isCachedStore){d=a.getAllModifiedRecordsData(c);b.newRecords=d.newRecords;b.deleteRecords=d.deleteRecords;b.updateRecords=d.updateRecords}else {b.newRecords=this.getNewRecordsData(c);b.deleteRecords=this.getDeleteRecordsData(c);b.updateRecords=this.getUpdateRecordsData(c)}f.gridCode=e;f.panelData=b;if(!Ext.isEmpty(Ext.getCmp(e).relationGridPanelId)||!Ext.isEmpty(Ext.getCmp(e).moreRelationGridObj)){f.relationData=a.dealRelationData(Ext.getCmp(e))}return f},dealRelationData:function(a){var e={},b={};if(!Ext.isEmpty(a.relationGridPanelId)){if(a.isArrayItemObj(a.relationGridQueryFieldArray)){b[a.relationGridPanelId]=a.relationGridQueryFieldArray}else {var c={},d=[];Ext.each(a.relationGridQueryFieldArray,function(b){c.upField=b;c.downField=b;d.push(c)});b[a.relationGridPanelId]=d}}if(!Ext.isEmpty(a.moreRelationGridObj)){Ext.each(Ext.Object.getValues(a.moreRelationGridObj),function(c){if(a.isArrayItemObj(c.relationGridQueryFieldArray)){b[c.relationGridPanelId]=c.relationGridQueryFieldArray}else {var d={},e=[];Ext.each(c.relationGridQueryFieldArray,function(b){d.upField=b;d.downField=b;e.push(d)});b[c.relationGridPanelId]=e}})}return b},getNewRecordsData:function(f){var a=this,e=f.getNewRecords(),c={},d,b=new Array();Ext.each(e,function(c){if(c.dirty){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(c.data[a])){d=!0;return !1}});if(d){if(a.comFlag){c.data.COM_CODE=a.comCode}if(a.updFlag){c.data.UPD_CODE=a.userCode;c.data.UPD_NAME=a.userName}if(a.personFlag){c.data[a.personCodeField]=a.userCode;c.data[a.personNameField]=a.userName}b.push(c.data)}}});c.recordData=b;return c},getDeleteRecordsData:function(c){var d=this,b={},a=new Array();c.each(function(b){if(b.deleteFlag=='D'){a.push(b.data)}});b.recordData=a;return b},getUpdateRecordsData:function(d){var a=this,h=d.getUpdatedRecords(),c={},f,g=new Array(),b={},e=new Array();Ext.each(h,function(c){f=Object.keys(c.modified);b={};Ext.each(f,function(a){if(Ext.isEmpty(c.modified[a])&&Ext.isEmpty(c.data[a])){}else {b[a]=c.data[a]}});if(!Ext.Object.isEmpty(b)){b[d.model.idProperty]=c.data[d.model.idProperty];if(a.updFlag){c.data.UPD_CODE=a.userCode;c.data.UPD_NAME=a.userName;b.UPD_CODE=a.userCode;b.UPD_NAME=a.userName}if(a.personFlag){c.data[a.personCodeField]=a.userCode;c.data[a.personNameField]=a.userName;b[a.personCodeField]=a.userCode;b[a.personNameField]=a.userName}g.push(b);e.push(c.data)}});c.modifieds=g;c.recordData=e;return c},getAllModifiedRecordsData:function(b){var a=this,g,h,t,s,n,r,f={},m=!1,c={},d={},q={},p={},o={},e={},j=new Array(),k=new Array(),l=new Array(),i=new Array();if(b.isCachedStore){g=b.noRelationStaticDataObj}else {g=b.cachedStore.noRelationStaticDataObj}s=Object.keys(g);if(!Ext.Object.isEmpty(g)){Ext.each(s,function(c){pageData=g[c];if(c==b.currentPage){q=a.getNewRecordsData(b);o=a.getDeleteRecordsData(b);p=a.getUpdateRecordsData(b)}else {Ext.each(pageData,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){i.push(d.data)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}k.push(modifiedData);l.push(d.data)}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){m=!0;return !1}});if(m){if(a.comFlag){d.data.COM_CODE=a.comCode}if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName}j.push(d.data)}}}})}});c.modifieds=k;c.recordData=l;d.recordData=i;f.recordData=j;c=Ext.Object.merge(c,p),d=Ext.Object.merge(d,o),f=Ext.Object.merge(f,q),e.newRecords=f;e.deleteRecords=d;e.updateRecords=c;return e}else {if(b.isCachedStore){h=b.relationStaticDataArry}else {h=b.cachedStore.relationStaticDataArry}r=Object.keys(h);Ext.each(r,function(c){n=h[c];Ext.each(n.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){i.push(d.data)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}k.push(modifiedData);l.push(d.data)}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){m=!0;return !1}});if(m){var e=d.data;e.FUU_ID=n.queryRecord.id;if(a.comFlag){e.COM_CODE=a.comCode}if(a.updFlag){e.UPD_CODE=a.userCode;e.UPD_NAME=a.userName}if(a.personFlag){e[a.personCodeField]=a.userCode;e[a.personNameField]=a.userName}j.push(e)}}}})});c.modifieds=k;c.recordData=l;d.recordData=i;f.recordData=j;c=Ext.Object.merge(c,p),d=Ext.Object.merge(d,o),f=Ext.Object.merge(f,q),e.newRecords=f;e.deleteRecords=d;e.updateRecords=c;return e}},doExecuteAction:function(d){var a=this,e=a.url,b=!1,c={},f;token=typeof (TOKEN)=='undefined'?'':TOKEN;Ext.Ajax.request({url:e,async:!1,headers:{Authorization:token},jsonData:JSON.stringify(d),method:'POST',dataType:"json",success:function(e,g){var f=Ext.decode(e.responseText);c.responseData=f;if(f.success){if(!Ext.isEmpty(a.executeSuccess)){b=a.executeSuccess(a,e)}else {b=!1}}else {if(!Ext.isEmpty(a.executeFailures)){a.executeFailures(a,e)}else {Rs.Msg.messageAlert({title:'提示',message:f.data,buttons:Ext.MessageBox.OK})}b=!0}},failure:function(c,f){var e=Ext.decode(c.responseText);if(!Ext.isEmpty(a.executeFailures)){b=a.executeFailures(a,c)}else {Rs.Marker.mark(e.data)}b=!0}});c.errorFlag=b;return c},checkDatas:function(){var e=this,a=new Array(),b,d={},c;window.RsPanelErrorMsg=[];Ext.each(e.panelIds,function(d){c=Ext.getCmp(d);Rs.Marker.unmark(c);b=e.checkPanelData(c);if(!Ext.isEmpty(b)&&b.success==!1){a.push(b)}});if(!Ext.isEmpty(a)){d.panelData=a;window.RsPanelErrorMsg=a;Rs.Marker.mark(a)}if(!Ext.Object.isEmpty(d)){return !1}else {return !0}},checkPanelData:function(d){var i=this,g=d._plugins,a,h=new Array(),b={},e=new Array(),c=new Array(),f=new Array();Ext.each(g,function(a){if("griddatamustinput"==a.ptype||'griddatacheckrepeat'==a.ptype||'sumCompare'==a.ptype||'formulaPlu'==a.ptype){f.push(a)}},this);Ext.each(f,function(f){a={};if("griddatamustinput"==f.ptype){a=f.checkMustInput(d)}else if("griddatacheckrepeat"==f.ptype){a=f.checkRepeat(d)}else if("sumCompare"==f.ptype){a=f.headDetailSumCompareControl()}else if("formulaPlu"==f.ptype){a=f.formulaPlu()}if(!Ext.isEmpty(a)&&a.success==!1){h.push(a);Ext.each(errArr,function(a){c.push(a)});e.push(a.errorMsg);b.panelId=a.panelID}},this);if(c.length>0){b.success=!1}else {b.success=!0}b.errArr=c;b.errorMsg=e;return b},initAddPlugins:function(){var a=this;console.log("111111");Ext.each(a.panelIds,function(b){panel=Ext.getCmp(b);if(!Ext.isEmpty(panel)&&panel.isXType('grid')){console.log("1111112");a.addControlPlugins(panel)}})},addControlPlugins:function(c){var d=this,e=c._plugins,a,b=new Array();Ext.each(e,function(d){if("fieldscompare"==d.ptype||"statecontrolf"==d.ptype||"relatestatecontrolf"==d.ptype||"fielddiffentcontrolf"==d.ptype||"fieldsamecontrolf"==d.ptype||"fieldsdifferentb"==d.ptype||"fieldsamecontrolb"==d.ptype||"calculateassign"==d.ptype||"headdetailcalculate"==d.ptype){b.push(d)}if("gridcellediting"===d.ptype){a=d}if("rowedit"===d.ptype){a=d}if("gridcellediting"===d.ptype){a=d}},this);if(!Ext.isEmpty(a)){c.on('edit',function(e,a){d.doControPlugis(b,a)},d);c.on('beforeedit',function(e,d){var a=!0;Ext.each(b,function(b){a=!0;if("statecontrolf"==b.ptype){a=b.gridStateControl(e,d.record,d.field)}if("relatestatecontrolf"==b.ptype){a=b.relateStateControl(e,d.record,d.field)}if(!a){return !1}});if(!a){return !1}},d)}},doControPlugis:function(c,b){var a=!0;Ext.each(c,function(d){a=!0;if("fieldscompare"==d.ptype){a=d.gridCompareControl(b)}if("fielddiffentcontrolf"==d.ptype){a=d.gridAttributeUnsame(b)}if("fieldsamecontrolf"==d.ptype){a=d.gridAttributeSame(b)}if("fieldsdifferentb"==d.ptype){a=d.gridFieldsDifferentControlB(b)}if("fieldsamecontrolb"==d.ptype){a=d.singleGridFunction('',b.record,b.cell.dataIndex,b.row._recordIndex)}if("calculateassign"==d.ptype){a=d.gridCalculate(b)}if("headdetailcalculate"==d.ptype){a=d.headCalculate(b)}if(!a){return !1}});if(!a){return !1}},replaceIdToal:function(c,b){var a=this;Ext.each(c.panels,function(i){var e=i.gridCode;var h=Ext.getCmp(e);var g=h.getStore();if(!Ext.isEmpty(a.needReplaceFields)){if(!Ext.isEmpty(a.needReplaceFields[e])){var d=a.needReplaceFields[e];d=d.substr(1);d=d.substring(0,d.length-1);var f=d.split(',')}else {var f=null}}else {var f=null}if(g.isDynamicStore||g.isCachedStore){a.replaceIdC(g,b.data[e],f)}else {a.replaceIdN(g,b.data[e],f)}})},replaceIdN:function(a,c,b){a.each(function(d){if(d.deleteFlag=='D'){a.remove(d)}});Ext.each(c,function(d){var e=Ext.Object.getKeys(d);var f=a.getById(e);f.set(a.model.idProperty,d[e][a.model.idProperty]);Ext.each(b,function(g){if(!Ext.isEmpty(d[e][g])){f.set(g,d[e][g])}});f.id=d[e][a.model.idProperty]});a.commitChanges()},replaceIdC:function(a,b,h){var c,g,i,d,e,f;if(a.isCachedStore){c=a.noRelationStaticDataObj}else {c=a.cachedStore.noRelationStaticDataObj}g=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(g,function(d){i=c[d];Ext.each(i,function(c){if(c.deleteFlag=='D'){a.remove(c)}if(Ext.isEmpty(b)){return}if(c.phantom){if(!Ext.isEmpty(c.data[a.model.idProperty])){if(!Ext.isEmpty(c.get('HUU_ID'))){c.set('HUU_ID',b[c.id].HUU_ID)}Ext.each(h,function(e){if(!Ext.isEmpty(b[c.id][e])){c.set(e,b[c.id][e])}});c.set(a.model.idProperty,b[c.id].UU_ID);c.id=c.data[a.model.idProperty]}}})})}else {if(a.isCachedStore){d=a.relationStaticDataArry}else {d=a.cachedStore.relationStaticDataArry}e=Object.keys(d);Ext.each(e,function(c){f=d[c];Ext.each(f.cachedPageData.data,function(d){if(d.deleteFlag=='D'){a.remove(d)}if(Ext.isEmpty(b)){return}if(d.phantom){if(!Ext.isEmpty(d.data[a.model.idProperty])){if(!Ext.isEmpty(d.get('HUU_ID'))){d.set('HUU_ID',b[d.id].HUU_ID)}Ext.each(h,function(e){if(!Ext.isEmpty(b[d.id][e])){d.set(e,b[d.id][e])}});d.set(a.model.idProperty,b[d.id].UU_ID);d.id=d.data[a.model.idProperty]}}})})}a.commitChanges()}});Ext.define('Rs.ext.grid.plugin.StateControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.statecontrolf',configs:{itemIds:'',panelId:'',checkFields:'',targetValues:'',controlRule:'',erroCode:''},init:function(b){var a=this,d,c=b.getPlugins();if(b.isXType('grid')){a.grid=b;a.grid.store.on('update',function(h,d,e,c,f,g){a.gridStateControl(d,c)})}else {a.grid=b;a.grid.on('afterrender',function(g,h){var c=new Array();c=a.itemIds.split(",");var e=new Array();e=a.checkFields.split(",");var d=new Array();d=a.targetValues.split(",");var f=new Array();f=a.controlRule.split(",");if(c.length!=e.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(d.length!=f.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(c.length!=d.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<c.length;j++){a.panelFunction(c[j],a.panelId,e[j],d[j],f[j])}})}},panelFunction:function(a,g,f,e,b){var h=this;var d=Ext.getCmp(f).getValue().toString();var c=e.toString();if(b=='>'){if(d>c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<'){if(d<c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='>='){if(d>=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<='){if(d<=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='='){if(d==c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<>'||b=='!='){if(d!=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else {Ext.Msg.alert('提示','控制规则配置错误')}},gridStateControl:function(i,l){var g=this;var c=!1;var f=new Array();f=g.itemIds.split(",");var h=new Array();h=g.checkFields.split(",");var e=new Array();e=g.targetValues.split(",");var k=new Array();k=g.controlRule.split(",");if(f.length!=h.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(e.length!=k.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(f.length!=e.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<f.length;j++){if(l==f[j]){if(Ext.isEmpty(i.get(h[j]))){return !1}var d=i.get(h[j]).toString();var b='0';if(i.get(e[j])){b=i.get(e[j]).toString()}var a=k[j];if(a=='>'){if(d>b){c=!0}else {}}else if(a=='<'){if(d<b){c=!0}else {}}else if(a=='>='){if(d>=b){c=!0}else {}}else if(a=='<='){if(d<=b){c=!0}else {}}else if(a=='='){if(d==b){c=!0}else {}}else if(a=='<>'||a=='!='){if(d!=b){c=!0}else {}}else {Ext.Msg.alert('提示','控制规则配置错误')}}else {}}if(c){console.log("提示："+g.erroCode);return !1}else {return !0}},gridFunction:function(a,b){}});Ext.define('Rs.ext.telescope.store.TeleStore',function(){return {extend:'Ext.data.Store',proxy:{type:'ajax',url:'/base/telescope/read',reader:{type:'json',rootProperty:'data.list',totalProperty:'data.total'}}}});Ext.define('Rs.ext.telescope.model.Base',{extend:'Ext.data.Model',schema:{namespace:'Rs.ext.telescope.model'}});Ext.define('Rs.ext.telescope.model.Head',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'prog_code',mapping:'progCode',type:'string'},{name:'prog_name',mapping:'progName',type:'string'}]});Ext.define('Rs.ext.telescope.model.Detail',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'seq_no',mapping:'seqNo',type:'int'},{name:'prog_code',mapping:'progCode',type:'string'},{name:'field_name',mapping:'fieldName',type:'string'},{name:'is_hidden',mapping:'isHidden',type:'string'},{name:'desc_zh',mapping:'descZh',type:'string'},{name:'desc_en',mapping:'descEn',type:'string'}]});Ext.define('Rs.ext.telescope.model.Criteria',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'seq_no',mapping:'seqNo',type:'int'},{name:'prog_code',mapping:'progCode',type:'string'},{name:'field_name',mapping:'fieldName',type:'string'},{name:'desc_zh',mapping:'descZh',type:'string'},{name:'desc_en',mapping:'descEn',type:'string'}]});Ext.define('Rs.ext.telescope.model.Meta',{extend:'Rs.ext.telescope.model.Base',requires:['Rs.ext.telescope.model.Head','Rs.ext.telescope.model.Detail','Rs.ext.telescope.model.Criteria'],fields:[{name:'prog_code',mapping:'progCode',type:'string'}],hasOne:['Head'],hasMany:['Detail','Criteria']});Ext.define('Rs.ext.telescope.store.TeleMetaStore',function(){return {extend:'Ext.data.Store',model:'Rs.ext.telescope.model.Meta',proxy:{type:'ajax',url:'/base/telescope/meta',reader:{type:'json',rootProperty:'data'}}}});Ext.define('Rs.ext.telescope.view.TelescopeForm',{extend:'Ext.Container',viewModel:{data:{selectedfield:null,currentValue:null}},bodyPadding:4,animation:!1,collapseAnimation:!1,expandAnimation:!1,hideAnimation:!1,showAnimation:!1,itemId:'form',padding:6,items:[{xtype:'fieldcontainer',itemId:'fieldcontainer',items:[{xtype:'selectfield',itemId:'options',reference:'options',width:144,picker:'floated',matchFieldWidth:!1,placeholder:'请选择...'},{xtype:'container',layout:'center',padding:2,items:[{xtype:'label',html:':'}]},{flex:1,xtype:'textfield',itemId:'valuefield',reference:'valuefield',bind:'{currentValue}',triggers:{search:{type:'search'}}}]},{xtype:'container',itemId:'criterias'}],onSpecialkey:function(b,a){console.log('onEnterKey',this,b);var c=this;if(a.getKey()==a.ENTER){c.doQuery()}},initialize:function(){this.callParent(arguments);var a=this,d=a.child('#fieldcontainer'),g=d.child('#options'),b=a.child('#criterias');var i=d.child('#valuefield');var f=i.getTriggers();var h=f.search;h.setHandler(a.doQuery.bind(a));var c=a.getViewModel();var e=function(){this.publishState('text',null);this.up('container').setHidden(!0)};console.log(c);a.mon(g,'change',function(m,d,f){c.set('currentValue',null);var j;var n=m.getSelection();var o=n.get(m.getDisplayField());var k=a.handlerSpecialKey(d);var l;j=k.fieldName;d=k.itemId;if(f){l=a.handlerSpecialKey(f);f=l.itemId}var h=b.child('#'+d),i=b.child('#'+f);if(!Ext.isEmpty(i)){console.log('清除bind');i.setBind({hidden:null});i.child('chip').setBind({text:null})}if(Ext.isEmpty(h)){var g=Ext.create({xtype:'container',layout:'hbox',align:'center',itemId:d,fieldName:j,bind:{hidden:'{!currentValue}'},items:[{xtype:'container',html:o+' : '},{xtype:'chip',closable:!0,closeHandler:e,bind:{text:'{currentValue}'}}]});b.add(g)}else {var g=h.child('chip');var p=g.getText();c.set('currentValue',p);h.setBind({hidden:'{!currentValue}'});g.setBind('{currentValue}')}})},setFields:function(c){var a=this,b=[];var d=a.child('#fieldcontainer');var b=d.child('#options');a.suspendLayout=!0;b.setOptions(c);a.suspendLayout=!1},getStore:function(){return this.store},getValues:function(){var c=this,b=c.child('#criterias');var a={};b.getItems().each(function(b){var c=b.child('chip');if(!b.isHidden()){a[b.fieldName]=c.getText()}});return a},handlerSpecialKey:function(b){var a={};var c={AS:" AS ",as:" as "};if(b.lastIndexOf(c.AS)!=-1){var d=b.split(c.AS);a.fieldName=d[0].trim();a.itemId=d[1].trim();return a}else if(b.lastIndexOf(c.as)!=-1){var e=b.split(c.as);a.fieldName=e[0].trim();a.itemId=e[1].trim();return a}else {a.fieldName=b;a.itemId=b;return a}},doQuery:function(d){console.log('doQuery...............',d);var a=this,c=a.getStore(),b=a.getValues();a.fireEvent('query',b);c.loadPage(1)}});Ext.define('Rs.ext.telescope.view.TelescopeGrid',{extend:'Ext.grid.Grid',plugins:{pagingtoolbar:!0}});Ext.define('Rs.ext.telescope.view.TelescopePanel',{extend:'Ext.Dialog',requires:['Rs.ext.telescope.store.TeleStore','Rs.ext.telescope.store.TeleMetaStore','Rs.ext.telescope.view.TelescopeForm','Rs.ext.telescope.view.TelescopeGrid'],hidden:!0,title:'望远镜',width:'85%',height:420,minHeight:280,layout:'vbox',closable:!0,closeAction:'hide',maximizable:!0,shadow:!1,draggable:!1,hideAnimation:!1,showAnimation:!1,restoreAnimation:!1,maximizeAnimation:!1,embeded:!1,config:{progCode:'',gridConfig:{}},privates:{conditions:''},setConditions:function(a){var b=this;b.conditions=a},createStore:function(d){var c=this,a,b=[];d.each(function(c){var a=c.get('field_name'),e=a.split('.').pop();b.push({name:a,mapping:e.toUpperCase()})});a=Ext.create('Rs.ext.telescope.store.TeleStore',{fields:b});c.store=a;a.on(c.getStoreListeners(a));return a},createColumns:function(b){var c=this,a=[];b.each(function(c){a.push({minWidth:100,text:c.get('desc_zh'),dataIndex:c.get('field_name'),hidden:c.get('is_hidden')=='Y'})});a=c.initColumns(a);console.log(a,"<======");return a},initColumns:function(a){var b=this;a=[{locked:!0,xtype:'rownumberer'}].concat(b.mergeColumns(a)||[]);b.afterMergeColumns(a);return a},mergeColumns:function(d){var e=this,a=[],c={},b=e.getGridConfig()||{};if(Ext.isArray(b.columns)){Ext.each(d,function(a){c[a.dataIndex]=a});Ext.each(b.columns,function(b){var e=b.dataIndex;a.push(Ext.apply(c[e],b))})}else {a=d}console.log(a.length,'columns===>',a);return a},afterMergeColumns:function(b){var c=this,a=[];Ext.each(b,function(c){var d=c.dataIndex;if(!c.hidden&&d){a.push(d)}});console.log('displayCols:',a);c.displayColumns=a},createFields:function(b){var a=[];b.each(function(c){a.push({text:c.get('desc_zh'),value:c.get('field_name')})});return a},createSelModel:function(){var b=this,a=b.multiSelect?{mode:'multi',checkbox:!0,checkboxColumnIndex:1}:{mode:'single',checkbox:!1,toggleOnClick:!1};console.log('multiSelect====>',a);return a},createGrid:function(e,d){var b=this,c=b.createSelModel();var a=Ext.create('Rs.ext.telescope.view.TelescopeGrid',{flex:1,store:e,columns:d,selectable:c});b.initGrid(a);return a},initGrid:function(b){var c=this,a=b.getSelectable();a.getSelection().refresh=Ext.emptyFn},createForm:function(c,b){var d=this,a=Ext.create('Rs.ext.telescope.view.TelescopeForm',{animCollapse:!1});a.store=c;a.setFields(b);a=d.initForm(a);return a},initForm:function(a){var b=this;a.on('query',b.onFormQuery,b);return a},onFormQuery:function(b){var c=this,a=[];Ext.iterate(b,function(d,c){if(!Ext.isEmpty(c)){a.push(d+" like '"+c+"%'")}});c.setConditions(a.join(' and '))},resetForm:function(){var a=this;a.form.reset()},initialize:function(){this.callParent(arguments);var a=this,b=a.getProgCode();var c=a.meta=Ext.create('Rs.ext.telescope.store.TeleMetaStore',{prog_code:b});var d=function(){var d=this,c=a.form,b=c.isHidden();c[b?'show':'hide']();d.setType(b?'up':'down')};c.load({params:{prog_code:b},callback:function(m){var e=c.first();if(Ext.isEmpty(e)){Ext.raise('望远镜服务异常, 请检查望远镜后台服务!')}var b,k,f;var g=e.details();if(!Ext.isEmpty(g)){b=a.createStore(g);k=a.createColumns(g);f=a.createGrid(b,k);a.relayEvents(b,['load'],'store-');a.relayEvents(f,['deselect','select'],'grid-')}var i,h,l=e.getHead(),j=e.criterias();if(!Ext.isEmpty(j)){h=a.createFields(j)}if(!Ext.isEmpty(h)){a.addTool({type:'up',handler:d})}i=a.createForm(b,h);if(!Ext.isEmpty(l)){a.setTitle(l.get('prog_name')||'')}a.form=i;a.grid=f;a.add([i,f]);b.loadPage(1)}})},refresh:function(){var b=this,a=b.store;if(a&&!a.isLoading()){a.loadPage(1)}},getStoreListeners:function(b){var a=this;return {beforeload:a.onBeforeload,scope:a}},onBeforeload:function(f,c){var b=this,a=b.conditions,d=b.getProgCode(),e=c.getParams();selectable=b.grid.getSelectable();selectable.deselectAll(!0);console.log('beforeload...',b,d);a=Ext.valueFrom(a,' 1 = 1 ');a=b.buildProgCondtion(a);c.setParams(Ext.apply({},{prog_code:d,prog_condition:a},e))},buildProgCondtion:Ext.identityFn});Ext.define('Rs.ext.telescope.Telescope',{extend:'Ext.field.Text',alias:'widget.telescope',requires:['Rs.ext.telescope.view.TelescopePanel'],isTelescope:!0,matchFieldWidth:!1,config:{progCode:null,buildProgCondtion:Ext.identityFn,displayField:'',valueField:'',multiSelect:!1,separator:',',gridConfig:{},lastSelection:[]},type:'floated',triggers:{expand:{type:'expand'}},internelId:'telescope-model-id',selection:[],setSelection:function(b){var c=this,a=[];Ext.each(b,function(c){c.isModel&&a.push(c)});c.selection=a},getSelection:function(){var a=this;return a.selection},initialize:function(){var a=this;a.callParent();a.cached=Ext.create('Ext.util.Collection',{keyFn:function(b){return b[a.internelId]}});console.log(a.cached.getKey)},setValue:function(b){var a=this,d=[],c=[],e=a.separator;if(Ext.isArray(b)){var g=b;Ext.each(g,function(e){e=a.doBeforeSetValue(e);d.push(e[0]);c.push(e[1])});console.log(d,c);a.callParent([d.join(e)]);a.inputElement.dom.value=c.join(e)}else {b=Ext.isEmpty(b)?[]:[b];return a.setValue(b)}var f=a.getSelection();a.setSelection(b);a.setLastSelection(f)},doBeforeSetValue:function(a){var b=this;if(Ext.isObject(a)&&a.isModel){var d=b.getValueField(),c=b.getDisplayField();return [a.get(d),a.get(c)]}else {return [a,a]}},onExpandTap:function(e){console.log(this,arguments);var a=this,c=a.cached,d=a.getDialog(),b=a.getSelection();console.log('selection:',b);c.removeAll().add(b);a.highlightSelection(b);d.show().refresh()},getDialog:function(){var a=this,b=a.dialog;if(!b){var f=a.getProgCode(),c=a.getGridConfig(),e=a.getMultiSelect(),d=a.getBuildProgCondtion();console.log('gridConfig====>',c);b=Ext.create('Rs.ext.telescope.view.TelescopePanel',{id:a.id+'-dialog',hidden:!0,embeded:!0,floating:!0,pickerField:a,progCode:f,gridConfig:c,multiSelect:e,buildProgCondtion:d.bind(a)});a.initDialog(b);a.dialog=b}return b},initDialog:function(b){var a=this;b.on({scope:a,'store-load':a.onStoreLoad,'grid-select':a.onSelect,'grid-deselect':a.onDeselect});if(!a.getMultiSelect()){b.on('grid-select',a.onSingleSelect,a)}return b},identifier:function(c){var d=this,b=d.dialog,a=[];Ext.each(b.displayColumns,function(b){a.push(c.get(b))});return a.join()},onSelect:function(e,b){console.log('onSelect:',arguments);var c=this,a=c.cached,d=c.identifier(b);if(!a.containsKey(d)){b[c.internelId]=d;a.add(b)}console.log("cached-onSelect===",a.getCount(),":",a.getRange())},onDeselect:function(e,b){console.log('onDeselect:',arguments);var c=this,a=c.cached,d=c.identifier(b);if(a.containsKey(d)){b[c.internelId]=d;a.remove(b)}console.log("cached-onDeselect===",a.getCount(),":",a.getRange())},onStoreLoad:function(e,c){console.log('----->');var a=this,b=[],d=a.cached;Ext.each(c,function(f){var g=a.identifier(f);if(d.containsKey(g)){f[a.internelId]=g;b.push(f)}});if(!Ext.isEmpty(b)){a.syncSelection(b);a.highlightSelection(b)}},syncSelection:function(c){var b=this,a=b.cached;a.add(c);b.setSelection(a.getRange())},highlightSelection:function(b){var c=this,a=c.dialog.grid;if(Ext.isEmpty(b)){b=!1}if(a&&a.rendered){a.suspendEvent('select','deselect');a.setSelection(b);a.resumeEvent('select','deselect')}},onSingleSelect:function(c,b){var a=this,e=a.getValueField(),d=a.getDisplayField();if(a.fireEvent('beforeselect',a,b)!=!1){a.fireEvent('select',a,b,c);a.setValue(b);a.collapse()}},collapse:function(){var b=this,a=b.dialog;a.hide()},doQuery:function(b){var a=this,c,g=a.getValueField(),f=a.getDisplayField(),d,e=[];a.expand();c=a.dialog;console.log('rawValue:==>',b);if(!Ext.isEmpty(b)){Ext.each([g,f],function(a){e.push(a+" like '"+b+"%'")});d='('+e.join(' or ')+')'}c.setConditions(d);c.refresh()}});