Ext.define('Rs.ext.overrides.Component',{override:'Ext.Component',initComponent:function(){var a=this;a.callParent();a.initLanguage(Rs.LANG)},translations:{},initLanguage:function(b){var a=this;if(a.isContainer){return}a.translate(b)},translate:function(b){var a=this;a.statics().doTranslation(a,a.translations,b)}},function(b){var a=[{name:'button',func:'setText'},{name:'field',func:'setFieldLabel'},{name:'fieldcontainer',func:'setFieldLabel'},{name:'panel',func:'setTitle'},{name:'gridcolumn',func:'setText'}];b.addStatics({getDecimals:function(c){var a=Rs.DECIMALS||{};return a[c]},getLanguage:function(c){var a=Rs.MULTILANGUAGE||{};return a[c]},doTranslation:function(c,f,g,d){var e=d?'#':'';Ext.iterate(f,function(i,j){var h=i==''?c:c.down(e+i);if(!Ext.isEmpty(h)){Ext.each(a,function(a){if(h.isXType(a.name)){h[a.func](j[g]);return !1}})}})}})});Ext.define('Rs.ext.overrides.data.Model',{override:'Ext.data.Model'});Ext.define('Rs.ext.overrides.data.Store',{override:'Ext.data.Store',checkBeforeLoad:!0});Ext.define('Rs.ext.overrides.panel.Panel',{override:'Ext.panel.Panel',initComponent:function(){var a=this;a.callParent();a.initPanelLanguage();a.initPanelDecimals()},initPanelLanguage:function(b){var a=this;a.translate(Rs.LANG)},translate:function(c){var a=this,b=Ext.Component.getLanguage(a.id);Ext.Component.doTranslation(a,b,c,!0);a.callParent(arguments)},initPanelDecimals:function(){var a=this,b=Ext.Component.getDecimals(a.id);Ext.iterate(b,function(d,c){var b=a.down('#'+d);b&&(b.decimalPrecision=c)})}});Ext.define('Rs.ext.overrides.form.field.Text',{override:'Ext.form.field.Text',maskRe:new RegExp('[^\']'),stripCharsRe:new RegExp('[\']','gi')});Ext.define('Rs.ext.overrides.grid.CellEditor',{override:'Ext.grid.CellEditor',onSpecialKey:function(h,a,e){var b=this,c=a.getKey();if(c===a.ENTER&&a.shiftKey==!1){a.ENTER=9;a.keyCode=9;a.event.code='Tab';a.event.key='Tab'}var f=b.completeOnEnter&&c===a.ENTER&&(!e||!e.fromBoundList),d=b.cancelOnEsc&&c===a.ESC,g=b.editingPlugin.view;if(f||d){a.stopEvent();if(d){b.focusLeaveAction='cancelEdit'}g.ownerGrid.setActionableMode(!1)}}});Ext.define('Rs.ext.overrides.grid.column.Number',{override:'Ext.grid.column.Number',afterRender:function(){var a=this;a.callParent(arguments);var d=a.up('grid').id,e=a.itemId;var c=Rs.DECIMALS[d];if(!Ext.isEmpty(c)){var b=a.format;b=b.split('.')[0]+'.'+Ext.String.leftPad('',c[e]||2,'0');a.format=b;console.log('====>',b)}}});Ext.define('Rs.ext.window.MessageAlert',{extend:'Ext.window.MessageBox',alias:'widget.msgalert',closable:!1,initComponent:function(){this.callParent()},getErrorMsg:function(c){var b={},a;b.sql="select err_code,err_des_c,err_des_e from sys_err_info where err_code = '"+c+"'";Ext.Ajax.request({url:'/base/sql/excute',jsonData:b,async:!1,method:'POST',success:function(d,e){var b=Ext.decode(d.responseText);if(b.success){a=b.data[0]}else {Ext.Msg.alert("系统提示",b.mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}});return a},messageAlert:function(a,l,k){var b=this,i;if(Rs.LANG==="en"){i="ERR_DES_E"}else if(Rs.LANG==="zh"){i="ERR_DES_C"}else {i="ERR_DES_C"}if(!Ext.isEmpty(a.stateCode)){var j=b.getErrorMsg(a.stateCode);Ext.Object.each(j,function(c,b,d){if(i===c){a.message=b}})}if(Ext.isEmpty(a.isBackOrFront)){a.isBackOrFront=!1}if(!Ext.isEmpty(a.extraMsg)){if(a.isBackOrFront){a.message+=a.extraMsg}else {a.message=a.extraMsg+a.message}}if(Ext.isEmpty(a.title)){a.title="提示"}if(Ext.isEmpty(a.width)){a.width=this.minWidth}if(Ext.isEmpty(a.height)){a.height=this.minHeight}if(Ext.isEmpty(a.autoCloseDistance)){a.autoCloseDistance=500}if(Ext.isEmpty(a.isAutoCloseDistance)){a.isAutoCloseDistance=!1}if(!(Ext.isEmpty(a.closable))){b.closable=a.closable}if(Ext.isEmpty(a.modal)){a.modal=!1}if(Ext.isEmpty(a.time)){a.time=5}if(Ext.isEmpty(a.autoTimeClose)){a.autoTimeClose=!1}if(Ext.isString(a.title)){a.title={title:a.title,height:a.height,width:a.width,message:a.message,buttons:a.buttons,buttonText:a.buttonText,fn:l,modal:a.modal,scope:k,minWidth:this.minWidth,minHeight:this.minHeight}}if(a.autoTimeClose){var e={taskFlag:1,run:function(){e.taskFlag++;b.show(a.title);if(e.taskFlag>a.time){b.close()}},interval:1000,repeat:a.time};var g=new Ext.util.TaskRunner();g.start(e);var h=window.top,f=0,c=0,d=0;if(!Ext.isEmpty(h)){if(a.isAutoCloseDistance){h.onmousemove=function(h){if(h.movementX<0){c-=h.movementX}else {c+=h.movementX}if(h.movementY<0){d-=h.movementY}else {d+=h.movementY}f=c*c+d*d;if(c>=a.autoCloseDistance||d>=a.autoCloseDistance||f>=(a.autoCloseDistance*a.autoCloseDistance)){c=0;d=0;f=0;if(!Ext.isEmpty(e)){g.stop(e)}b.close()}}}}else {Ext.Msg.alert("无法捕获外层窗口异常","按光标移动距离自动关闭方法失效")}}else {b.show(a.title);var h=window.top,f=0,c=0,d=0;if(!Ext.isEmpty(h)){if(a.isAutoCloseDistance){h.onmousemove=function(h){if(h.movementX<0){c-=h.movementX}else {c+=h.movementX}if(h.movementY<0){d-=h.movementY}else {d+=h.movementY}f=c*c+d*d;if(c>=a.autoCloseDistance||d>=a.autoCloseDistance||f>=(a.autoCloseDistance*a.autoCloseDistance)){c=0;d=0;f=0;if(!Ext.isEmpty(e)){g.stop(e)}b.close()}}}}else {Ext.Msg.alert("无法捕获外层窗口异常","按光标移动距离自动关闭方法失效")}}if(Ext.isEmpty(b.hasFocusLeave)){b.on('focusleave',function(){b.hasFocusLeave=!0;if(!Ext.isEmpty(e)){g.stop(e)}b.close()})}if(!Ext.isEmpty(b.getEl())){b.getEl().on({keydown:function(){if(!Ext.isEmpty(e)){g.stop(e)}b.close()}})}}},function(a){Ext.onInternalReady(function(){Rs.ext.window.MessageBox=Rs.Msg=new a()})});Ext.define('Rs.ext.util.Marker',{singleton:!0,alternateClassName:['Rs.Marker'],getErrorMsg:function(c){var b={},a={};b.sql="select err_code,err_des_c as ZH,err_des_e as EN from sys_err_info where err_code = '"+c+"'";Ext.Ajax.request({url:'/base/sql/excute',jsonData:b,async:!1,method:'POST',success:function(d,e){var b=Ext.decode(d.responseText);if(b.success){a=b.data[0]}else {Ext.Msg.alert("系统提示",b.mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}});return a},showMsg:function(e){var d=this,a,b=[],c=d.getWin();c.show();Ext.each(e,function(c){a=d.getErrorMsg(c);b.push({code:c,msg:a[Rs.LANG.toUpperCase()]})});c.store.setData(b)},getWin:function(){var b=this,a=b.msgWindow;if(a){return a}var c=Ext.create('Ext.data.JsonStore',{fields:['code','msg']});a=Ext.create('Ext.window.Window',{width:420,height:280,layout:'fit',closable:!1,closeAction:'hide',listeners:{'focusleave':function(a){a.hide()},'hide':function(){Ext.defer(b.focusFirst,10,b)}},items:[{xtype:'grid',border:!1,header:!1,store:c,columns:[{width:50,dataIndex:'code'},{flex:1,dataIndex:'msg'}]}]});a.store=c;b.msgWindow=a;return a},mark:function(b){var a=this,c={};a.records={},a.panelIds=[],a.markerEls={};if(!Ext.isArray(b)){b=[b]}Ext.each(b,function(g,j){var e,h=g.panelId,d=Ext.getCmp(h),f=g.errArr,i=g.errorMsg;Ext.each(i,function(a){c[a]=a});if(!d){return}a.panelIds.push(d);a.unmark(d);if(d.isXType('grid')){e=a.getMarkElsOfGrid(d,f)}else {e=a.getMarkElsOfCard(d,f)}a.markerEls[h]=e;d.invalidEls=e;a.records[h]=f;a.markStyle(e)});var d=Ext.Object.getKeys(c);if(Ext.isEmpty(d)){Ext.defer(a.focusFirst,10,a)}else {a.showMsg(d)}},focusFirst:function(){var b=this,c,a;Ext.each(b.panelIds,function(d){c=d.getId();a=b.markerEls[c];if(a.getCount()){b.focusOnEl(d,a.first());return !1}})},focusOnEl:function(a,b){var c=this;if(!Ext.isEmpty(b)){if(a.isXType('grid')){c.focusOfGrid(a,b)}else {c.focusOfCard(a,b)}}},focusOfGrid:function(a,i){var k=this,b,e=a.getView(),d=a.getStore(),g=k.records[a.id],j=d.getModel().idProperty,h=e.getHeaderByCell(i),c=d.getById(g[0][j]),f=a.getPlugin('cellediting');if(c){b=e.getPosition(c,h);f.startEditByPosition(b)}},focusOfCard:function(b,a){a.focus()},getMarkElsOfGrid:function(e,g){var b,c,a,h=e.getView(),d=e.getStore(),i=d.getModel().idProperty,f=new Ext.CompositeElementLite(null,!0);Ext.each(g,function(j){a=[];b=d.getById(j[i]);if(b){c=Ext.fly(h.getRow(b));if(c){Ext.each(j.checkField,function(b){a.push('td[data-columnid='+b+']')});f.add(c.select(a.join(',')))}}});return f},getMarkElsOfCard:function(c,b){var a=new Ext.CompositeElementLite(null,!0);Ext.each(b,function(d){Ext.each(d.checkField,function(e){a.add(c.down('#'+e).inputEl)})});return a},markStyle:function(a){a.applyStyles({background:'#ffdfd7'})},unmark:function(a){var b=a.invalidEls;if(!Ext.isEmpty(b)){b.applyStyles({background:'none'})}a.invalidEls=null}});(function(){Ext.apply(Ext.ns('Rs'),{LANG:'zh',DECIMALS:{}});Ext.syncRequire(['Rs.ext.overrides.Component','Rs.ext.overrides.form.field.Text','Rs.ext.overrides.data.Store','Rs.ext.overrides.data.Model','Rs.ext.overrides.panel.Panel','Rs.ext.overrides.grid.CellEditor','Rs.ext.overrides.grid.column.Number','Rs.ext.window.MessageAlert','Rs.ext.util.Marker']);var b=Ext.manifest,a=b.locale||'zh_CN';Ext.Loader.loadScript({url:'/packages/local/rs-ext-classic/locale/'+a+'/rs-ext-locale-'+a+'.js'})}());Ext.define('Rs.ext.button.ExceptionButton',{alias:'widget.exception-button',extend:'Ext.button.Button',configs:{exceptionHandler:function(){},pageCode:'',queryUrl:'',queryProxyType:'',displayFields:'',buttonText:''},buttonIconCls:'exception-button',queryUrl:'',queryProxyType:'rest',pageCode:'',displayFields:'excInfo',isButton:!0,buttonText:'例外信息',initComponent:function(){var a=this;a.callParent();a.initExceptionPanel();a.on('afterrender',function(a){a.setText(a.buttonText);a.setIconCls(a.buttonIconCls);a.setHandler(function(){a.exceptionHandler();a.exceptionWindow.show()})})},initExceptionPanel:function(){var a=this,e=Ext.create('Ext.data.Model',{requires:['Ext.data.field.Field'],fields:[{name:a.displayFields}]}),d=Ext.create('Ext.data.Store',{storeId:'exceptionStore',autoLoad:!0,model:e,proxy:{type:a.queryProxyType,url:a.queryUrl,extraParams:{pagCode:a.pageCode,companyCode:'00'},reader:{type:'json',rootProperty:'data.records'}}}),b=Ext.create('Ext.window.Window',{title:'例外信息',closable:!1,width:750,height:208,layout:'fit',alignTarget:a,defaultAlign:'tl-bl',listeners:{'focusleave':function(a){a.hide()}}}),c=Ext.create('Ext.grid.Panel',{scrollable:!0,store:d,height:'100%',width:'100%',columns:[{xtype:'gridcolumn',dataIndex:a.displayFields,width:'100%'}]});b.add(c);a.exceptionWindow=b;a.store=d;a.exceptionPanel=c},exceptionHandler:function(){}});Ext.define('Rs.ext.button.PrefButton',{extend:'Ext.button.Button',alias:'widget.pref-button',iconCls:'rs-icon-cog',initComponent:function(){var a=this;a.callParent();a.on('click',a.statics().showPrefHandler)},translations:{'':{zh:'页面设置',en:'Page Settings'}}},function(b){var c=function(d,e){var f=d.valueField,c=e.get(f),a=[];Ext.iterate(Rs.MULTILANGUAGE,function(f,g){var c=Ext.getCmp(f);c&&a.push(c)});Ext.each(a,function(a){a.translate(c)});Rs.LANG=c};var a=Ext.create('Ext.window.Window',{closable:!1,translations:{'':{zh:'页面设置',en:'Preference Settings'},'#lang':{zh:'语言',en:'Language'},'#pagesize':{zh:'当页数据',en:'Page Size'},'#test':{zh:'条',en:'Items'},'#conditions':{zh:'查询条件',en:'Query Conditions'},'#save':{zh:'保存页面偏好',en:'Save'},'#ok':{zh:'确定',en:'OK'}},listeners:{'focusleave':function(a){a.hide()}},items:[{xtype:'form',border:!1,bodyPadding:20,layout:{type:'vbox',pack:'center',align:'center'},defaults:{width:280,labelAlign:'right'},fbar:['->',{type:'button',itemId:'ok',handler:function(){a.hide()}},'->'],items:[{xtype:'combobox',itemId:'lang',value:Rs.LANG,store:[['zh','中文'],['en','English']],listeners:{'select':c}}]}]});b.addStatics({showPrefHandler:function(c){a.btn=c;a.show()}})});Ext.define('Rs.ext.button.RsButton',{extend:'Ext.button.Button',alias:'widget.rsbutton',initComponent:function(){var a=this;tempStyle={};tempStyle.background='linear-gradient(#e4f3ff 45%,#c3d9f3 50%,#c9dffa 90%,#d7ecff 95%)';tempStyle.borderColor='#aac8f1';a.style=Ext.Object.merge(tempStyle,a.style);a.addCls(Ext.baseCSSPrefix+'unselectable');a.callParent();if(a.menu){a.split=!0;a.setMenu(a.menu,!1,!0)}if(a.url){a.href=a.url}a.configuredWithPreventDefault=a.hasOwnProperty('preventDefault');if(a.href&&!a.configuredWithPreventDefault){a.preventDefault=!1}if(Ext.isString(a.toggleGroup)&&a.toggleGroup!==''){a.enableToggle=!0}if(a.html&&!a.text){a.text=a.html;delete a.html}},onMouseOver:function(b){var a=this;a.el.dom.style.background='linear-gradient(#F4FAFF 45%,#D2E2F7 50%,#D2E2F7 90%,#F4FAFF 95%)';a.el.dom.style.borderColor='#7EA9E2';if(!a.disabled&&!b.within(a.el,!0,!0)){a.onMouseEnter(b)}},onMouseOut:function(b){var a=this;a.el.dom.style.background='linear-gradient(#e4f3ff 45%,#c3d9f3 50%,#c9dffa 90%,#d7ecff 95%)';a.el.dom.style.borderColor='#aac8f1';if(!b.within(a.el,!0,!0)){if(a.overMenuTrigger){a.onMenuTriggerOut(b)}a.onMouseLeave(b)}},onMouseDown:function(b){var a=this,c;a.el.dom.style.background='linear-gradient(#BFD2E6 45%,#8DC0F5 50%,#98C5F5 90%,#C9DDF6 95%)';a.el.dom.style.borderColor='#99BBE8';if(Ext.isIE||Ext.isEdge||b.pointerType==='touch'){if(a.deferFocusTimer){Ext.undefer(a.deferFocusTimer)}c=Ext.Element.getActiveElement();a.deferFocusTimer=Ext.defer(function(){var d;a.deferFocusTimer=null;if(a.destroying||a.destroyed||(Ext.Element.getActiveElement()!==c)||!a.canFocus()){return}d=a.getFocusEl();if(d&&!b.defaultPrevented){d.focus()}},1)}if(!a.disabled&&b.button===0){Ext.button.Manager.onButtonMousedown(a,b);a.removeCls(a._arrowPressedCls);a.addCls(a._pressedCls)}},onMouseUp:function(b){var a=this;a.el.dom.style.background='linear-gradient(#F4FAFF 45%,#D2E2F7 50%,#D2E2F7 90%,#F4FAFF 95%)';a.el.dom.style.borderColor='#aac8f1';if(!a.destroyed&&b.button===0){if(!a.pressed){a.removeCls(a._pressedCls)}}}});Ext.define('Rs.ext.data.FrontCachedStore',{extend:'Ext.data.Store',alias:'store.frontcachedstore',configs:{extraParams:{},gridPanelId:'',isCacheDataToFront:!1,paramsFormStrict:!0},extraParams:{},isFrontCachedStore:!0,paramsFormStrict:!0,paramKey:"params",isCacheDataToFront:!1,isDynamicStore:!0,forceChangeStore:!1,constructor:function(b){var a=this,d;if(b){if(b.buffered){return new Ext.data['BufferedStore'](b)}}a.callParent([b]);d=a.inlineData;if(d){delete a.inlineData;a.loadInlineData(d)}var c=a.getProxy();a.initCachedStore();a.cachedStore.on('load',function(a){var c=[];a.totalCount=a.queryStaticDataCondintion["noRelatedDataTotalCount"];if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===a.currentPage&&d["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){if(d["queryRecord"].phantom){a.totalCount=e["data"].length}else {a.totalCount=e["relatedDataTotalCount"]}}if(!Ext.isEmpty(a.getDynamicStore().removedRecord)){Ext.each(a.getDynamicStore().removedRecord,function(e,i,h){if(d["queryRecord"]===e){c.push(d)}})}});Ext.each(c,function(c){Ext.Array.remove(a.relationStaticDataArry,c)})}});a.cachedStore.on('add',function(c,e,d){if(d===0){c.totalCount=1}a.synchroData(c,c)});a.cachedStore.on('remove',function(c,d,e){a.synchroData(c,c)});a.cachedStore.onAfter('remove',function(g,d,f,e){var c=Ext.getCmp(a.gridPanelId);if(!Ext.Object.isEmpty(c.relationGridStoreSet)){Ext.Object.eachValue(c.relationGridStoreSet,function(a){a.removedRecord=d})}});a.on('beforeload',function(g){var f={},d,e;d=c.getConfig("extraParams");if(!Ext.isEmpty(d)){if(!Ext.isEmpty(d[a.paramKey])){if(!Ext.isEmpty(a.queryConditionField)&&!Ext.isString(d[a.paramKey])){e=Ext.Object.merge(d,a.queryConditionField)}else if(!Ext.isEmpty(a.queryConditionField)&&Ext.isString(d[a.paramKey])){e=Ext.Object.merge(Ext.decode(d[a.paramKey]),a.queryConditionField)}else {if(Ext.isString(d[a.paramKey])){e=Ext.decode(d[a.paramKey])}else {e=d[a.paramKey]}}}else {if(!Ext.isEmpty(a.queryConditionField)){e=Ext.Object.merge(d,a.queryConditionField)}else {e=d}}Ext.Object.merge(e,g.extraParams);if(a.paramsFormStrict&&!Ext.Object.isEmpty(e)){f[a.paramKey]=Ext.encode(e)}else {f=e}}if(c.type!=="memory"){c.setConfig("extraParams",f)}});a.on('clear',function(c){a.cachedDataAllClear()});a.on('add',function(e,c,d){a.synchroData(a.getCachedStore(),a)});a.on('remove',function(e,c,d){a.synchroData(a.getCachedStore(),a)});a.onAfter('remove',function(d,c,f,e){var a=Ext.getCmp(d.gridPanelId);if(!Ext.Object.isEmpty(a.relationGridStoreSet)){Ext.Object.eachValue(a.relationGridStoreSet,function(a){a.removedRecord=c})}});a.on('load',function(c){var e=c.getCachedStore().getRelationStaticDataArry(),d=[];if(!Ext.isEmpty(e)&&!Ext.isEmpty(c.removedRecord)){Ext.each(e,function(a,g,f){var e=a.cachedPageData;Ext.each(c.removedRecord,function(e,i,h){if(a["queryRecord"]===e){d.push(a)}})});Ext.each(d,function(a){Ext.Array.remove(c.relationStaticDataArry,a)})}a.synchroData(a.getCachedStore(),a)})},setExtraParams:function(a){var b=this;b.extraParams=a},getExtraParams:function(){var a=this;return a.obj},loadPage:function(c,b){var a=this,e=a.getPageSize(),d=Ext.getCmp(a.gridPanelId);a.currentPage=c;if(Ext.isEmpty(b)){b={newRecord:!1}}if((b.newRecord&&(!a.isHaveCachData(c)))||(a.isHaveCachData(c)&&a.isCacheDataToFront&&(!a.forceChangeStore))){d.setStore(a.cachedStore);a.cachedStore.loadPage(c,b)}else {d.setStore(a);b=Ext.apply({page:c,start:(c-1)*e,limit:e,addRecords:!a.getClearOnPageLoad()},b);a.read(b);a.forceChangeStore=!1}},cachedLoadPage:function(b,c){var a=this,e=a.getPageSize(),f=Ext.getCmp(a.dynamicStore.gridPanelId),d;if(Ext.isEmpty(c)){c={newRecord:!1}}if((c.newRecord&&(!a.isHaveCachData(b)))||(a.isHaveCachData(b)&&a.isCacheDataToFront&&(!a.forceChangeStore))){a.removeAll();if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(e){var f=e.cachedPageData;if(e["currentPage"]===b&&e["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){d=f.data}})}else {d=a.noRelationStaticDataObj[b]}a.currentPage=b;a.setData(d);c=Ext.apply({page:b,start:(b-1)*e,limit:e,addRecords:!0},c);a.read(c)}else {a.forceChangeStore=!1;f.setStore(a.dynamicStore);a.dynamicStore.loadPage(b,c)}},isHaveCachData:function(c){var a=this,b=!1;if(a.isDynamicStore){if(!Ext.isEmpty(a.cachedStore.relationStaticDataArry)){Ext.each(a.cachedStore.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===c&&d["queryRecord"]===a.cachedStore.queryStaticDataCondintion["queryRecord"]){b=!0}})}if(!Ext.isEmpty(a.cachedStore.noRelationStaticDataObj[c])){b=!0}}if(a.isCachedStore){if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(d,g,f){var e=d.cachedPageData;if(d["currentPage"]===c&&d["queryRecord"]===a.queryStaticDataCondintion["queryRecord"]){b=!0}})}if(!Ext.isEmpty(a.noRelationStaticDataObj)){if(!Ext.isEmpty(a.noRelationStaticDataObj[c])){b=!0}}}return b},initCachedStore:function(){var a=this,b=Ext.create('Ext.data.Store',{id:a.id+"Cached",dynamicStore:a,isFrontCachedStore:!0,isCachedStore:!0,pageSize:a.getPageSize(),noRelationStaticDataObj:{},relationStaticDataArry:[],isCacheDataToFront:a.isCacheDataToFront,model:a.getModel(),queryStaticDataCondintion:{},proxy:{type:'memory',enablePaging:!0,reader:{type:'json'}},loadPage:a.cachedLoadPage,isHaveCachData:a.isHaveCachData,getCachedStore:a.getCachedStore,getDynamicStore:a.getDynamicStore,getRelationStaticDataArry:function(){return a.getCachedStore().relationStaticDataArry},getNoRelationStaticDataObj:function(){return a.getCachedStore().noRelationStaticDataObj}});a.cachedStore=b},getCachedStore:function(){var a=this;if(a.isDynamicStore){return a.cachedStore}return a},getDynamicStore:function(){var a=this;if(a.isCachedStore){return a.dynamicStore}return a},cachedDataAllClear:function(){var a=this;if(!Ext.isEmpty(a.getCachedStore().getRelationStaticDataArry())){a.getCachedStore().getRelationStaticDataArry().length=0}if(!Ext.isEmpty(a.getCachedStore().getNoRelationStaticDataObj())){Ext.Object.clear(a.getCachedStore().getNoRelationStaticDataObj())}},synchroData:function(a,b){var d=!0;a.queryStaticDataCondintion["noRelatedDataTotalCount"]=b.totalCount;if(b.totalCount===0){a.queryStaticDataCondintion["noRelatedDataTotalCount"]=1;b.totalCount=1}a.queryStaticDataCondintion["currentPage"]=b.currentPage;if(!Ext.isEmpty(a.queryStaticDataCondintion["queryRecord"])){var e={relatedDataTotalCount:a.queryStaticDataCondintion["noRelatedDataTotalCount"],data:b.getRange()},c={currentPage:a.queryStaticDataCondintion["currentPage"],queryRecord:a.queryStaticDataCondintion["queryRecord"],cachedPageData:e};if(!Ext.isEmpty(a.relationStaticDataArry)){Ext.each(a.relationStaticDataArry,function(e,f){if(e["currentPage"]===c["currentPage"]&&e["queryRecord"]===c["queryRecord"]){d=!1;Ext.Array.replace(a.relationStaticDataArry,f,1,[c])}});if(d){a.relationStaticDataArry.push(c)}}else {a.relationStaticDataArry.push(c)}}else {a.noRelationStaticDataObj[b.currentPage]=b.getRange()}}});Ext.define('Rs.ext.data.RsStore',{extend:'Ext.data.Store',alias:'widget.rsstore',configs:{checkBeforeLoad:!0,defaultFieldValue:{}},loadPage:function(c,b){var a=this,d=a.getPageSize();if(a.checkBeforeLoad&&a.checkNeedSync()){Ext.Msg.show({title:'提示',msg:'存在未保存的数据,确定继续操作?',buttons:Ext.Msg.OKCANCEL,closable:!1,fn:function(e,f){if(e=='ok'){a.checkNeedSyncFlag=!0;a.currentPage=c;b=Ext.apply({page:c,start:(c-1)*d,limit:d,addRecords:!a.getClearOnPageLoad()},b);a.read(b);a.needsSync=undefined}else {a.checkNeedSyncFlag=''}},scope:a});return}a.checkNeedSyncFlag='';a.currentPage=c;b=Ext.apply({page:c,start:(c-1)*d,limit:d,addRecords:!a.getClearOnPageLoad()},b);a.read(b)},flushLoad:function(){var a=this,c=a.pendingLoadOptions,b;if(a.destroying||a.destroyed){return}a.clearLoadTask();if(!c){return}a.setLoadOptions(c);if(a.getRemoteSort()&&c.sorters){a.fireEvent('beforesort',a,c.sorters)}b=Ext.apply({internalScope:a,internalCallback:a.onProxyLoad,scope:a},c);a.lastOptions=b;b=a.createOperation('read',b);if(Ext.isEmpty(a.checkNeedSyncFlag)&&a.checkBeforeLoad&&a.checkNeedSync()){Ext.Msg.show({title:'提示',msg:'存在未保存的数据,确定继续操作?',buttons:Ext.Msg.OKCANCEL,closable:!1,fn:function(c,d){if(c=='ok'){a.checkNeedSyncFlag='';if(a.fireEvent('beforeload',a,b)!==!1){a.onBeforeLoad(b);a.loading=!0;if(a.hasListeners.beginload){a.fireEvent('beginload',a,b)}b.execute()}else {if(a.getAsynchronousLoad()){b.abort()}b.setCompleted()}}else {return}},scope:a})}else {a.checkNeedSyncFlag='';if(a.fireEvent('beforeload',a,b)!==!1){a.onBeforeLoad(b);a.loading=!0;if(a.hasListeners.beginload){a.fireEvent('beginload',a,b)}b.execute()}else {if(a.getAsynchronousLoad()){b.abort()}b.setCompleted()}}},checkNeedSync:function(){var a=this;modifiedRecords=a.getModifiedRecords();modifiedFlag=!1;newRecord=[];emptyCount=0;if(Ext.isEmpty(modifiedRecords)){if(a.checkDeleteRecord()){return !0}else {return !1}}else {Ext.each(modifiedRecords,function(b){if(emptyCount>0){return !0}modifiedFlag=a.checkIsEmptyRecord(b);if(!modifiedFlag){emptyCount+=1;return !0}},this);if(modifiedFlag){return !1}else {return !0}}},checkIsEmptyRecord:function(a){var c=this;emptyFlag=!0;if(a.crudState=='U'){emptyFlag=!1;return emptyFlag}if(a.crudState=='D'){emptyFlag=!0;return emptyFlag}if(c.checkDeleteRecord()){emptyFlag=!1;return emptyFlag}if(a.phantom){var b=Object.keys(a.data);defaultFields=Ext.isEmpty(c.defaultFieldValue)?'':Object.keys(c.defaultFieldValue);Ext.each(defaultFields,function(d){var c=b.indexOf(d);if(c==-1){}else {b.splice(c,1)}});for(var d=1;d<b.length;d++){if(!Ext.isEmpty(a.data[b[d]])){emptyFlag=!1;return emptyFlag}}}return emptyFlag},checkDeleteRecord:function(){var a=this;deleteFlag=!1;a.each(function(a){if(!deleteFlag){if(a.deleteFlag=='D'){deleteFlag=!0}}},this);if(deleteFlag){return !0}else {return !1}}});Ext.define('Rs.ext.field.plugin.ControlStatusPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.controlstatus',requires:'Ext.form.field.Field',configs:{panelId:'',controlObj:'',errorCode:'',tipType:''},init:function(){var b=this;if(b.config.panelId&&Ext.getCmp(b.config.panelId).isXType('form')){var a=b.config.controlObj;if(a){for(var c=0;c<a.length;c++){(function(){var e=a[c].queryStr;var h=a[c].targetValue;var g=/\[(.*?)\]/gi;var d=e.match(g);if(d&&d.length==1){var f=d[0].replace(g,"$1");Ext.getCmp(f).on('blur',function(a){var c=e.replace(d[0],a.getValue());b.formFieldsControlStatus(c,f,h)})}})()}}}},formFieldsControlStatus:function(c,a,d){var b={};b.sql=c;Ext.Ajax.request({url:'/base/sql/excute',jsonData:b,async:!1,method:'POST',success:function(f,g){var e=[];var b=Ext.decode(f.responseText);if(b.success){e=b.data}else {console.log("系统提示",b.mesg)}if(e.length<1){Ext.getCmp(a).setValue()}},failure:function(b,e){Ext.getCmp(a).setValue();console.log("系统提示","服务器未连接")}})}});Ext.define('Rs.ext.form.PagePanel',{extend:'Ext.form.Panel',alias:'widget.Pageform',alternateClassName:['Ext.PageFormPanel','Ext.form.PageFormPanel'],configs:{store:'',insertFlag:!1},layout:'anchor',bodyAriaRole:'form',basicFormConfigs:['api','baseParams','errorReader','jsonSubmit','method','paramOrder','paramsAsHash','reader','standardSubmit','timeout','trackResetOnLoad','url','waitMsgTarget','waitTitle'],initComponent:function(){var a=this;if(a.frame){a.border=!1}if(Ext.isEmpty(a.insertFlag)){a.insertFlag=!1}a.initFieldAncestor();a.callParent();a.relayEvents(a.form,['beforeaction','actionfailed','actioncomplete','validitychange','dirtychange']);if(a.pollForChanges){a.startPolling(a.pollInterval||500)}var b=a.store;if(b&&!Ext.isObject(b)&&!b.isStore&&!b.storeId){b=Ext.apply({autoDestroy:!0},b);b=a.store=Ext.data.StoreManager.lookup(b||'ext-empty-store');var d=b.model;var c=Ext.create('Ext.form.field.Text',{name:d.idProperty,hidden:!0});a.items.items.push(c);b.on('load',function(d,b,c){if(!Ext.isEmpty(b)&&b.length>0){a.page=0;a.loadRecord(b[0])}else {if(a.insertFlag){a.addNewRecord()}}})}},initItems:function(){this.callParent();this.initMonitor();this.form=this.createForm()},afterFirstLayout:function(){this.callParent(arguments);this.form.initialize()},createForm:function(){var d={},c=this.basicFormConfigs,e=c.length,b=0,a;for(;b<e;++b){a=c[b];d[a]=this[a]}return new Ext.form.Basic(this,d)},getForm:function(){return this.form},loadRecord:function(a){return this.getForm().loadRecord(a)},getRecord:function(){return this.getForm().getRecord()},updateRecord:function(a){return this.getForm().updateRecord(a)},getValues:function(d,c,a,b){return this.getForm().getValues(d,c,a,b)},isDirty:function(){return this.form.isDirty()},isValid:function(){return this.form.isValid()},reset:function(a){return this.form.reset(a)},hasInvalidField:function(){return this.form.hasInvalidField()},doDestroy:function(){this.stopPolling();this.form.destroy();this.callParent()},load:function(a){this.form.load(a)},submit:function(a){this.form.submit(a)},startPolling:function(a){this.stopPolling();this.pollTask=Ext.util.TaskManager.start({interval:a,run:this.checkChange,scope:this})},stopPolling:function(){var a=this.pollTask;if(a){Ext.util.TaskManager.stop(a,!0);this.pollTask=null}},checkChange:function(){var c=this.form.getFields().items,b,d=c.length;for(b=0;b<d;b++){c[b].checkChange()}if(this.isDirty()){var a=this.getRecord();if(Ext.isEmpty(a)){if(this.insertFlag){this.addNewRecord()}else {return !1}}this.updateRecord(this.getRecord())}else {var a=this.getRecord();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.crudState)&&!Ext.isEmpty(a.modified)){if(a.crudState==='U'){this.updateRecord(this.getRecord())}else if(a.crudState==='C'){this.updateRecord(this.getRecord())}}}},getStore:function(){return Ext.getStore(this.store)},revertModified:function(a){var b=Object.keys(a.modified);Ext.each(b,function(b){a.set(b,a.modified[b])})},addNewRecord:function(){var a=Ext.getStore(this.store),d=a.model,b=Ext.create(d,{}),c=this.items.items;if(this.page!=undefined){this.page+=1}else {this.page=0}a.insert(this.page,b);if(a.data.length>1){Ext.each(c,function(a){a.setValue()})}this.loadRecord(b)}});Ext.define('Rs.ext.form.PagePanel',{extend:'Ext.form.Panel',alias:'widget.Pageform',alternateClassName:['Ext.PageFormPanel','Ext.form.PageFormPanel'],configs:{store:'',relationGridPanelId:'',relationGridQueryFieldArray:[],insertFlag:!1},relationGridPanelId:"",relationGridQueryFieldArray:[],layout:'anchor',bodyAriaRole:'form',basicFormConfigs:['api','baseParams','errorReader','jsonSubmit','method','paramOrder','paramsAsHash','reader','standardSubmit','timeout','trackResetOnLoad','url','waitMsgTarget','waitTitle'],storePage:1,initComponent:function(){var a=this;if(a.frame){a.border=!1}if(Ext.isEmpty(a.insertFlag)){a.insertFlag=!1}a.initFieldAncestor();a.callParent();a.relayEvents(a.form,['beforeaction','actionfailed','actioncomplete','validitychange','dirtychange']);if(a.pollForChanges){a.startPolling(a.pollInterval||500)}if(a.store){var b=Ext.getStore(a.store);var d=b.model;var c=Ext.create('Ext.form.field.Text',{name:d.idProperty,hidden:!0});a.items.items.push(c);if(!Ext.isEmpty(a.relationGridPanelId)){a.on('recordChange',function(b){var c=a.getRelationObj(a.relationGridPanelId,a.relationGridQueryFieldArray);a.loadGridPanel(c,b)})}b.on('load',function(d,b,c){if(!Ext.isEmpty(b)&&b.length>0){a.page=0;a.loadRecord(b[0])}else {if(a.insertFlag){a.addNewRecord()}}})}},setStore:function(a){this.store=a.id},getRelationObj:function(b,d){var c=Ext.getCmp(b),a=c.getStore().getDynamicStore(),e=a.getCachedStore(),f={relationGridPanel:c,relationGridPanelId:b,relationGridQueryFieldArray:d,cachedStore:e,relationGridStore:a};a.queryConditionField={};return f},loadGridPanel:function(a,b,c){Ext.each(a.relationGridQueryFieldArray,function(d,f,e){if(Ext.isObject(d)){if(!Ext.isEmpty(b.data[d.upField])){a.relationGridStore.queryConditionField[d.downField]=b.data[d.upField]}else {a.relationGridStore.queryConditionField[d.downField]="null"}}else {if(!Ext.isEmpty(b.data[d])){a.relationGridStore.queryConditionField[d]=b.data[d]}else {a.relationGridStore.queryConditionField[d]="null"}}});a.cachedStore.queryStaticDataCondintion["queryRecord"]=b;a.relationGridStore.loadPage(1,{newRecord:b.phantom,callback:function(){}})},initItems:function(){this.callParent();this.initMonitor();this.form=this.createForm()},afterFirstLayout:function(){this.callParent(arguments);this.form.initialize()},createForm:function(){var d={},c=this.basicFormConfigs,e=c.length,b=0,a;for(;b<e;++b){a=c[b];d[a]=this[a]}return new Ext.form.Basic(this,d)},getForm:function(){return this.form},loadRecord:function(a){this.fireEvent('recordChange',a);return this.getForm().loadRecord(a)},getRecord:function(){return this.getForm().getRecord()},updateRecord:function(a){return this.getForm().updateRecord(a)},getValues:function(d,c,a,b){return this.getForm().getValues(d,c,a,b)},isDirty:function(){return this.form.isDirty()},isValid:function(){return this.form.isValid()},reset:function(a){return this.form.reset(a)},hasInvalidField:function(){return this.form.hasInvalidField()},doDestroy:function(){this.stopPolling();this.form.destroy();this.callParent()},load:function(a){this.form.load(a)},submit:function(a){this.form.submit(a)},startPolling:function(a){this.stopPolling();this.pollTask=Ext.util.TaskManager.start({interval:a,run:this.checkChange,scope:this})},stopPolling:function(){var a=this.pollTask;if(a){Ext.util.TaskManager.stop(a,!0);this.pollTask=null}},checkChange:function(){var c=this.form.getFields().items,b,d=c.length;for(b=0;b<d;b++){c[b].checkChange()}if(this.isDirty()){var a=this.getRecord();if(Ext.isEmpty(a)){if(this.insertFlag){this.addNewRecord()}else {return !1}}this.updateRecord(this.getRecord())}else {var a=this.getRecord();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.crudState)&&!Ext.isEmpty(a.modified)){if(a.crudState==='U'){this.updateRecord(this.getRecord())}else if(a.crudState==='C'){this.updateRecord(this.getRecord())}}}},getStore:function(){return Ext.getStore(this.store)},revertModified:function(a){var b=Object.keys(a.modified);Ext.each(b,function(b){a.set(b,a.modified[b])})},setNullValue:function(b,d,c,a){if(b.phantom||a){if(d.data.length>1){Ext.each(c,function(e){e.setValue()})}}},removeRecord:function(){var a=Ext.getStore(this.store),b=this.page,f=a.getRange()[b],d=a.getRange()[b-1],c=a.getRange()[b+1],e=this.items.items;a.remove(f);if(b===0){this.loadRecord(c);this.setNullValue(c,a,e);this.page=b+1}else {this.loadRecord(d);this.setNullValue(d,a,e);this.page=b-1}},addNewRecord:function(){var b=Ext.getStore(this.store),d=b.model,a=Ext.create(d,{}),c=this.items.items;if(this.page!=undefined){this.page+=1}else {this.page=0}b.insert(this.page,a);this.setNullValue(a,b,c,!0);this.loadRecord(a)}});Ext.define('Rs.ext.form.model.RsDownloadModel',{extend:'Ext.data.Model',fields:[{name:'attachmentId',type:'string'},{name:'attachmentIndex',type:'string'},{name:'fileName',type:'string'},{name:'type'},{name:'size'},{name:'state'}]});Ext.define('Rs.ext.form.store.RsDownloadStore',function(){return {extend:'Ext.data.Store',model:'Rs.ext.form.model.RsDownloadModel',proxy:{type:'ajax',url:'/sys/testFileUtils/sys-attachment/crud',reader:{type:'json',rootProperty:'data'}}}});Ext.define('Rs.ext.form.model.RsUploadModel',{extend:'Ext.data.Model',fields:[{name:'attachmentId',type:'string'},{name:'attachmentIndex',type:'string'},{name:'fileName',type:'string'},{name:'type'},{name:'size'},{name:'state'}]});Ext.define('Rs.ext.form.store.RsUploadStore',function(){return {extend:'Ext.data.Store',model:'Rs.ext.form.model.RsUploadModel'}});Ext.define('Rs.ext.form.UpDownloadPanel',{extend:'Ext.window.Window',alias:'widget.rs-upload-download-panel',requires:['Ext.form.Panel','Rs.ext.form.store.RsDownloadStore','Rs.ext.form.model.RsDownloadModel','Rs.ext.form.store.RsUploadStore','Rs.ext.form.model.RsUploadModel'],title:"上传文件",layout:{type:'vbox'},minWidth:622,minHeight:200,gridFileNameWidth:190,fileId:'8344',uploadRecordRemovedArray:[],downloadRecordRemovedArray:[],closable:!1,isMultiple:!1,downloadUrl:'/base/downloadfile',downloadParams:{},downloadRequestMethod:'post',recordRemovedUrl:'/sys/testFileUtils/sys-attachment',recordRemovedRequestMethod:'post',configs:{submitUrl:undefined,fileId:undefined,submitParams:{},fileUploadName:undefined,isMultiple:!1,downloadParams:{},uploadSuccess:function(a,b){},uploadFailure:function(a,b){}},initComponent:function(){var a=this,b=window.top;a.callParent();a.initFormPanel();a.initGridPanel();a.initUploadGridPanel();a.add([a.DownloadGridPanel,a.UploadGridPanel,a.formPanel]);a.on('beforeshow',function(){var g=a.UploadGridPanel,f=a.DownloadGridPanel,d=a.uploadButton,e=g.getStore(),c=f.getStore();c.proxy.setExtraParams({attachmentId:a.fileId});e.removeAll();c.load();d.reset();b.onclick=function(){}});a.DownloadGridPanel.on('columnresize',function(g,c,f){console.log(arguments,"columnresize arguments");var d=c.fullColumnIndex,e=a.UploadGridPanel,b=e.getColumns();b[d].setWidth(f);console.log(b);console.log(a.UploadGridPanel,"<=========")});a.on('focusleave',function(){b.onclick=function(b){if(b.clientX-a.getX()<0||b.clientY-a.getY()<0||b.clientX-(a.getX()+a.getWidth())>0||b.clientY-(a.getY()+a.getHeight())>0){console.log("true");a.hide()}}})},initFormPanel:function(){var a=this,d=Ext.create('Ext.form.Panel',Ext.apply({},{layout:{type:'vbox'},height:28,width:'100%'})),e=Ext.create('Ext.toolbar.Toolbar',Ext.apply({},{renderTo:document.body,dock:'bottom',height:30,width:'100%',layout:{type:'hbox'},items:[{xtype:'tbspacer',width:'38%'}],style:{"border":'none'}})),b=Ext.create('Ext.form.field.File',Ext.apply({},{name:a.fileUploadName,id:a.id+'-upload',hideLabel:!0,buttonText:'添加文件',buttonOnly:!0,width:72,buttonConfig:{iconCls:'upload-button-icon',style:{"border":'none',"background":"inherit"}},listeners:{mouseover:{element:'el',fn:function(b,a){this.setStyle({background:'linear-gradient( #F4FAFF 45%,#D2E2F7 50%,#D2E2F7 90%,#F4FAFF 95%)'})}},mouseout:{element:'el',fn:function(){this.setStyle({background:'inherit'})}},mousedown:{element:'el',fn:function(){this.setStyle({background:'linear-gradient( #BFD2E6 45%,#8DC0F5 50%,#98C5F5 90%,#C9DDF6 95%)'})}},click:{element:'el',fn:function(c,b){if(a.isMultiple){b.setAttribute("multiple","multiple")}}},change:{element:'el',fn:function(h,e){console.log(e.files,"<==========");var c=e.files,g=a.UploadGridPanel,d=g.getStore();d.removeAll();a.uploadFileList=c;for(i in c){if(Ext.isNumeric(i)){var f,b={};b.fileName=c[i].name;f=c[i].name.split(".");console.log(c[i].type);b.type="."+f[1].trim();b.size=Ext.util.Format.fileSize(c[i].size);b.state='等待上传';b.attachmentIndex=i+1;d.add(b)}}}}}})),c=Ext.create('Ext.button.Button',Ext.apply({},{id:a.id+'-submit'+'-button',text:'保存',iconCls:'saveAction-button-item',handler:function(){var c=this.up("form").getForm(),d=a.UploadGridPanel.getStore(),b=a.DownloadGridPanel.getStore();if(!Ext.isEmpty(a.downloadRecordRemovedArray)){Ext.each(a.downloadRecordRemovedArray,function(a){b.remove(a)});b.commitChanges()}if(c.isValid()){c.submit({url:a.submitUrl,params:a.submitParams,success:function(e,c){Rs.Msg.messageAlert({title:'提示',message:'上传成功'});b.on('beforeload',function(){console.log(arguments,"beforeload");if(!Ext.isEmpty(a.uploadRecordRemovedArray)){Ext.each(a.uploadRecordRemovedArray,function(d){console.log("record:",d);var b=d.data.attachmentIndex.slice(1);console.log("attachmentId:",b,c.result[b]);Ext.Ajax.request({method:a.recordRemovedRequestMethod,url:a.recordRemovedUrl,params:{attachmentIndex:b,attachmentId:c.result[b].attachmentId},success:function(){a.uploadRecordRemovedArray.length=0},failure:function(){console.log("传递参数有误")}})})}});b.reload();d.removeAll();console.log("success",e,c);a.uploadSuccess(e,c)},failure:function(c,d){Rs.Msg.messageAlert({title:'提示',message:'上传失败'});console.log("fail");var b=a.UploadGridPanel.getStore();b.removeAll();a.uploadRecordRemovedArray.length=0;a.uploadFailure(c,d)}})}},style:{"border":'none',"background":"inherit"},listeners:{mouseover:{element:'el',fn:function(){this.setStyle({background:'linear-gradient( #F4FAFF 45%,#D2E2F7 50%,#D2E2F7 90%,#F4FAFF 95%)'})}},mouseout:{element:'el',fn:function(){this.setStyle({background:'inherit'})}},mousedown:{element:'el',fn:function(){this.setStyle({background:'linear-gradient( #BFD2E6 45%,#8DC0F5 50%,#98C5F5 90%,#C9DDF6 95%)'})}}}}));a.uploadButton=b,a.saveButton=c;a.formPanel=d;a.toolbar=e;a.toolbar.add(a.uploadButton,'-',a.saveButton);a.formPanel.add(a.toolbar)},initGridPanel:function(){var a=this,b=Ext.create('Ext.grid.Panel',Ext.apply({},{stripeRows:!0,autoHeight:!0,border:!1,width:'100%',scrollable:!1,store:new Rs.ext.form.store.RsDownloadStore({storeId:'downloadGridPanelStore'}),columns:[{xtype:'gridcolumn',text:'附件编码',hidden:!0,dataIndex:'attachmentId',menuDisabled:!0},{xtype:'gridcolumn',text:'附件索引',hidden:!0,dataIndex:'attachmentIndex',menuDisabled:!0},{xtype:'gridcolumn',text:'文件名',width:a.gridFileNameWidth,sortable:!0,dataIndex:'fileName',menuDisabled:!0},{xtype:'gridcolumn',text:'类型',flex:1,sortable:!0,dataIndex:'type',menuDisabled:!0},{xtype:'gridcolumn',text:'大小',flex:1,sortable:!0,dataIndex:'size',menuDisabled:!0},{xtype:'gridcolumn',text:'状态',flex:1,sortable:!0,dataIndex:'state',menuDisabled:!0,scope:this,renderer:function(f,b,d,c,a,e,g){return '<a style="color:#3abbfe">已经上传</a>'}},{xtype:'actioncolumn',text:'下载',width:60,align:'center',items:[{iconCls:'downloadAction-button-item',handler:function(e,b,d,f,h,c,g){a.downloadParams={attachmentId:c.data.attachmentId,attachmentIndex:b+1};Ext.Ajax.request({isUpload:!0,method:a.downloadRequestMethod,url:a.downloadUrl,form:Ext.dom.Helper.createDom('<form/>'),params:a.downloadParams})}}]},{xtype:'actioncolumn',text:'操作',align:'center',width:60,items:[{iconCls:'deleteAction1-button-item',handler:function(f,e,d,g,h,b,c){if(!Ext.isEmpty(b.deleteFlag)&&b.deleteFlag=='D'){b.deleteFlag='';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-0')).replaceCls('deleteAction2-button-item','deleteAction1-button-item')}else {b.deleteFlag='D';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-0')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}a.downloadRecordRemovedArray.push(b)}}]}]}));a.DownloadGridPanel=b},initUploadGridPanel:function(){var a=this,b=Ext.create('Ext.grid.Panel',Ext.apply({},{stripeRows:!0,autoHeight:!0,border:!1,hideHeaders:!0,width:'100%',flex:1,scrollable:!1,store:new Rs.ext.form.store.RsUploadStore(),columns:[{xtype:'gridcolumn',text:'附件编码',hidden:!0,dataIndex:'attachmentId',menuDisabled:!0},{xtype:'gridcolumn',text:'附件索引',hidden:!0,dataIndex:'attachmentIndex',menuDisabled:!0},{xtype:'gridcolumn',text:'文件名',width:a.gridFileNameWidth,sortable:!0,dataIndex:'fileName',menuDisabled:!0},{xtype:'gridcolumn',text:'类型',flex:1,sortable:!0,dataIndex:'type',menuDisabled:!0},{xtype:'gridcolumn',text:'大小',flex:1,sortable:!0,dataIndex:'size',menuDisabled:!0},{xtype:'gridcolumn',text:'状态',flex:1,sortable:!0,dataIndex:'state',menuDisabled:!0,scope:this},{xtype:'actioncolumn',text:'下载',width:60,align:'center',items:[{iconCls:'downloadAction1-button-item',handler:function(d,b,a,e,g,c,f){Rs.Msg.messageAlert({title:'提示',message:'文件尚未提交'})}}]},{xtype:'actioncolumn',text:'操作',align:'center',width:60,items:[{iconCls:'deleteAction1-button-item',handler:function(f,e,d,g,h,b,c){if(!Ext.isEmpty(b.deleteFlag)&&b.deleteFlag=='D'){b.deleteFlag='';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-0')).replaceCls('deleteAction2-button-item','deleteAction1-button-item')}else {b.deleteFlag='D';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-0')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}a.uploadRecordRemovedArray.push(b)}}]}]}));a.UploadGridPanel=b},uploadSuccess:function(a,b){console.log("uploadSuccess")},uploadFailure:function(a,b){console.log("uploadFailure")}});Ext.define('Rs.ext.form.field.DateInputField',{extend:'Ext.form.field.Text',alias:'widget.dateinputfield',configs:{format:""},regex:undefined,format:'Y/m/d',maxLength:10,initComponent:function(){var c=this,d=new RegExp("Y(.|\n)*m(.|\n)*d"),e=new RegExp("d(.|\n)*m(.|\n)*Y"),f=new RegExp("m(.|\n)*d(.|\n)*Y"),b,a;c.callParent();c.on('afterrender',function(g){a="^(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})"+"(((0[13578]|1[02])(0[1-9]|[12][0-9]|3[01]))"+"|((0[469]|11)(0[1-9]|[12][0-9]|30))"+"|(02(0[1-9]|[1][0-9]|2[0-8]))))$"+"|^((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))0229)$";if(d.test(g.format)){b=new RegExp("(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})(.|\n)"+"(((0[13578]|1[02])(.|\n)(0[1-9]|[12][0-9]|3[01]))"+"|((0[469]|11)(.|\n)(0[1-9]|[12][0-9]|30))|(02(.|\n)(0[1-9]|[1][0-9]|2[0-8]))))"+"|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))(.|\n)02(.|\n)29)"+"|("+a+")")}if(e.test(g.format)){b=new RegExp("((((0[1-9]|[12][0-9]|3[01])(.|\n)(0[13578]|1[02]))"+"|((0[1-9]|[12][0-9]|30)(.|\n)(0[469]|11))"+"|((0[1-9]|[1][0-9]|2[0-8])(.|\n)02))(.|\n)([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3}))"+"|((29(.|\n)02)(.|\n)(((0[48]|[2468][048]|[3579][26])00)|(([0-9]{2})(0[48]|[2468][048]|[13579][26]))))"+"|("+a+")")}if(f.test(g.format)){b=new RegExp("(((0[13578]|1[02])(.|\n)(0[1-9]|[12][0-9]|3[01])"+"|(0[469]|11)(.|\n)(0[1-9]|[12][0-9]|30)"+"|02(.|\n)(0[1-9]|[1][0-9]|2[0-8]))(.|\n)([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3}))"+"|((02(.|\n)29)(.|\n)(((0[48]|[2468][048]|[3579][26])00)$|(([0-9]{2})(0[48]|[2468][048]|[13579][26]))))"+"|("+a+")")}c.regex=new RegExp(b)});c.on('blur',function(b){var e,c,f,g,h,a=b.getValue();if(Ext.isNumeric(a)){if(a.length<8||a.length>8){d=d&&!1}else {e=a.slice(0,4);c=a.slice(4,6);f=a.slice(6,8);var d=b.isLegalDate(e,c,f);if(d){g=c+"/"+f+"/"+e;h=Ext.Date.format(new Date(g),b.format);b.setValue(h)}}}else {if(Ext.Date.parse(a,'Y/m/d')){b.setValue(Ext.Date.format(new Date(a),b.format))}}})},isLegalDate:function(d,a,c){var b=!0;if(a-"12">0||a-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}if(a==="01"||a==="03"||a==="05"||a==="07"||a==="08"||a==="10"||a==="12"){if(c-"31">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}if(a==="04"||a==="06"||a==="09"||a==="11"){if(c-"30">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}if((d%4===0&&d%100===0)||d%400===0){if(a==="02"){if(c-"29">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}}else {if(a==="02"){if(c-"28">0||c-"01"<0){b=b&&!1;Rs.Msg.messageAlert({"message":"非法日期"})}}}return b}});Ext.define('Rs.ext.form.field.DecimalAwareNumberfield',{extend:'Ext.form.field.Number',xtype:'decimalawarenumberfield',config:{panelId:'',compId:''},afterRender:function(){var a=this,d=a.panelId;a.callParent(arguments);if(!Rs||!Rs.DECIMALS){console.error('确保 Rs.DECIMALS 不为空!');return}if(Ext.isEmpty(Rs.DECIMALS[d])){console.error('panelId属性为空, 导致获取不到该组件所对应的小数位数!');return}var b=a.compId,c=Rs.DECIMALS[d];if(Ext.isEmpty(b)||(c[b]==undefined)){console.error('itemId属性为空, 导致获取不到该组件所对应的小数位数!');return}a.decimalPrecision=c[b]}});Ext.define('Rs.ext.form.field.RsCheckBox',{extend:'Ext.form.field.Checkbox',alias:'widget.rscheckbox',setValue:function(b){var a=this,d,c,f,e;b=b=='Y'?!0:!1;if(Ext.isArray(b)){d=a.getManager().getByName(a.name,a.getFormId()).items;f=d.length;for(c=0;c<f;++c){e=d[c];e.setValue(Ext.Array.contains(b,e.inputValue))}}else {a.duringSetValue=!0;a.callParent(arguments);delete a.duringSetValue}return a?'Y':'N'}});Ext.define('Rs.ext.form.field.TimeInputField',{extend:'Ext.form.field.Text',alias:'widget.timeinputfield',configs:{format:"",strictFormat:undefined},strictFormat:!0,regex:undefined,format:'H:i',initComponent:function(){var a=this,d=new RegExp("H(.|\n)i"),c,b;b=a.format[1];a.callParent();a.on('afterrender',function(e){if(d.test(e.format)){c="(^[0-9]$)"+"|^(([0-1][0-9])|(2[0-3]))$"+"|^(([0-1][0-9]|2[0-3])([0-5][0-9]))$"+"|^(([0-1][0-9]|2[0-3])([^\\w]|("+b+")|[_])([0-5][0-9]))$"+"|^(([0-9])([^\\w]|("+b+")|[_])([0-5][0-9]))$"}a.regex=new RegExp(c)});a.on('blur',function(f){var e,d,b,c;b;oldValue=f.getValue();if(Ext.isNumeric(oldValue)){if(oldValue.length===1){e="0"+oldValue;d="00";b=e+":"+d}if(oldValue.length===2){e=oldValue;d="00";b=e+":"+d}if(oldValue.length===4){e=oldValue.slice(0,2);d=oldValue.slice(2,4);b=e+":"+d}b="1995/10/09 "+b;c=Ext.Date.format(new Date(b),f.format);if(c.slice(0,1)==="0"){if(!a.strictFormat){c=c.slice(1,5)}}f.setValue(c)}else {b="1995/10/09 "+oldValue;if(Ext.Date.parse(b,'Y/m/d H:i')){c=Ext.Date.format(new Date(b),f.format);if(c.slice(0,1)==="0"){if(!a.strictFormat){c=c.slice(1,5)}f.setValue(c)}}}})}});Ext.define('Rs.ext.grid.RelationGridPanel',{extend:'Ext.grid.Panel',alias:'widget.relationgridpanel',configs:{relationGridPanelId:"",relationGridQueryFieldArray:[],moreRelationGridObj:{},relationGridPanelAutoLoad:!0,clickAutoLoadRelationGridPanel:!0,isAddWhileNoRecords:!0},relationGridPanelId:"",relationGridQueryFieldArray:[],count:0,isRelationPanel:!0,addible:!0,deletable:!0,isAddWhileNoRecords:!0,moreRelationGridObj:{},relationGridStoreSet:{},clickAutoLoadRelationGridPanel:!0,relationGridPanelAutoLoad:!0,initComponent:function(){var a=this;a.callParent();a.on('afterrender',function(a){var c=a.getStore(),e=a.getColumns(),f=a.getPlugins(),b,d,g;Ext.each(f,function(b,e,c){if(b.ptype==="cellediting"){d=b;a.cellPlugin=d}if("deleteHead"===b.ptype){g=b}});Ext.each(e,function(c,e,d){if(c.xtype==="rsactioncolumn"){b=c}if(c.xtype==="rs-action-column-restricted"){b=c;a.actionColumn=b}});if(!Ext.isEmpty(d)){d.onAfter('edit',function(c,b){if(!Ext.isEmpty(b.record.deleteFlag)&&b.record.deleteFlag==='D'){Ext.get(b.row.getElementsByClassName('x-action-col-icon x-action-col-2')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}})}c.on('load',function(c,e,d){a.synchroAddDefaultValue(a,b,c,c,d,a.isAddWhileNoRecords)});c.getCachedStore().on('load',function(c,e,d){a.synchroAddDefaultValue(a,b,c.getDynamicStore(),c,!0,a.isAddWhileNoRecords)});a.getView().on('refresh',function(c,e){var d=c.grid.getStore();if(!Ext.isEmpty(d.getRange())){var b=[];Ext.each(d.getRange(),function(d,f,g){if(!Ext.isEmpty(d.deleteFlag)){if(d.deleteFlag==='D'){b.push(f)}}});if(b.length!==0){Ext.each(b,function(b,f,d){if(!Ext.Object.isEmpty(c.grid.getEl().dom.getElementsByClassName('x-action-col-icon x-action-col-2'))){Ext.get(c.grid.getEl().dom.getElementsByClassName('x-action-col-icon x-action-col-2')[b]).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}})}else {return}}});if(!Ext.isEmpty(a.relationGridPanelId)){var h=a.getRelationObj(a.relationGridPanelId,a.relationGridQueryFieldArray);a.relationGridPanelHandler(a,h,c);if(!Ext.Object.isEmpty(a.moreRelationGridObj)){Ext.Object.eachValue(a.moreRelationGridObj,function(b){var d=a.getRelationObj(b.relationGridPanelId,b.relationGridQueryFieldArray);a.relationGridPanelHandler(a,d,c)})}}})},queryConditionHasNull:function(b){var a=!1;Ext.Object.each(b,function(e,d,c){if(d==="null"){c[e]="";a=!0}});return a},isArrayItemObj:function(a){if(a.length!==0){if(Ext.isObject(a[0])){return !0}}else {return !1}},isArrayHaveField:function(a,c){var b=!1;if(a.length!==0){if(Ext.isObject(a[0])){Ext.each(a,function(d,f,e){if(d["upField"]===c){b=!0}})}else {if(Ext.Array.contains(a,c)){b=!0}}}return b},getRelationObj:function(b,d){var c=Ext.getCmp(b),a=c.getStore().getDynamicStore(),e=a.getCachedStore(),f={relationGridPanel:c,relationGridPanelId:b,relationGridQueryFieldArray:d,cachedStore:e,relationGridStore:a};a.queryConditionField={};return f},relationGridPanelHandler:function(a,b,c){c.on('load',function(e,f,g,h){var d=e.getRange();if(a.relationGridPanelAutoLoad&&!Ext.isEmpty(d)){a.autoLoadRelationPanel(a,b,d[0])}if(Ext.isEmpty(d)){relationGridPanel.getStore().removeAll()}});c.cachedStore.on('load',function(f,g,h,e){var d=f.getRange();if(a.relationGridPanelAutoLoad){if(Ext.isEmpty(e.isLoadRelationGridPanel)&&!Ext.isEmpty(d)){a.autoLoadRelationPanel(a,b,d[0])}if(Ext.isEmpty(d)){relationGridPanel.getStore().removeAll()}}});c.on('update',function(g,f,e,d,h,i){if(!Ext.isEmpty(d)){a.syncDataWhenUpdate(a,b,f,e,d)}});c.cachedStore.on('update',function(g,f,e,d,h,i){if(!Ext.isEmpty(d)){a.syncDataWhenUpdate(a,b,f,e,d)}});a.on("rowclick",function(j,e,k,h,d,i,g,f){if(!Ext.isEmpty(d)){if(Ext.get(d.getTarget()).hasCls('addAction-button-item')||Ext.get(d.getTarget()).hasCls('deleteAction1-button-item')||Ext.get(d.getTarget()).hasCls('deleteAction2-button-item')){return}}if(a.clickAutoLoadRelationGridPanel){a.autoLoadRelationPanel(a,b,e,g,f)}});a.relationGridStoreSet[b.relationGridStore.id]=b.relationGridStore},syncDataWhenUpdate:function(g,a,h,j,i){var b=i[0],d=[],f,e;if(g.isArrayHaveField(a.relationGridQueryFieldArray,b)&&!Ext.isEmpty(b)){if(!Ext.isEmpty(a.cachedStore.getRelationStaticDataArry())){Ext.each(a.cachedStore.getRelationStaticDataArry(),function(b){var c=b.cachedPageData;if(b["currentPage"]===a.cachedStore.currentPage&&b["queryRecord"]===h){f=c.data}});var c;if(g.isArrayItemObj(a.relationGridQueryFieldArray)){Ext.each(a.relationGridQueryFieldArray,function(d,f,e){if(b===d["upField"]){c=d["downField"]}})}else {c=b}Ext.each(f,function(d){d.data[c]=h.data[b]})}a.relationGridPanel.getStore().loadPage(a.relationGridPanel.getStore().currentPage);e=a.relationGridPanel.getStore().getRange()[0];d.push(c);a.relationGridPanel.getStore().fireEvent('update',a.relationGridPanel.getStore(),e,j,d)}},synchroAddDefaultValue:function(h,b,a,d,l,f){var c={};if(!Ext.isEmpty(b)){if(!Ext.isEmpty(a.queryConditionField)){delete a.queryConditionField.id;h.queryConditionHasNull(a.queryConditionField);var e={},g,g=Ext.Object.merge(e,a.queryConditionField);b.queryAddValue=g;c=b.addDefaultValue}else {var e={};b.queryAddValue=e;c=b.addDefaultValue}}if(Ext.isEmpty(d.getRange())||(!l)){d.removeAll();if(!Ext.isEmpty(a.queryConditionField)){h.queryConditionHasNull(a.queryConditionField);var n={},k,i;k=Ext.Object.merge(n,a.queryConditionField);i=Ext.Object.merge(k,c);if(f){d.add(i)}}else {var m={},j;j=Ext.Object.merge(m,c);if(f){d.add(j)}}}},autoLoadRelationPanel:function(a,b,c,d,e){Ext.each(b.relationGridQueryFieldArray,function(f,h,g){if(Ext.isObject(f)){if(!Ext.isEmpty(c.data[f.upField])){b.relationGridStore.queryConditionField[f.downField]=c.data[f.upField]}else {b.relationGridStore.queryConditionField[f.downField]="null"}}else {if(!Ext.isEmpty(c.data[f])){b.relationGridStore.queryConditionField[f]=c.data[f]}else {b.relationGridStore.queryConditionField[f]="null"}}});b.cachedStore.queryStaticDataCondintion["queryRecord"]=c;b.relationGridStore.loadPage(1,{newRecord:c.phantom,callback:function(){if(!Ext.isEmpty(d)){if(a.count===0){a.addible=!0;a.deletable=!0}a.count+=1;if(e==="add"){a.addible=a.addible&d.callback();if((Ext.Object.getSize(a.moreRelationGridObj)+1)===a.count){a.count=0;d.add(a.addible)}}if(e==="remove"){a.deletable=a.deletable&d.callback();if((Ext.Object.getSize(a.moreRelationGridObj)+1)===a.count){a.count=0;d.remove(a.deletable)}}}}})}});Ext.define('Rs.ext.grid.column.ActionRestricted',{extend:'Ext.grid.column.Action',alias:'widget.rs-action-column-restricted',configs:{addAltText:"",addIcon:"",addDisabled:undefined,addHidden:undefined,addToolTip:"",addDefaultValue:{},addHandler:function(e,c,b,f,h,d,g,a){},extraAddHandler:function(a,e,c,b,f,h,d,g){},deleteAltText:"",deleteIcon:"",deleteDisabled:undefined,deleteHidden:undefined,deleteToolTip:"",deleteHandler:function(e,c,b,f,h,d,g,a){},extraRemoveHandler:function(a,e,c,b,f,h,d,g){}},text:'操作',addFlag:"add",removeFlag:"remove",pluginsObj:{},gridPluginsArray:undefined,addDefaultValue:{},queryAddValue:{},items:[{},{},{}],initMenu:function(){var a=this;var b=Ext.create('Ext.menu.Menu',Ext.apply({},{width:32,minWidth:0,plain:!0,floating:!0,hidden:!0,renderTo:Ext.getBody()}));a.Menu=b;Ext.each(a.items,function(b,c){if(c>=4){if(!Ext.isEmpty(b)){b.index=c;a.Menu.add(b);if(Ext.isEmpty(b.fn)){b.fn=b.handler}}a.Menu.on('hide',function(){b.hidden=!0})}})},initComponent:function(){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}a.on('afterrender',function(){var c=a.up("grid"),e={},d={};if(Ext.isEmpty(a.gridPluginsArray)){a.gridPluginsArray=c.getPlugins();var b={};Ext.each(a.gridPluginsArray,function(a){if("relatestatecontrolf"===a.ptype){b.relateStateControlF=a}if("deleteHead"===a.ptype){b.deleteHead=a}if("statecontrolf"===a.ptype){b.stateControlF=a}if("rowediting"===a.ptype){b.editPlugin=a}if("cellediting"===a.ptype){b.editPlugin=a}})}a.pluginsObj=b;a.initMenu();Ext.each(a.items,function(b,a){if(a>=4){b.hidden=!0}});a.items[0]={disabled:!0};a.items[1]={altText:a.addAltText,iconCls:'addAction-button-item',icon:a.addIcon,disabled:a.addDisabled,hidden:a.addHidden,tooltip:a.addToolTip,handler:function(b,d,h,i,j,c,f){a.extraAddHandler(a,b.grid,d,h,i,j,c,f);var e=b.grid.getStore();if(!Ext.isEmpty(e.isFrontCachedStore)){if(e.isDynamicStore&&e.isCacheDataToFront){a.refresh(e)}}if(!Ext.isEmpty(b.grid.relationGridPanelId)&&b.grid.clickAutoLoadRelationGridPanel){b.grid.fireEvent('rowclick',b.grid,c,f,d,null,{},{callback:function(){var e=!0;if(!Ext.isEmpty(a.pluginsObj.editPlugin)){Ext.Object.each(a.pluginsObj,function(k,a,g){if(k==="relateStateControlF"){e=e&&(a.relateStateControl(g.editPlugin,c,a.itemIds))}})}return e},add:function(e){if(e){a.addHandler(b.grid,d,h,i,j,c,f,a.addDefaultValue,a.queryAddValue,a)}}},a.addFlag)}else {var g=!0;if(!Ext.isEmpty(a.pluginsObj.editPlugin)){Ext.Object.each(a.pluginsObj,function(k,a,e){if(k==="relateStateControlF"){g=g&&(a.relateStateControl(e.editPlugin,c,a.itemIds))}})}if(g){a.addHandler(b.grid,d,h,i,j,c,f,a.addDefaultValue,a.queryAddValue,a)}}}};a.items[2]={altText:a.deleteAltText,iconCls:'deleteAction1-button-item',icon:a.deleteIcon,disabled:a.deleteDisabled,hidden:a.deleteHidden,tooltip:a.deleteToolTip,handler:function(b,d,c,g,i,e,h){a.extraRemoveHandler(a,b.grid,d,c,g,i,e,h);var f=b.grid.getStore();if(!Ext.isEmpty(f.isFrontCachedStore)){if(f.isCacheDataToFront){f.loadPage(f.currentPage,{isLoadRelationGridPanel:!1,callback:function(){a.deleteHandler(b.grid,d,c,g,i,e,h,a.pluginsObj,a.removeFlag,a)}})}else {a.deleteHandler(b.grid,d,c,g,i,e,h,a.pluginsObj,a.removeFlag,a)}}else {a.notCachedDeleteHandler(b.grid,d,c,g,i,e,h,a.pluginsObj,a)}}};if(a.items.length>=5){a.items[3]={iconCls:'moreAction-button-item',handler:function(h,d,c,g,i,f,b){var e=b.getElementsByClassName("moreAction-button-item")[0];a.Menu.alignTo(e);Ext.each(a.items,function(e,l){if(l>=4){if(!Ext.isEmpty(e.fn)){var j=Ext.Function.bind(e.fn,this,[h,d,c,g,i,f,b],!1),k=a.Menu.items.items;Ext.each(k,function(a,k){if(e.index===a.index){a.handler=j}})}e.hidden=!1;a.Menu.show()}})}}}})},refresh:function(a){a.loadPage(a.currentPage,{isLoadRelationGridPanel:!1})},extraAddHandler:function(a,e,c,b,f,h,d,g){},addHandler:function(a,h,m,n,p,i,o,f,e,l){var k={},b,c=h+1,j=a.getStore(),b=Ext.Object.merge(k,f),d=Ext.Object.merge(b,e),g;j.insert(c,d);g=a.getStore().getRange()[c];a.blur();a.getSelectionModel().select(i)},notCachedDeleteHandler:function(b,c,j,k,l,a,f,g,h){if(!Ext.isEmpty(a.deleteFlag)&&a.deleteFlag=='D'){a.deleteFlag='';h.iconChange(f,"reset")}else {if(!Ext.isEmpty(a.crudState)&&a.crudState=='C'&&a.phantom){if(b.store.data.length>1){b.store.remove(a);var e=b.getStore().getRange()[c-1],i=c-1;if(c===0){e=b.getStore().getRange()[c];i=c}b.fireEvent('rowclick',b,e,f,i);b.blur();b.getSelectionModel().select(e)}}else {var d=!0;if(!Ext.isEmpty(g.editPlugin)){Ext.Object.each(g,function(m,e,i){if(m==="stateControlF"){d=d&&(e.gridStateControl(i.editPlugin,a,e.itemIds))}})}if(d){a.deleteFlag='D';h.iconChange(f,"red")}}}},iconChange:function(b,a){if(a==="red"){Ext.get(b.getElementsByClassName('x-action-col-icon x-action-col-2')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}if(a==="reset"){Ext.get(b.getElementsByClassName('x-action-col-icon x-action-col-2')).replaceCls('deleteAction2-button-item','deleteAction1-button-item')}},extraRemoveHandler:function(a,e,c,b,f,h,d,g){},deleteHandler:function(a,e,l,m,n,b,f,g,k,d){var c=a.getStore();if(!Ext.isEmpty(b.deleteFlag)&&b.deleteFlag=='D'){b.deleteFlag='';d.iconChange(f,"reset");if(c.isCacheDataToFront){d.refresh(c)}}else {if(!Ext.isEmpty(b.crudState)&&b.crudState=='C'&&b.phantom){if(a.getStore().data.length>=1){a.getStore().remove(b);if(c.isCacheDataToFront){d.refresh(c)}if(!Ext.isEmpty(a.relationGridPanelId)){var i=a.getStore().getRange()[e-1],j=e-1;if(e===0){i=a.getStore().getRange()[e];j=e}a.fireEvent('rowclick',a,i,f,j);a.blur();a.getSelectionModel().select(i)}}}else {if(!Ext.isEmpty(a.relationGridPanelId)&&a.clickAutoLoadRelationGridPanel){a.fireEvent('rowclick',a,b,f,e,null,{},{callback:function(h,i,j){var c=!0;if(!Ext.isEmpty(g.editPlugin)){Ext.Object.each(g,function(p,o,q){if(p==="relateStateControlF"){c=c&&(o.relateStateControl(q.editPlugin,b,o.itemIds))}if(p==="stateControlF"){c=c&&(o.gridStateControl(q.editPlugin,b,o.itemIds))}if(p==="deleteHead"){c=c&&(o.deleteHeadControl())}})}return c},remove:function(h){if(h){b.deleteFlag='D';if(c.isCacheDataToFront){d.refresh(c)}else {d.iconChange(f,"red")}}}},k)}else {var h=!0;if(!Ext.isEmpty(g.editPlugin)){Ext.Object.each(g,function(j,c,i){if(j==="stateControlF"){h=h&&(c.gridStateControl(i.editPlugin,b,c.itemIds))}})}if(h){b.deleteFlag='D';if(c.isCacheDataToFront){d.refresh(c)}else {d.iconChange(f,"red")}}}a.blur();a.getSelectionModel().select(b)}}}});Ext.define('Rs.ext.grid.column.RsAction',{extend:'Ext.grid.column.Action',alias:'widget.rsactioncolumn',configs:{addAltText:"",addIcon:"",addDisabled:undefined,addHidden:undefined,addToolTip:"",addDefaultValue:{},addHandler:function(e,c,b,f,h,d,g,a){},deleteAltText:"",deleteIcon:"",deleteDisabled:undefined,deleteHidden:undefined,deleteToolTip:"",deleteHandler:function(d,b,a,e,g,c,f){}},text:'操作',addDefaultValue:{},items:[{},{},{}],initMenu:function(){var a=this;var b=Ext.create('Ext.menu.Menu',Ext.apply({},{width:32,minWidth:0,plain:!0,floating:!0,hidden:!0,renderTo:Ext.getBody()}));a.Menu=b;Ext.each(a.items,function(b,c){if(c>=4){if(!Ext.isEmpty(b)){b.index=c;a.Menu.add(b);if(Ext.isEmpty(b.fn)){b.fn=b.handler}}a.Menu.on('hide',function(){b.hidden=!0})}})},initComponent:function(){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}a.on('afterrender',function(){a.initMenu();Ext.each(a.items,function(b,a){if(a>=4){b.hidden=!0}});a.items[0]={disabled:!0};a.items[1]={altText:a.addAltText,iconCls:'addAction-button-item',icon:a.addIcon,disabled:a.addDisabled,hidden:a.addHidden,tooltip:a.addToolTip,handler:function(e,c,b,f,h,d,g){a.addHandler(e,c,b,f,h,d,g,a.addDefaultValue)}};a.items[2]={altText:a.deleteAltText,iconCls:'deleteAction1-button-item',icon:a.deleteIcon,disabled:a.deleteDisabled,hidden:a.deleteHidden,tooltip:a.deleteToolTip,handler:function(e,c,b,f,h,d,g){a.deleteHandler(e,c,b,f,h,d,g,a.addDefaultValue)}};if(a.items.length>=5){a.items[3]={iconCls:'moreAction-button-item',handler:function(g,d,c,h,i,f,b){var e=b.getElementsByClassName("moreAction-button-item")[0];a.Menu.alignTo(e);Ext.each(a.items,function(e,l){if(l>=4){if(!Ext.isEmpty(e.fn)){var j=Ext.Function.bind(e.fn,this,[g,d,c,h,i,f,b],!1),k=a.Menu.items.items;Ext.each(k,function(a,k){if(e.index===a.index){a.handler=j}})}e.hidden=!1;a.Menu.show()}})}}}})},addHandler:function(f,c,h,j,l,i,k,b){var e=f.getStore();var g={},d=c+1,a=Ext.Object.merge(g,b);e.insert(d,a)},deleteHandler:function(b,e,d,f,g,a,c){if(!Ext.isEmpty(a.deleteFlag)&&a.deleteFlag=='D'){a.deleteFlag='';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-2')).replaceCls('deleteAction2-button-item','deleteAction1-button-item')}else {if(!Ext.isEmpty(a.crudState)&&a.crudState=='C'&&a.phantom){if(b.store.data.length>1){b.store.remove(a)}}else {a.deleteFlag='D';Ext.get(c.getElementsByClassName('x-action-col-icon x-action-col-2')).replaceCls('deleteAction1-button-item','deleteAction2-button-item')}}}});Ext.define('Rs.ext.grid.column.RsCheckColumn',{extend:'Ext.grid.column.Check',alias:'widget.rscheckcolumn',processEvent:function(i,m,l,e,n,b,d,o){var a=this,g=i==='keydown'&&b.getKey(),h=i===a.triggerEvent,k=a.disabled,j,c;b.stopSelection=!g&&a.stopSelection;if(!k&&(h||(g===b.ENTER||g===b.SPACE))){if(a.isRecordChecked(d)==!0||a.isRecordChecked(d)=='Y'){c=!1}else {c=!0}if(a.fireEvent('beforecheckchange',a,e,c,d,b)!==!1){var f='';if(c==!0||c==='Y'){f='Y'}else {f='N'}a.setRecordCheck(d,e,f,l,b);if(h&&!m.actionableMode){b.preventDefault()}if(a.hasListeners.checkchange){a.fireEvent('checkchange',a,e,c,d,b)}}}else {j=a.callParent(arguments)}return j},defaultRenderer:function(b,d){var a=this,e=a.checkboxCls,c='';if(a.invert){b=!b}if(a.disabled){d.tdCls+=' '+a.disabledCls}if(b==!0||b=='Y'){e+=' '+a.checkboxCheckedCls;c=a.checkedTooltip}else {c=a.tooltip}if(c){d.tdAttr+=' data-qtip="'+Ext.htmlEncode(c)+'"'}if(a.useAriaElements){d.tdAttr+=' aria-describedby="'+a.id+'-cell-description'+(!b?'-not':'')+'-selected"'}a.updateHeaderState();return '<span class="'+e+'" role="'+a.checkboxAriaRole+'"'+(!a.ariaStaticRoles[a.checkboxAriaRole]?' tabIndex="0"':'')+'></span>'},setRecordCheck:function(b,g,a,f){var d=this,c=d.property;if((c?b[c]:b.get(d.dataIndex))!=a){if(c){b[c]=a;d.updater(f,a)}else {var e='';if(a==!0||a=='Y'){e='Y'}else {e='N'}b.set(d.dataIndex,e)}}},updater:function(c,b){var a=this,d;if(a.invert){b=!b}if(b==!0||b=='Y'){d=a.checkedTooltip}else {d=a.tooltip}if(d){c.setAttribute('data-qtip',d)}else {c.removeAttribute('data-qtip')}if(a.useAriaElements){a.updateCellAriaDescription(null,b,c)}c=Ext.fly(c);c[a.disabled?'addCls':'removeCls'](a.disabledCls);var e=!0;if(b==!0||b=='Y'){e=!0}else {e=!1}Ext.fly(c.down(a.getView().innerSelector,!0).firstChild)[e?'addCls':'removeCls'](Ext.baseCSSPrefix+'grid-checkcolumn-checked');a.updateHeaderState()}});Ext.define('Rs.ext.grid.column.RsSplitColumn',{extend:'Ext.grid.column.Action',alias:'widget.rssplitcolumn',configs:{splitIcon:"",splictFields:[],assignmentOld:{},assignmentNew:{}},items:[{},{}],width:80,initMenu:function(){var a=this;var b=Ext.create('Ext.menu.Menu',Ext.apply({},{width:32,minWidth:0,plain:!0,floating:!0,hidden:!0,renderTo:Ext.getBody()}));a.Menu=b;Ext.each(a.items,function(b,c){if(c>=3){if(!Ext.isEmpty(b)){b.index=c;a.Menu.add(b);if(Ext.isEmpty(b.fn)){b.fn=b.handler}}a.Menu.on('hide',function(){b.hidden=!0})}})},initComponent:function(){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}a.on('afterrender',function(){var b=a.up("grid");a.initMenu();Ext.each(a.items,function(b,a){if(a>=3){b.hidden=!0}});a.items[0]={disabled:!0};a.items[1]={iconCls:Ext.isEmpty(a.splitIcon)?'addAction-button-item':a.splitIcon,handler:function(f,c,b,e,h,d,g){a.splictHandler(f,c,b,e,h,d,g)}}})},splictHandler:function(h,g,i,j,l,c,k){var b=this,d=h.grid.getStore(),e={};if(Ext.isEmpty(b.splictFields)){for(var a in c.data){if(a!=d.model.idProperty&&a!='ROWNUM_'){e[a]=c.data[a]}}}else {Ext.each(b.splictFields,function(a){e[a]=c.data[a]})}rowNum=g+1,d.insert(rowNum,e);if(!Ext.isEmpty(b.assignmentOld)){for(var a in b.assignmentOld){c.set(a,c.data[b.assignmentOld[a]])}}if(!Ext.isEmpty(b.assignmentNew)){for(var a in b.assignmentNew){var f=d.getAt(rowNum);f.set(a,c.data[b.assignmentNew[a]])}}}});Ext.define('Rs.ext.grid.column.RsUpDownloadAction',{extend:'Ext.grid.column.Action',alias:'widget.rsupdownloadactioncolumn',configs:{uploadAltText:"",uploadIcon:"",uploadDisabled:undefined,uploadHidden:undefined,uploadToolTip:"上传文件",uploadParams:{},uploadFileParam:"",limitFileSize:"",fileAccept:"",isMultiple:!1,synchronizedToSavePlugin:!1,panelWithSavePluginId:"",savePluginPtype:'',submitUrl:"",uploadHandler:function(b,a,d,c,e){},uploadSuccess:function(a){},uploadFailure:function(a){}},text:'操作',rowObj:{},fileAccept:"/*",limitFileSize:"100m",isMultiple:!1,panelWithSavePluginId:"",savePluginPtype:'saveplugin',synchronizedToSavePlugin:!1,submitUrl:"",uploadToolTip:"上传文件",initComponent:function(){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}a.initIframe();a.on('afterrender',function(){a.items[0]={disabled:!0};a.items[1]={altText:a.uploadAltText,iconCls:'submit-button-icon',icon:a.uploadIcon,disabled:a.uploadDisabled,hidden:a.uploadHidden,tooltip:a.uploadToolTip,handler:function(f,d,c,g,i,e,h){var b={view:f,rowIndex:d,colIndex:c,item:g,e:i,record:e,row:h};a.rowObj=b;a.uploadHandler(a,a.uploadParams,a.uploadFileParam,a.submitUrl,a.isMultiple,b)}}})},initIframe:function(){var a=this,b=Ext.DomHelper.createDom('<iframe>');b.setAttribute('name','formIframe'+a.id);b.style.display="none";b.addEventListener('load',function(){if(!Ext.isEmpty(b.contentDocument.body.innerText)){var c=JSON.parse(b.contentDocument.body.innerText);if(!Ext.isEmpty(c)){if(c.info.success){a.uploadSuccess(c,a.rowObj)}else {a.uploadFailure(c,a.rowObj)}}}});a.iframe=b;Ext.getBody().appendChild(a.iframe)},uploadHandler:function(a,l,k,n,p,o){if(!Ext.isEmpty(k)){var d=Ext.DomHelper.createDom('<input>'),b=Ext.DomHelper.createDom('<form>'),f=0,e=[],h=!0,g="",j=[],m,c;d.setAttribute('name',k);if(p){d.setAttribute('multiple','multiple')}d.setAttribute('type','file');if(!Ext.isEmpty(a.fileAccept)){d.setAttribute('accept',a.fileAccept);if(a.fileAccept.indexOf(",")!=-1){j=a.fileAccept.split(",");Ext.each(j,function(b,e,d){if(b.lastIndexOf(".")!=-1){c=b.split(".")[1];if(c==="*"){c="/*"}g+="("+c+")";if(e!==(d.length-1)){g+="|"}}if(b.lastIndexOf("/")!=-1){c=b.split("/")[1];if(c==="*"){c="/*"}g+="("+c+")";if(e!==(d.length-1)){g+="|"}}})}else {g=a.fileAccept}m=new RegExp(g)}d.style.opacity=0;if(!Ext.isEmpty(l)){Ext.Object.each(l,function(d,c,g){e[f]=Ext.DomHelper.createDom('<input>');e[f].setAttribute('name',d);e[f].setAttribute('value',c);e[f].setAttribute('type','text');e[f].style.opacity=0;Ext.get(b).appendChild(e[f++])})}Ext.get(b).appendChild(d);b.setAttribute("enctype","multipart/form-data");if(!Ext.isEmpty(n)){b.setAttribute('action',n)}else {Rs.Msg.messageAlert({title:'操作提示',message:'缺少上传文件的接口地址Url，参考submitUrl属性'})}b.setAttribute('method','post');b.setAttribute('target','formIframe'+a.id);if(Ext.isEmpty(a.iframe.children.item(0))){Ext.get(a.iframe).appendChild(b)}else {Ext.get(a.iframe.children.item(0)).replaceWith(b)}d.addEventListener('change',function(f){var c=f.srcElement.files;for(i in c){if(Ext.isNumeric(i)){if(!m.test(c[i].type)){h=!1;a.uploadFailure("该类型受到限制不支持上传",o);break}if(!a.overLimitSize(a.limitFileSize,c[i].size)){h=!1;a.uploadFailure("文件大小超过限制",o);break}}}if(a.synchronizedToSavePlugin){var e=Ext.getCmp(a.panelWithSavePluginId),d=e.getPlugins();Ext.each(d,function(c){if(a.savePluginPtype===c.ptype){c.addButton.on('click',function(){if(h){b.submit()}})}},this)}else {if(h){b.submit()}}});d.click()}else {Rs.Msg.messageAlert({title:'操作提示',message:'缺少上传文件的参数名，参考uploadFileParam属性'})}},uploadSuccess:function(a,b){},uploadFailure:function(a,b){},overLimitSize:function(e,d){var c=Ext.util.Format.uppercase(e),f,a,b;if(c.lastIndexOf("G")!=-1){a=c.split("G")[0];b=(d/Math.pow(1024,3)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("M")!=-1){a=c.split("M")[0];b=(d/Math.pow(1024,2)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("K")!=-1){a=c.split("K")[0];b=(d/Math.pow(1024,1)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}return (parseFloat(d)<parseFloat(e))}});Ext.define('Rs.ext.grid.column.ThumbUpDownloadAction',{extend:'Ext.grid.column.Action',alias:'widget.thumb-updownload-action-column',configs:{uploadAltText:"",uploadIcon:"",uploadDisabled:undefined,uploadHidden:undefined,uploadToolTip:"上传缩略图",limitFileSize:"",gridStoreId:"",thumbField:"",fileAccept:"",thumbUploadSuccess:function(b,a){},thumbUploadFailure:function(){}},text:'操作',fileAccept:"/*",limitFileSize:"100m",uploadToolTip:"上传缩略图",initComponent:function(b){var a=this;a.callParent();if(a.sortable&&!a.dataIndex){a.sortable=!1}a.on('afterrender',function(){if(!Ext.isEmpty(a.gridStoreId)&&!Ext.isEmpty(a.thumbField)){var c=Ext.getStore(a.gridStoreId);a.storeHandler(c,a.thumbField,a);if(c.isDynamicStore){a.storeHandler(c.getCachedStore(),a.thumbField,a)}}a.items[0]={disabled:!0};a.items[1]={altText:a.uploadAltText,iconCls:'submit-thumbbutton-icon',icon:a.uploadIcon,disabled:a.uploadDisabled,hidden:a.uploadHidden,tooltip:a.uploadToolTip,handler:function(f,d,c,g,j,e,i){var h={view:f,rowIndex:d,colIndex:c,item:g,e:j,record:e,row:i};a.uploadThumb(a,h)}}})},uploadThumb:function(a,d){var c=Ext.DomHelper.createDom('<img>'),g=d.row.getElementsByClassName("submit-thumbbutton-icon"),b=Ext.DomHelper.createDom('<input>'),e,f;if(a.fileAccept.lastIndexOf(".")!=-1){e=a.fileAccept.split(".")[1];f=new RegExp("^image/"+e)}if(a.fileAccept.lastIndexOf("/")!=-1){e=a.fileAccept.split("/")[1];f=new RegExp("^image/"+e)}console.log(f);b.setAttribute('type','file');if(!Ext.isEmpty(a.fileAccept)){b.setAttribute('accept',a.fileAccept)}b.setAttribute('id','thumb');b.style.opacity=0;c.classList.add("obj");c.height=12;c.width=12;b.click();b.addEventListener('change',function(l){var e,k=d.view.grid,b=l.srcElement.files,j=k.getPlugins();Ext.each(j,function(b){if("cellediting"===b.ptype){b.on('edit',function(g,c){e=c.row.getElementsByClassName("submit-thumbbutton-icon");if(!Ext.isEmpty(c.record.get(a.thumbField))){var f=c.record.get(a.thumbField);if(a.isBase64String(f)){e[0].style="background-image:url("+f+");background-size: cover;"}}})}},this);for(i in b){if(Ext.isNumeric(i)){if(!f.test(b[i].type)){a.thumbUploadFailure();continue}if(a.overLimitSize(a.limitFileSize,b[i].size)){c.file=b[i];var h=new FileReader();h.onload=(function(b){return function(c){d.record.thumbData=c.target.result;if(!Ext.isEmpty(a.thumbField)){a.setFieldValue(c.target.result,d.record,a.thumbField)}a.thumbUploadSuccess(d.rowIndex,c.target.result);b.src=c.target.result;g[0].style="background-image:url("+c.target.result+");background-size: cover;"}})(c);h.readAsDataURL(b[i])}else {a.thumbUploadFailure()}}}})},storeHandler:function(c,a,b){c.on("load",function(e,h,f,g,i){var d=e.getRange();Ext.each(d,function(d,l,m){if(!Ext.isEmpty(d.get(a))){var k=document.getElementsByClassName("submit-thumbbutton-icon")[l],j=d.get(a);if(b.isBase64String(j)){k.style="background-image:url("+j+");background-size: cover;"}}})})},isBase64String:function(b){var a=!0,c=b.split(',')[1];a=a&&b.indexOf("base64")!=-1;if(b===''||b.trim()===''){a=!1}try{a=a&&btoa(atob(c))==c}catch(d){a=!1}return a},setFieldValue:function(a,c,b){console.log("thumbData",a);c.set(b,a)},thumbUploadSuccess:function(b,a){},thumbUploadFailure:function(){},overLimitSize:function(e,d){var c=Ext.util.Format.uppercase(e),f,a,b;if(c.lastIndexOf("G")!=-1){a=c.split("G")[0];b=(d/Math.pow(1024,3)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("M")!=-1){a=c.split("M")[0];b=(d/Math.pow(1024,2)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}if(c.lastIndexOf("K")!=-1){a=c.split("K")[0];b=(d/Math.pow(1024,1)).toFixed(2);if(parseFloat(b)>parseFloat(a)){return !1}else {return !0}}return (parseFloat(d)<parseFloat(e))}});Ext.define('Rs.ext.grid.plugin.CalculateAssign',{extend:'Ext.plugin.Abstract',alias:'plugin.calculateassign',requires:'Ext.form.field.Field',configs:{relyOn:[],assignValue:'',rule:''},init:function(b){var a=this;if(!a.relyOn||!a.assignValue||!a.rule){return !1}if(b.isXType('grid')){a.grid=b}else {for(j=0;j<a.relyOn.length;j++){var c=a.relyOn[j];Ext.getCmp(c).on('blur',function(){a.formCalculate(a.relyOn,a.assignValue,a.rule)})}}},formCalculate:function(h,f,c){var b="";var e=!1;var d="";var a=0;var g=this;for(i=0;i<c.length;i++){if(c.charAt(i)=="["){e=!0;d=""}else if(c.charAt(i)=="]"){e=!1;if(Ext.getCmp(d).value){b=b+Ext.getCmp(d).value.toString()}else {return !1}}else if(!e){b=b+c.charAt(i)}else if(e){d=d+c.charAt(i)}}a=g.doStr(b);if(isNaN(a)||Ext.isEmpty(a)){Ext.Msg.alert('提示','公式字段配置错误');return !1}a=a.toFixed(2);Ext.getCmp(f).setValue(a);return !0},gridCalculate:function(h){var f=this;var j=f.assignValue;var c=f.rule;var g=h.record;var b='';var e=!1;var d="";var a=0;if((f.relyOn).includes(h.field)){for(i=0;i<c.length;i++){if(c.charAt(i)=="["){e=!0;d=""}else if(c.charAt(i)=="]"){e=!1;if(g.get(d)){b=b+g.get(d).toString()}else {return !1}}else if(!e){b=b+c.charAt(i)}else if(e){d=d+c.charAt(i)}}a=f.doStr(b);if(isNaN(a)||Ext.isEmpty(a)){Ext.Msg.alert('提示','公式字段配置错误');return !1}a=a.toFixed(2);g.set(j,a);return !0}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.DecrementPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.decrement-plugin',configs:{panelId:''},gridFieldDecrease:function(b,d){var g,e,a,c,f=this;if(!Ext.isEmpty(f.panelId)){g=Ext.getCmp(f.panelId)}if(Ext.isEmpty(d)&&!Ext.isEmpty(f.panelId)){e=g.getSelection()[0];a=e.get(b);if(a>0){c=a-1;e.set(b,c)}}if(!Ext.isEmpty(d)&&!Ext.isEmpty(b)){a=d.get(b);if(a>0){c=a-1;d.set(b,c)}}},formFieldDecrease:function(d){if(!Ext.isEmpty(d)){var c=Ext.getCmp(d),b=c.getValue(),a;if(b>0){a=b-1;c.setValue(a)}}}});Ext.define('Rs.ext.grid.plugin.DynamicColumnsPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.row-dynamic-columns-plugin',configs:{extraColumnConfig:{}},standard:"standard",init:function(a){var b=this;a.on('afterrender',function(c){var d=[],h=[],g=[],f=[],e={},j={};var i=[{dataIndex:"nodeType",text:"wff",itemId:"wtf"},{dataIndex:"seqNo",text:"qqq",itemId:"qqq"}];Ext.each(c.getStore().getModel().getFields(),function(e,g,f){var b={};if(e.name!=="id"){Ext.Object.each(e,function(h,d,i){b[h]=d});d.push(b)}});Ext.each(c.getColumns(),function(b){var d={};Ext.Object.each(b.getInitialConfig(),function(f,g,h){d[f]=g;if(b.isXType("actioncolumn")){d["items"]=b.items}if(b.isXType("rs-action-column-restricted")){d["items"]=b.items}if(b.isXType("thumb-updownload-action-column")){d["items"]=b.items}if(b.isXType("rsupdownloadactioncolumn")){d["items"]=b.items}if(b.isXType("rsactioncolumn")){d["items"]=b.items}if(!Ext.isEmpty(b.text)){if(b.text==="standard"){d.hidden=!0;if(f!=="itemId"&&f!=="dataIndex"&&f!=="text"&&f!=="TransferFlag"&&f!=="id"){e[f]=g}}}});h.push(d)});Ext.each(i,function(h,j,i){var g={};Ext.Object.merge(g,e);Ext.Object.merge(g,h);Ext.Object.each(h,function(f,e,k){if(f==="dataIndex"){d.push({name:e})}if(!Ext.isEmpty(b.extraColumnConfig)){Ext.Object.each(b.extraColumnConfig,function(d,b,l){if(e===d){Ext.Object.merge(g,b)}})}});f.push(g)});g=Ext.Array.merge(f,h);Ext.define(a.getStore().id+"model",{extend:'Ext.data.Model',requires:['Ext.data.field.Field'],fields:d});c.getStore().setModel(a.getStore().id+"model");c.reconfigure(c.getStore(),g)})}});Ext.define('Rs.ext.grid.plugin.FieldDiffentControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fielddiffentcontrolf',configs:{itemIds:'',panelId:'',checkField:[],errorCode:''},init:function(a){var b=this;b.grid=a},gridAttributeUnsame:function(b){var d=this,f=d.itemIds,a=d.checkField,c=b.record,g=b.field;rowIndex=b.rowIdx;if(g!=f){return !0}if(rowIndex==0){return !0}if(Ext.isEmpty(c.get(a))){return !0}var e=d.grid.getStore().getAt(rowIndex-1).get(a);if(c.get(a).toString()==e.toString()){c.set(a,'');Ext.Msg.alert('提示','业务属性一致');return !1}else {return !0}}});Ext.define('Rs.ext.grid.plugin.FieldSameControlB',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsamecontrolb',configs:{itemIds:'',panelId:'',dataPanelId:'',tableCode:'',fields:'',condition:'',errorCode:'',tipType:''},init:function(d){var a=this,c,b=d.getPlugins();if(Ext.isEmpty(a.panelId)){Ext.Msg.alert("系统提示","插件参数配置错误");return !1}if(Ext.getCmp(a.panelId).isXType('grid')&&Ext.isEmpty(a.dataPanelId)){a.gridFunction(b,c)}else if(Ext.getCmp(a.panelId).isXType('form')&&Ext.getCmp(a.dataPanelId).isXType('grid')){a.mixFunction()}else {Ext.Msg.alert("系统提示","插件参数配置错误");return !1}},doSql:function(d){var b=0;var c=d;var a={};a.sql=c;Ext.Ajax.request({url:'/base/sql/excute',jsonData:a,async:!1,method:'POST',success:function(a,c){if(Ext.decode(a.responseText).success){b=Ext.decode(a.responseText).data[0].COUNT;return b}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg)}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接")}})},doSql123:function(b){var a=0;return a},gridFunction:function(a,b){},singleGridFunction:function(t,p,r,q){var b=this;var h="select ";var e="";var g;var k=!1;var a=new Array();a=b.fields.split(",");if(a.length==0){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<a.length;j++){if(j==0){e=e+a[j]}else {e=e+", "+a[j]}}h=h+e+" from "+b.tableCode+" where 1=1 ";var d=b.condition;var c="";var m=new Array();var n=new Array();var f=p;var l;if(r==b.itemIds){l=q;if(l!=0){for(i=0;i<a.length;i++){m[i]=Ext.getCmp(b.panelId).getStore().getAt(l-1).get(a[i])}c="";if(!Ext.isEmpty(d)){for(i=0;i<d.length;i++){if(d.charAt(i)=="["){k=!0;g=""}else if(d.charAt(i)=="]"){k=!1;if(Ext.isEmpty(f.get(g))){value="''";c=c+value.toString()}else {value="'"+f.get(g)+"'";c=c+value.toString()}}else if(!k){c=c+d.charAt(i)}else if(k){g=g+d.charAt(i)}}}h=h+c;var s=h;var o={};o.sql=s;Ext.Ajax.request({url:'/base/sql/excute',jsonData:o,async:!1,method:'POST',success:function(c,d){if(Ext.decode(c.responseText).success){if(Ext.decode(c.responseText).data.length>1){Ext.Msg.alert("系统提示","找到多条记录");f.set(b.itemIds,"");return !1}else if(Ext.decode(c.responseText).data.length==0){Ext.Msg.alert("系统提示","未找到记录");f.set(b.itemIds,"");return !1}else {for(i=0;i<a.length;i++){n[i]=Ext.decode(c.responseText).data[0][a[i].toUpperCase()]}}}else {Ext.Msg.alert("系统提示",Ext.decode(c.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}});if(b.arraryCompare(m,n)){return !0}else {f.set(b.itemIds,"");return !1}}else {return !0}}else {return !0}},mixFunction:function(){var a=this;var f="select ";var g="";var h=!1;var c="";var d=a.condition;var e;var b=new Array();b=a.fields.split(",");if(b.length==0){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<b.length;j++){if(j==0){g=g+b[j]}else {g=g+", "+b[j]}}if(Ext.isEmpty(a.itemIds)){return !1}var k=Ext.getCmp(a.itemIds);k.on('blur',function(o,p){var j=new Array();var k=new Array();var n=Ext.getCmp(a.dataPanelId).getStore().data.length;for(i=0;i<b.length;i++){j[i]=Ext.getCmp(a.dataPanelId).getStore().getAt(n-1).get(b[i])}f="select ";f=f+g+" from "+a.tableCode+" where 1=1 ";c="";if(!Ext.isEmpty(d)){for(i=0;i<d.length;i++){if(d.charAt(i)=="["){h=!0;e=""}else if(d.charAt(i)=="]"){h=!1;if(Ext.isEmpty(Ext.getCmp(e))){Ext.Msg.alert('提示','插件配置错误-匹配条件中未找到对应的控件');Ext.getCmp(a.itemIds).setValue("");return !1}else if(Ext.isEmpty(Ext.getCmp(e).getValue())){value="''";c=c+value.toString()}else {value="'"+Ext.getCmp(e).getValue()+"'";c=c+value.toString()}}else if(!h){c=c+d.charAt(i)}else if(h){e=e+d.charAt(i)}}}f=f+c;var m=f;var l={};l.sql=m;Ext.Ajax.request({url:'/base/sql/excute',jsonData:l,async:!1,method:'POST',success:function(c,d){if(Ext.decode(c.responseText).success){if(Ext.decode(c.responseText).data.length>1){Ext.Msg.alert("系统提示","找到多条记录");Ext.getCmp(a.itemIds).setValue("");return !1}else if(Ext.decode(c.responseText).data.length==0){Ext.Msg.alert("系统提示","未找到记录");Ext.getCmp(a.itemIds).setValue("");return !1}else {for(i=0;i<b.length;i++){k[i]=Ext.decode(c.responseText).data[0][b[i].toUpperCase()]}}}else {Ext.Msg.alert("系统提示",Ext.decode(c.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}});if(a.arraryCompare(j,k)){return !0}else {Ext.getCmp(a.itemIds).setValue("");return !1}})},arraryCompare:function(a,c){var b=!0;if(a.length!=c.length){Ext.Msg.alert("系统提示","验证模型报错");return !1}for(i=0;i<a.length;i++){if(a[i]==c[i]){}else {b=!1}}return b}});Ext.define('Rs.ext.grid.plugin.FieldSameControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsamecontrolf',configs:{itemIds:'',panelId:'',checkField:[],errorCode:''},init:function(a){var b=this;b.grid=a},gridAttributeSame:function(b){var d=this,f=d.itemIds,a=d.checkField,c=b.record,g=b.field;rowIndex=b.rowIdx;if(g!=f){return !0}if(rowIndex==0){return !0}if(Ext.isEmpty(c.get(a))){return !0}var e=d.grid.getStore().getAt(rowIndex-1).get(a);if(c.get(a).toString()!=e.toString()){c.set(a,'');Ext.Msg.alert('提示','业务属性不一致');return !1}else {return !0}}});Ext.define('Rs.ext.grid.plugin.FieldsCompareControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsCompare',requires:'Ext.form.field.Field',configs:{itemIds:'',panelId:'',checkField:'',controlRule:'',errorCode:''},init:function(b){var a=this;if(b.isXType('grid')){a.grid=b}else {if(!Ext.getCmp(a.itemIds)||!Ext.getCmp(a.checkField)){Ext.Msg.alert('提示','控件配置错误');return !1}Ext.getCmp(a.itemIds).on('blur',function(){a.formCompareControl(a.itemIds,a.checkField,a.controlRule)});Ext.getCmp(a.checkField).on('blur',function(){a.formCompareControl(a.itemIds,a.checkField,a.controlRule)})}},formCompareControl:function(d,e,c){var b=Ext.getCmp(d).value;var a=Ext.getCmp(e).value;if(isNaN(b)||Ext.isEmpty(b)){return !1}if(isNaN(a)||Ext.isEmpty(a)){return !1}if(['>','<','>=','<=','==','!=='].includes(c)){if(!this.doStr('parseFloat('+b+')'+c+'parseFloat('+a+')')){Ext.Msg.alert('提示','不满足控制规则');Ext.getCmp(d).setValue();return !1}else {return !0}}else {Ext.Msg.alert('提示','控制规则配置错误');return !1}},gridCompareControl:function(f){var c=this,b=f.record,g=f.field,a=c.itemIds,e=c.checkField,d=c.controlRule;newValue=b.get(a),compareValue=b.get(e);if(g!=a&&g!=e){return !0}if(isNaN(newValue)||Ext.isEmpty(newValue)){return !1}if(isNaN(compareValue)||Ext.isEmpty(compareValue)){return !1}if(['>','<','>=','<=','==','!=='].includes(d)){if(!this.doStr('parseFloat('+newValue+')'+d+'parseFloat('+compareValue+')')){Ext.Msg.alert('提示','不满足控制规则');b.set(a,'');return !1}else {return !0}}else {Ext.Msg.alert('提示','控制规则配置错误');return !1}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.FieldsDifferentControlB',{extend:'Ext.plugin.Abstract',alias:'plugin.fieldsDifferentB',requires:'Ext.form.field.Field',configs:{itemIds:'',panelId:'',tableCode:'',fields:'',condition:'',errorCode:'',tipType:''},init:function(){var c=this;if(Ext.getCmp(c.config.panelId).isXType('grid')){}else {var b=c.config.fields.split(',');for(var a=0;a<b.length;a++){if(!Ext.getCmp(b[a])){Ext.Msg.alert('提示','控件配置错误');return !1}else {Ext.getCmp(b[a]).on('blur',function(a){c.formFieldsDifferentControlB(a)})}}}},formFieldsDifferentControlB:function(j){var f=this;var a='1 = 1';var i=(typeof (USERINFO)=="undefined"?"00":USERINFO.COMPANYCODE);var e=f.config.condition.split(',');var c=f.config.fields.split(',');for(var d=0;d<e.length;d++){if(e[d]=="company_code"){a=a+" AND company_code = '"+i+"'"}else {a=a+" AND "+e[d]}}for(var b=0;b<c.length;b++){if(Ext.isEmpty(Ext.getCmp(c[b]).getValue())){return !0}else {a=a+" AND "+c[b]+" = "+"'"+Ext.getCmp(c[b]).getValue()+"'"}}var g="select count(*) AS NUM from "+f.config.tableCode+" where "+a;console.log("controlSql:",g);var h={};h.sql=g;Ext.Ajax.request({url:'/base/sql/excute',jsonData:h,async:!1,method:'POST',success:function(a,b){if(Ext.decode(a.responseText).success){if(Ext.decode(a.responseText).data[0].NUM===0){return !0}else {Ext.Msg.alert("系统提示","后台验证不一致未通过");j.setValue('');return !1}}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}})},gridFieldsDifferentControlB:function(i){var g=this;var d=i.record;var a='1 = 1';var k=(typeof (USERINFO)=="undefined"?"00":USERINFO.COMPANYCODE);var f=g.config.condition.split(',');var c=g.config.fields.split(',');for(var e=0;e<f.length;e++){if(f[e]=="company_code"){a=a+" AND company_code = '"+k+"'"}else {a=a+" AND "+f[e]}}for(var b=0;b<c.length;b++){if(c[b] in d.data){if(Ext.isEmpty(d.get(c[b]))){return !0}else {a=a+" AND "+c[b]+" = "+"'"+d.get(c[b])+"'"}}}var h="select count(*) AS NUM from "+g.config.tableCode+" where "+a;console.log("controlSql:",h);var j={};j.sql=h;Ext.Ajax.request({url:'/base/sql/excute',jsonData:j,async:!1,method:'POST',success:function(a,b){if(Ext.decode(a.responseText).success){if(Ext.decode(a.responseText).data[0].NUM===0){return !0}else {Ext.Msg.alert("系统提示","后台验证不一致未通过");d.set(i.field,'');return !1}}else {Ext.Msg.alert("系统提示",Ext.decode(a.responseText).mesg);return !1}},failure:function(a,b){Ext.Msg.alert("系统提示","服务器未连接");return !1}})}});Ext.define('Rs.ext.grid.plugin.FieldsHeadDetailCalculatePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.headDetailCalculate',requires:'Ext.form.field.Field',configs:{hPanelID:'',dPanelID:'',hFields:'',dFields:'',errorCode:''},init:function(b){var a=this;if(!Ext.getCmp(a.config.dPanelID)){Ext.Msg.alert('提示','明细面板ID配置错误');return !1}},headCalculate:function(){var b=this;if(!Ext.getCmp(b.config.hPanelID)){Ext.Msg.alert('提示','头面板ID配置错误')}var h=b.config.hFields;var e=b.config.dFields.split(',');var f=0;var a=0;var g=!1;var c='';for(var d=0;d<e.length;d++){a=0;g=!1;Ext.getCmp(b.config.dPanelID).getStore().each(function(b,c){if(e[d] in b.data){g=!0;a=parseFloat(a)+parseFloat(b.get(e[d]))}});if(g){a=a.toFixed(2);c=c+'parseFloat('+a+')'}else {c=c+e[d]}}a=b.doStr(c);if(isNaN(a)||Ext.isEmpty(a)){Ext.Msg.alert('提示','明细字段配置错误');return !1}f=a.toFixed(2);if(Ext.getCmp(b.config.hPanelID).isXType('grid')){Ext.getCmp(b.config.hPanelID).getStore().each(function(a,c){if(c==Ext.getCmp(b.config.hPanelID).getSelectionModel().selectionStartIdx){a.set(h,f);return !0}})}else {if(!Ext.getCmp(h)){Ext.Msg.alert('提示','头字段配置错误');return !1}else {Ext.getCmp(h).setValue(f);return !0}}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.FieldsSumComparePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.sumCompare',requires:'Ext.form.field.Field',configs:{hPanelID:'',dPanelID:'',hFields:'',dFields:'',formula:'',errorCode:''},headDetailSumCompareControl:function(){var a=this;if(!Ext.getCmp(a.config.hPanelID)){Ext.Msg.alert('提示','头面板ID配置错误');return {"success":!1,"panelId":"","errorMsg":[],"errArr":[]}}if(!Ext.getCmp(a.config.dPanelID)){Ext.Msg.alert('提示','明细面板ID配置错误');return {"success":!1,"panelId":"","errorMsg":[],"errArr":[]}}var g=a.config.hFields.split(',');var h=a.config.dFields.split(',');var b=0;var d=0;var f=!1;var e='';for(var c=0;c<g.length;c++){b=0;f=!1;if(Ext.getCmp(a.config.hPanelID).isXType('grid')){Ext.getCmp(a.config.hPanelID).getStore().each(function(d,e){if(e==Ext.getCmp(a.config.hPanelID).getSelectionModel().selectionStartIdx){if(g[c] in d.data){f=!0;b=parseFloat(b)+parseFloat(d.get(g[c]))}}})}else {if(Ext.getCmp(a.config.hPanelID).items.items.includes(Ext.getCmp(g[c]))){f=!0;b=parseFloat(b)+parseFloat(Ext.getCmp(g[c]).value)}}if(f){b=b.toFixed(2);e=e+'parseFloat('+b+')'}else {e=e+g[c]}}b=a.doStr(e);if(isNaN(b)||Ext.isEmpty(b)){Ext.Msg.alert('提示','头字段配置错误');return {"success":!1,"panelId":"","errorMsg":[],"errArr":[]}}b=b.toFixed(2);e='';for(var c=0;c<h.length;c++){d=0;f=!1;Ext.getCmp(a.config.dPanelID).getStore().each(function(a,b){if(h[c] in a.data){f=!0;d=parseFloat(d)+parseFloat(a.get(h[c]))}});if(f){d=d.toFixed(2);e=e+'parseFloat('+d+')'}else {e=e+h[c]}}d=a.doStr(e);if(isNaN(d)||Ext.isEmpty(d)){Ext.Msg.alert('提示','明细字段配置错误');return {"success":!1,"panelId":"","errorMsg":[],"errArr":[]}}d=d.toFixed(2);if(['>','<','>=','<=','==','!=='].includes(a.config.formula)){if(!this.doStr('parseFloat('+b+')'+a.config.formula+'parseFloat('+d+')')){return {"success":!1,"panelId":a.config.dPanelID,"errorMsg":a.config.errorCode,"errArr":[]}}else {return {"success":!0,"panelId":"","errorMsg":[],"errArr":[]}}}else {Ext.Msg.alert('提示','控制规则配置错误');return {"success":!1,"panelId":"","errorMsg":[],"errArr":[]}}},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.FormulaPlu',{extend:'Ext.plugin.Abstract',alias:'plugin.formulaplu',configs:{panelID:'',formula:'',erroCode:'',otherCdt:''},init:function(a){},formulaPlu:function(j,k){var a=this;var d=new Array();d=a.formula.split("=");var c=d[0];var b=d[1];var f=[];var e=!0;var g=Ext.getCmp(a.panelID).getStore().getModel().idProperty;Ext.getCmp(a.panelID).getStore().each(function(m){var l="";var n="";var t=!1;var s=!1;var r=!1;var d="";var p="";var h=0;var q=[];var o=a.otherCdt;if(!Ext.isEmpty(a.otherCdt)){for(i=0;i<o.length;i++){if(o.charAt(i)=="["){r=!0;p=""}else if(o.charAt(i)=="]"){r=!1;if(Ext.isEmpty(m.get(p))){break}else {n=n+"'"+m.get(p).toString()+"'"}}else if(o.charAt(i)=="="){n=n+'=='}else if(!r){n=n+o.charAt(i)}else if(r){p=p+o.charAt(i)}}}else {n="1==1"}if(a.doStr(n)){if(!Ext.isEmpty(m.get(g))){for(i=0;i<c.length;i++){if(c.charAt(i)=="["){t=!0;d=""}else if(c.charAt(i)=="]"){t=!1;if(Ext.isEmpty(m.get(d))||m.get(d)==0){q.push(d);h=parseFloat(0);h=h.toFixed(2);l=l+h.toString()}else if(isNaN(m.get(d))){console.log('formulaPlu插件字段存在字符串，无法计算');break}else {q.push(d);h=parseFloat(m.get(d));h=h.toFixed(2);l=l+h.toString()}}else if(!t){l=l+c.charAt(i)}else if(t){d=d+c.charAt(i)}}l=l+"==";for(i=0;i<b.length;i++){if(b.charAt(i)=="["){s=!0;d=""}else if(b.charAt(i)=="]"){s=!1;if(Ext.isEmpty(m.get(d))||m.get(d)==0){q.push(d);h=parseFloat(0);h=h.toFixed(2);l=l+h.toString()}else if(isNaN(m.get(d))){console.log('formulaPlu插件字段存在字符串，无法计算');break}else {q.push(d);h=parseFloat(m.get(d));h=h.toFixed(2);l=l+h.toString()}}else if(!s){l=l+b.charAt(i)}else if(s){d=d+b.charAt(i)}}if(a.doStr(l)){}else {e=!1;var u={uuid:m.get(g),chkField:q};f.push(u)}}}});var h={success:e,errMsg:a.erroCode,panelID:a.panelID,errArr:f};console.log(h);return h},doStr:function(b){var a=Function;return new a("return "+b)()}});Ext.define('Rs.ext.grid.plugin.GridAddNewRecordPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.addnewrecord',requires:'Ext.button.Button',configs:{buttonIcon:"",buttonStyle:"",buttonText:"",addButtonShow:!1,defaultValue:{},addNewRecord:function(b,a){},doCheckMustInputField:function(c,a,b,d){},mustInputFields:[]},init:function(b){var a=this;a.grid=b;if(a.addButtonShow){a.initAddButton(a.defaultValue)}else {a.afterCheckMustInputFieldAddNewRecord(a.mustInputFields,a.defaultValue)}},initAddButton:function(f){var b,h,c=!1,a=this,g=a.grid,d=a.grid.getDockedItems();Ext.each(d,function(d){if("pagingtoolbar"===d.xtype){b=d;a.toolbar=b;c=!0;a.isPagingToolbarExist=c}},this);if(!(a.isPagingToolbarExist)){Ext.each(d,function(c){if("toolbar"===c.xtype){b=c;a.toolbar=b}else {a.toolbar=b}},this)}var e=new Ext.Button({text:a.buttonText,icon:a.buttonIcon,style:a.buttonStyle,handler:function(){var b=g.getStore();a.addNewRecord(b,f)}});a.addbutton=e;if(!Ext.isEmpty(a.toolbar)){a.toolbar.add(e)}},addNewRecord:function(c,b){var d={},a=Ext.Object.merge(d,b);c.add(a)},getAddButton:function(){var a=this;return a.addbutton},autoAddNewRecord:function(b){var a=this,d=a.grid,c=d.getStore();c.on('load',function(c,e,d){a.addNewRecord(c,b)},a)},doCheckMustInputField:function(e,a,c,d){var b=!0;if(!Ext.isEmpty(a)){Ext.each(c,function(g,k,j){var i=g.data,f=0;for(f;f<a.length;f++){var h=a[f];if(Ext.isEmpty(i[h])){b=!1;break}}},d)}else {Ext.each(c,function(g,i,h){var f=g.data;for(field in f){if(Ext.isEmpty(f[field])){b=!1;break}}},d)}return b},afterCheckMustInputFieldAddNewRecord:function(g,h){var e,c,d,a=this,f=!1,k=!1,i=a.grid,b=i.getStore(),j=i.getPlugins();Ext.each(j,function(b){if("cellediting"===b.ptype){e=b;a.cellEditPlugin=e;f=!0}if("rowediting"===b.ptype){c=b;a.rowEditPlugin=c;k=!0}},this);if(!(f)){a.cellEditPlugin=e}if(!(c)){a.rowEditPlugin=c}if(!Ext.isEmpty(a.cellEditPlugin)){a.cellEditPlugin.on('edit',function(e,f){var c=b.getModifiedRecords();d=a.doCheckMustInputField(b,g,c,a);if(d){a.addNewRecord(b,h)}},a)}if(!Ext.isEmpty(a.rowEditPlugin)){a.rowEditPlugin.on('edit',function(e,f){var c=b.getModifiedRecords();d=a.doCheckMustInputField(b,g,c,a);if(d){a.addNewRecord(b,h)}},a)}}});Ext.define('Rs.ext.grid.plugin.GridDataCheckRepeatPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.griddatacheckrepeat',requires:[],configs:{fields:[],panelID:'',errCode:[]},init:function(){},checkRepeat:function(c){var a=this;a.panel=c;panelID=a.panelID;fields=a.fields;errCode=a.errCode;errArr=[];if(fields!==null&&!Ext.isEmpty(fields)){var d=a.checkFieldsConfig(fields);if(d){var b=a.checkRepeatDo(fields);var e=b.success;errArr=b.errArr;b={success:e,panelID:panelID,errorMsg:errCode,errArr:errArr};return b}}},checkRepeatDo:function(n){var g=this,l=g.panelID,h={},k={},a=g.panel.getStore(),e=[],f=g.fields,m,b,i,j;var d=a.getModel().idProperty;var c=new Ext.util.MixedCollection();var o=Ext.getCmp(l).getStore().isDynamicStore,p=Ext.getCmp(l).getStore().isCachedStore;if(o||p){a=Ext.getCmp(l).getStore();if(a.isCachedStore){b=a.noRelationStaticDataObj}else {b=a.cachedStore.noRelationStaticDataObj}j=!1;if(Ext.Object.isEmpty(b)){if(a.isCachedStore){b=a.relationStaticDataArry}else {b=a.cachedStore.relationStaticDataArry}j=!0}m=Object.keys(b);if(!Ext.Object.isEmpty(b)){Ext.each(m,function(a){i=b[a];if(j){i=i.cachedPageData.data}Ext.each(i,function(i,m){if(g.checkIsValidRec(i,f)){var b='';Ext.each(n,function(d,f,e){var c=i.get(d);b+='?'+(Ext.isEmpty(c)?'':c)},this);if(!Ext.isEmpty(b)&&c.containsKey(b)){var j=h[b]||[];if(Ext.isEmpty(j)){var o=(c.get(b))[0]+1;j.push(o);var l={};l[d]=(c.get(b))[1];l.checkField=f;e.push(l)}j.push(m+1);h[b]=j;var k={};k[d]=i.get(d);k.checkField=f;e.push(k)}else {c.add(b,[m,i.get(d)])}}})})}}else {a.each(function(b,l,o){if(g.checkIsValidRec(b,f)){var a='';Ext.each(n,function(d,f,e){var c=b.get(d);a+='?'+(Ext.isEmpty(c)?'':c)},this);if(!Ext.isEmpty(a)&&c.containsKey(a)){var i=h[a]||[];if(Ext.isEmpty(i)){var m=(c.get(a))[0]+1;i.push(m);var k={};k[d]=(c.get(a))[1];k.checkField=f;e.push(k)}i.push(l+1);h[a]=i;var j={};j[d]=b.get(d);j.checkField=f;e.push(j)}else {c.add(a,[l,b.get(d)])}}},this)}if(e.length>0){k={success:!1,errArr:e}}else {k={success:!0,errArr:e}}return k},checkFieldsConfig:function(b){var e=this;store=e.panel.getStore();var d=store.getModel().fields.items;var c=[];if(Ext.isArray(b)){for(var a=0;a<d.length;a++){c[a]=d[a].getName()}for(var f in b){if(c.indexOf(b[f])==-1){return !1}}}else {return !1}return !0},checkIsValidRec:function(a,d){var f=this,b=!1,c=!1;if(a.dirty){var e=Object.keys(a.modified);Ext.each(e,function(c){if(!Ext.isEmpty(a.data[c])){b=!0;return !1}})}if(a.deleteFlag=='D'){b=!1}else {if(a.crudState=='R'||a.crudState=='U'){b=!0}}if(b){Ext.each(d,function(b){if(!Ext.isEmpty(a.data[b])){c=!0;return !1}})}return c}});Ext.define('Rs.ext.grid.plugin.GridDataMustInputPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.griddatamustinput',requires:[],configs:{fields:[],panelID:'',otherCdt:'',errCode:[]},init:function(){},checkMustInput:function(c){var a=this;a.panel=c,panelID=a.panelID,fields=a.fields,errCode=a.errCode,errArr=[];if(fields!==null&&!Ext.isEmpty(fields)){var d=a.checkFieldsConfig(fields);if(d){var b=a.checkMustInputDo(fields);var e=b.success;errArr=b.errArr;b={success:e,panelID:panelID,errorMsg:errCode,errArr:errArr};return b}}},checkMustInputDo:function(m){var f=this,k=f.panelID,j={},c=f.panel.getStore(),e=[],b=[],a=c.getModel().idProperty,g=f.otherCdt,p=new Ext.util.MixedCollection(),l,d,h,i;var n=Ext.getCmp(k).getStore().isDynamicStore,o=Ext.getCmp(k).getStore().isCachedStore;if(n||o){c=Ext.getCmp(k).getStore();if(c.isCachedStore){d=c.noRelationStaticDataObj}else {d=c.cachedStore.noRelationStaticDataObj}i=!1;if(Ext.Object.isEmpty(d)){if(c.isCachedStore){d=c.relationStaticDataArry}else {d=c.cachedStore.relationStaticDataArry}i=!0}l=Object.keys(d);if(!Ext.Object.isEmpty(d)){Ext.each(l,function(c){h=d[c];if(i){h=h.cachedPageData.data}Ext.each(h,function(d){if(f.checkIsValidRec(d)){Ext.each(m,function(l,o,p){var j=l;var n=d.get(l);if(g){var k=!0;k=f.checkComp(d,g);if(!k){k=!1}if(k&&Ext.isEmpty(n)){if(e.indexOf(d.get(a))==-1){e.push(d.get(a));var h={};h[a]=d.get(a);h.checkField=[j];b.push(h)}else {for(var i in b){if(b[i][a]==d.get(a)){b[i].checkField.push(j);break}}}}}else {if(Ext.isEmpty(n)){if(e.indexOf(d.get(a))==-1){e.push(d.get(a));var h={};h[a]=d.get(a);h.checkField=[j];b.push(h)}else {for(var i in b){if(b[i][a]==d.get(a)){b[i].checkField.push(j);break}}}}}},this)}})})}}else {c.each(function(c,d,h){if(f.checkIsValidRec(c)){Ext.each(m,function(n,p,q){var k=n;var o=c.get(n);if(g){var l=!0;l=f.checkComp(c,g);if(!l){l=!1}if(l&&Ext.isEmpty(o)){if(e.indexOf(c.get(a))==-1){e.push(c.get(a));var i={};i[a]=c.get(a);i.checkField=[k];b.push(i)}else {for(var j in b){if(b[j][a]==c.get(a)){b[j].checkField.push(k);break}}}}}else {if(Ext.isEmpty(o)){if(e.indexOf(c.get(a))==-1){e.push(c.get(a));var i={};i[a]=c.get(a);i.checkField=[k];b.push(i)}else {for(var j in b){if(b[j][a]==c.get(a)){b[j].checkField.push(k);break}}}}}},this)}})}if(b.length>0){j={success:!1,errArr:b}}else {j={success:!0,errArr:b}}return j},checkFieldsConfig:function(e){var a=this,g=a.panel.getStore(),f=g.getModel().fields.items,d=[],c=[];if(Ext.isArray(e)){for(var b=0;b<f.length;b++){d[b]=f[b].getName()}for(var h in e){if(d.indexOf(e[h])==-1){return !1}}}else {return !1}if(a.panel.isXType('grid')){Ext.each(a.panel.getColumns(),function(a){if(!Ext.isEmpty(a.dataIndex)){c.push(a.dataIndex)}})}else {c=d}a.myDataIndex=c;return !0},checkIsValidRec:function(a){var d=this,b=!1;if(a.dirty){var c=Object.keys(a.modified);Ext.each(c,function(c){if(!Ext.isEmpty(a.data[c])){b=!0;return !1}})}if(a.deleteFlag=='D'){b=!1}else {if(a.crudState=='R'||a.crudState=='U'){b=!0}}return b},doStr:function(b){var a=Function;return new a("return "+b)()},checkComp:function(d,a){var f=this.strReplace(a,[]);var c=this.strFeArr;for(var b=0;b<c.length;b++){a=a.replaceAll("["+c[b]+"]",'"'+d.get(c[b])+'"')}var e=this.doStr(a);return e},strReplace:function(a,b){b=b||[];var e=a.substring(a.indexOf("[")+1,a.indexOf("]"));if(a.indexOf("[")==-1||a.indexOf("]")==-1){return 1}if(this.myDataIndex.indexOf(e)==-1){var c=a.indexOf("]");var d=a.substring(c+1);return this.strReplace(d,this.strFeArr)}else {var c=a.indexOf("]");var d=a.substring(c+1);b.push(e);this.strFeArr=b;return this.strReplace(d,this.strFeArr)}}});Ext.define('Rs.ext.grid.plugin.GridDataToolTipPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.datatooltip',requires:'Ext.tip.ToolTip',configs:{fontSize:undefined,color:'',fontWeight:undefined},init:function(b){var a=this;a.grid=b;a.grid.on('afterrender',function(){a.initDataToolTip(a.fontSize,a.fontWeight,a.color)})},initDataToolTip:function(d,a,b){var f=this,c=f.grid,e=c.getView(),g=Ext.create('Ext.tip.ToolTip',{target:e.el,delegate:'.x-grid-cell-inner ',trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function updateTipBody(c){c.update('<p style="font-size:'+d+'px;font-weight:'+a+';color:'+b+';">'+c.triggerElement.innerText+'</p>')}}})}});Ext.define('Rs.ext.grid.plugin.deleteHeadControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.deleteHead',requires:'Ext.button.Button',configs:{itemIds:'',relatePanelId:'',checkFields:'',errorCode:''},deleteHeadControl:function(){var c=this;var d=!0;var b=c.config.relatePanelId.split(',');for(var a=0;a<b.length;a++){if(Ext.getCmp(b[a]).getStore().getCount()<1||Ext.getCmp(b[a]).getStore().data.items[0].phantom){continue}else {d=!1;if(!Ext.isEmpty(c.config.errorCode)){Rs.Msg.messageAlert({stateCode:c.config.errorCode})}break}}return d}});Ext.define('Rs.ext.grid.plugin.GridDeleteRecordPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.deleterecord',requires:'Ext.button.Button',configs:{style:{},beforeDeleteRecord:function(a){},deleteSuccess:function(b,a){},deleteFailure:function(b,a){}},init:function(b){var a=this;a.grid=b;a.initAddButton()},initAddButton:function(){var a=this;grid=a.grid;toolbar;dockedItemsArray=a.grid.getDockedItems();addbutton=new Ext.Button({text:' 删除 ',iconCls:'x-fa fa-trash',style:a.style,handler:function(){a.beforeDelete()}});Ext.each(dockedItemsArray,function(b){if("pagingtoolbar"===b.xtype){toolbar=b;console.log(b);a.toolbar=toolbar}},this);if(Ext.isEmpty(toolbar)){Ext.each(dockedItemsArray,function(b){if("toolbar"===b.xtype){toolbar=b;a.toolbar=toolbar}},this)}a.addbutton=addbutton;a.toolbar.insert(13,addbutton)},beforeDelete:function(){var b=this;grid=b.grid;store=grid.getStore();if(grid.getSelection().length==0){Rs.Msg.messageAlert({title:'提示',message:"提示：请先选择要删除的数据行 !"});return !1}var a=grid.getStore().getModifiedRecords();if(!Ext.isEmpty(a)){if(!(a.length==1&&a[0].crudState=='C'&&a[0].dirty==!1)){Rs.Msg.messageAlert({title:'提示',message:'您有数据尚未保存，是否继续删除操作？',buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:'删除',cancel:'不删除'}},function(a){if(a==='ok'){b.doDeleteAction(grid)}else {return !1}})}else {b.confirmDelete()}}else {b.confirmDelete()}},confirmDelete:function(){var a=this;Rs.Msg.messageAlert({title:'提示',message:'您确定要删除选中的记录吗？',buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:'删除',cancel:'不删除'}},function(b){if(b=='ok'){a.doDeleteAction(grid)}else {return !1}})},doDeleteAction:function(b){var a=this;url=b.getStore().model.proxy.url;store=b.getStore();requestData=new Array();params={};selectionRecords=b.getSelection();var c=Ext.isEmpty(a.beforeDeleteRecord)?!0:a.beforeDeleteRecord(b);if(!c){return !1}params.COMPANYCODE=typeof (USERINFO)=='undefined'?'00':USERINFO.COMPANYCODE;Ext.Array.each(selectionRecords,function(a,d,c){if(a.crudState!='C'){requestData.push(a.data)}});if(Ext.isEmpty(requestData)){store.reload();return}Ext.Ajax.request({url:url,async:!1,params:params,jsonData:JSON.stringify(requestData),method:'DELETE',dataType:"json",success:function(c,e){var d=Ext.decode(c.responseText);if(d.success){if(!Ext.isEmpty(a.deleteSuccess)){a.deleteSuccess(b,c)}else {store.reload();Rs.Msg.messageAlert({title:'提示',message:d.mesg})}}else {if(!Ext.isEmpty(a.deleteFailure)){a.deleteFailure(b,c)}else {Rs.Msg.messageAlert({title:'提示',message:d.mesg,model:!0})}}},failure:function(c,e){var d=Ext.decode(c.responseText);if(!Ext.isEmpty(a.deleteFailure)){a.deleteFailure(b,c)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,model:!0})}return !1}})}});Ext.define('Rs.ext.grid.plugin.GridSaveRecordPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.saverecord',requires:['Rs.ext.button.RsButton'],configs:{style:{},mustInputFields:{},checkRepeatFields:[],url:'',cunstomCheckRule:function(a){},saveFailure:function(b,a){},deleteFailure:function(b,a){},insertFailure:function(b,a){},saveSuccess:function(b,a){}},init:function(b){var a=this;a.grid=b;a.initAddButton();if(a.mustInputFields!==null){a.afterCheckMustInputFieldChangColor(a.mustInputFields)}a.addNewRecord()},initAddButton:function(){var a=this,h=a.grid,c,e=a.grid.getDockedItems();var d={},d=Ext.Object.merge(d,a.style),b=Ext.create('Rs.ext.button.RsButton',{text:' 保存 ',iconCls:'saveAction-button-item',style:d,iconAlign:"left",handler:function(){a.doSave()}});Ext.each(e,function(b){if("pagingtoolbar"===b.xtype){c=b;a.toolbar=c}},this);if(!Ext.isEmpty(a.toolbar)&&a.toolbar.xtype=='pagingtoolbar'){a.addbutton=b;var f={xtype:'tbspacer',flex:1};var g={xtype:'tbspacer',flex:1};a.toolbar.insert(11,f);a.toolbar.insert(12,b)}else {Ext.each(e,function(b){if("toolbar"===b.xtype){c=b;a.toolbar=c}},this);a.addbutton=b;a.toolbar.add(b)}},doSave:function(){var a=this,e=a.grid,d=e.getStore(),c="",b=!0,g={},f=a.getNeedCheckFiedls();a.checkFiedls=f,b=a.checkModifieData(d,f);if(b){Rs.Msg.messageAlert({title:'提示',message:'数据没有发生变化，不需要保存'});return !1}if(!Ext.isEmpty(a.mustInputFields)){c=a.checkMustInputField(a.mustInputFields,d);if(!Ext.isEmpty(c)){Rs.Msg.messageAlert({title:'提示',message:c.join('<br/>')});return}}if(!Ext.isEmpty(a.checkRepeatFields)){c=a.checkRepeatFieldsF(a.checkRepeatFields);if(!Ext.isEmpty(c)){Rs.Msg.messageAlert({title:'提示',message:c.join('<br/>')});return}}if(!Ext.isEmpty(a.cunstomCheckRule)){b=a.cunstomCheckRule(e);if(!b){return !1}}b=a.doDeleteAction(e);if(!b){return !1}b=a.doInsertAction(e);if(!b){return !1}b=a.doUpdateAction(e);if(!b){return !1}Ext.each(d.getModifiedRecords(),function(a){d.remove(a)},this);if(!Ext.isEmpty(a.needDeleteRecords)){d.remove(a.needDeleteRecords)}if(!Ext.isEmpty(a.saveSuccess)){b=a.saveSuccess(e);if(!b){return !1}}d.reload();return},checkModifieData:function(d,e){var f=this,c=d.getModifiedRecords(),b=!1,g=[],a=0;d.each(function(b){if(!Ext.isEmpty(b.deleteFlag)&&b.deleteFlag=='D'){a+=1}},this);if(a>0){return !1}if(Ext.isEmpty(c)){return !0}else {Ext.each(c,function(c){if(a>0){return !1}b=f.checkIsEmptyRecordPlus(c,e);if(!b){a+=1;return !1}},this);if(b){return !0}else {return !1}}},checkMustInputField:function(c,m){var b=this,g=[],a={},e=!1,k=m.getModifiedRecords(),f=new Array(),c=b.mustInputFields,h=b.getColumnsAttribute(),j=h.fiedNameS,i=h.otherColumnsCount;Ext.each(k,function(a){e=b.checkIsEmptyRecordPlus(a,b.checkFiedls);if(!e){f.push(a)}},this);Ext.each(f,function(e,k,h){data=e.data;for(var d in c){if(Ext.isEmpty(data[d])){if(!a[d]){a[d]=[]}var f=this.grid.store.indexOf(e)+1;var g=j.indexOf(d);b.grid.view.getCell(f-1,g+i).style.backgroundColor='#ffdfd7';a[d].push(f)}}},this);for(var d in a){if(!Ext.isEmpty(a[d])){var l="第"+a[d].sort(function(a,b){if(a>b){return 1}else {return -1}}).join('、')+"行"+c[d]+"不能为空";g.push(l)}}return g},checkRepeatFieldsF:function(c){var a=this,b={},n=[],h=a.grid.getStore(),f=[],d=a.getColumnsAttribute(),j=d.fiedNameS,i=d.otherColumnsCount,k=d.columsCount;var e=new Ext.util.MixedCollection();h.each(function(h,i,k){if(!a.checkIsEmptyRecordPlus(h,a.checkFiedls)){var d='';if(Ext.isArray(c)){Ext.each(c,function(b,f,e){var a=h.get(b);d+='?'+(Ext.isEmpty(a)?'':a)},this);if(!Ext.isEmpty(d)&&e.containsKey(d)){var g=b[d]||[];if(Ext.isEmpty(g)){var j=e.get(d)+1;g.push(j)}g.push(i+1);b[d]=g}else {e.add(d,i)}}else {f.push('您的验重配置错误，请检查！')}}},this);h.each(function(d,e,f){for(var b=0;b<k-1;b++){a.grid.view.getCell(d,b).style.backgroundColor=''}});for(var m in b){var g=b[m].sort(function(a,b){if(a>b){return 1}else {return -1}});Ext.each(c,function(d){var e=j.indexOf(d);for(var b=0;b<g.length;b++){a.grid.view.getCell(g[b]-1,e+i).style.backgroundColor='#ffdfd7'}});var l='第'+g.join('、')+"行数据重复！";f.push(l)}return f},afterCheckMustInputFieldChangColor:function(d){var b,a=this,c=a.grid.getPlugins();Ext.each(c,function(a){if("cellediting"===a.ptype){b=a;var c=b}if("rowediting"===a.ptype){b=a;var c=b}},this);if(!Ext.isEmpty(a.editPlugin)){gridEditPlugin.on('validateedit',function(k,b){var f=[],h=b.record.data,l=0,g=a.getColumnsAttribute(),j=g.fiedNameS,i=g.otherColumnsCount;for(var c in d){if(!h[c]||Ext.isEmpty(h[c]+"")){var e=j.indexOf(c)+i;if(a.grid.view.getCell(b.record,e).style.backgroundColor=='#ffdfd7'||a.grid.view.getCell(b.record,e).style.backgroundColor=='rgb(255, 223, 215)'){f.push(e)}}}b.mustInputCol=f},a);gridEditPlugin.on('edit',function(c,b){if(!Ext.isEmpty(b.mustInputCol)){Ext.each(b.mustInputCol,function(e){a.grid.view.getCell(b.record,e).style.backgroundColor='#ffdfd7'})}if(!Ext.isEmpty(b.cell.style.backgroundColor)){if(!Ext.isEmpty(b.value)){b.cell.style.backgroundColor=''}}if(!Ext.isEmpty(b.record.deleteFlag)){b.row.getElementsByClassName('x-action-col-icon x-action-col-2')[0].src='../../../resources/images/del_press.png'}},a)}},doInsertAction:function(k){var a=this,g=k.getStore(),h=g.proxy.url,b={},d=new Array(),i=g.getNewRecords(),f=!1,c=!0,e=new Array();Ext.each(i,function(b){f=a.checkIsEmptyRecordPlus(b,a.checkFiedls);if(!f){e.push(b);d.push(b.data)}},this);if(Ext.isEmpty(d)){return !0}a.needInsertRecords=e;b.COMPANYCODE=typeof (USERINFO)=='undefined'?'00':USERINFO.COMPANYCODE;b.personId=typeof (USERINFO)=='undefined'?'':USERINFO.USERID;b.personCode=typeof (USERINFO)=='undefined'?'':USERINFO.USERCODE;b.personName=typeof (USERINFO)=='undefined'?'':USERINFO.USERNAME;if(!Ext.isEmpty(a.url)){h=a.url}var j=Ext.util.LocalStorage.get('rslocal');token='Bearer '+j.getItem("token");Ext.Ajax.request({url:h,async:!1,params:b,jsonData:JSON.stringify(d),method:'POST',headers:{Authorization:token},dataType:"json",success:function(b,e){var d=Ext.decode(b.responseText);if(d.success){c=!0}else {if(!Ext.isEmpty(a.insertFailure)){a.insertFailure(a.grid,b)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}c=!1}},failure:function(b,e){var d=Ext.decode(b.responseText);if(!Ext.isEmpty(a.insertFailure)){a.insertFailure(a.grid,b)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}c=!1}});return c},doUpdateAction:function(j){var a=this,e=j.getStore(),g=e.proxy.url,b={},d=new Array(),h=e.getModifiedRecords(),c=!0,f=new Array();Ext.each(h,function(a){if(!Ext.isEmpty(a.deleteFlag)&&a.deleteFlag=='D'){}else if(a.crudState=='U'){var g=a.modified,b={};b[e.model.idProperty]=a.id;for(var c=0;c<Object.keys(g).length;c++){var h=Object.keys(g)[c];b[h]=a.data[h]}d.push(b);f.push(a)}},this);if(Ext.isEmpty(d)){return !0}a.needSaveRecords=f;b.COMPANYCODE=typeof (USERINFO)=='undefined'?'00':USERINFO.COMPANYCODE;b.personId=typeof (USERINFO)=='undefined'?'':USERINFO.USERID;b.personCode=typeof (USERINFO)=='undefined'?'':USERINFO.USERCODE;b.personName=typeof (USERINFO)=='undefined'?'':USERINFO.USERNAME;if(!Ext.isEmpty(a.url)){g=a.url}var i=Ext.util.LocalStorage.get('rslocal');token='Bearer '+i.getItem("token");Ext.Ajax.request({url:g,async:!1,params:b,jsonData:JSON.stringify(d),method:'PUT',headers:{Authorization:token},dataType:"json",success:function(b,e){var d=Ext.decode(b.responseText);if(d.success){c=!0}else {if(!Ext.isEmpty(a.saveFailure)){a.saveFailure(a.grid,b)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}c=!1}},failure:function(b,e){var d=Ext.decode(b.responseText);if(!Ext.isEmpty(a.saveFailure)){a.saveFailure(a.grid,b)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}c=!1}});return c},doDeleteAction:function(i){var a=this,f=i.getStore(),g=f.proxy.url,e={},c=new Array(),b=!0,d=new Array();f.each(function(a){if(!Ext.isEmpty(a.deleteFlag)&&a.deleteFlag=='D'){c.push(a.data);d.push(a)}},this);if(Ext.isEmpty(c)){return !0}a.needDeleteRecords=d;e.COMPANYCODE=typeof (USERINFO)=='undefined'?'00':USERINFO.COMPANYCODE;if(!Ext.isEmpty(a.url)){g=a.url}var h=Ext.util.LocalStorage.get('rslocal');token='Bearer '+h.getItem("token");Ext.Ajax.request({url:g,async:!1,params:e,jsonData:JSON.stringify(c),method:'DELETE',dataType:"json",headers:{Authorization:token},success:function(c,e){var d=Ext.decode(c.responseText);if(d.success){b=!0}else {if(!Ext.isEmpty(a.deleteFailure)){a.deleteFailure(a.grid,c)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}b=!1}},failure:function(c,e){var d=Ext.decode(c.responseText);if(!Ext.isEmpty(a.deleteFailure)){a.deleteFailure(a.grid,c)}else {Rs.Msg.messageAlert({title:'提示',message:d.message,modal:!0,buttons:Ext.MessageBox.OK})}b=!1}});return b},checkIsEmptyRecord:function(c){var a=!0,d=Ext.Object.getValues(c.data);if(c.crudState=='U'){a=!1;return a}for(var b=1;b<d.length;b++){if(!Ext.isEmpty(d[b])){a=!1;return a}}return a},getColumnsAttribute:function(){var f=this,e=f.grid.getColumns(),a={},b=new Array(),d=0,c=0;Ext.each(e,function(a){if(a.xtype!='checkcolumn'&&a.xtype!='rownumberer'&&a.xtype!='actioncolumn'&&!a.hidden){b.push(a.dataIndex)}if(a.xtype=='checkcolumn'||a.xtype=='rownumberer'||a.xtype=='actioncolumn'){d+=1}if(!a.hidden){c+=1}});a.fiedNameS=b;a.otherColumnsCount=d;a.columsCount=c;return a},checkIsEmptyRecordPlus:function(b,c){var d=this,a=!0;if(b.crudState=='U'){a=!1;return a}Ext.each(c,function(d){if(!Ext.isEmpty(b.data[d])){a=!1;return a}});return a},getNeedCheckFiedls:function(){var b=this,c=b.getColumnsAttribute(),a=c.fiedNameS;if(Ext.isEmpty(b.grid.getStore().defaultFieldValue)){return a}defaultFields=Object.keys(b.grid.getStore().defaultFieldValue);Ext.each(defaultFields,function(b){var c=a.indexOf(b);a.splice(c,1)});return a},addNewRecord:function(){var a=this,b=a.grid.getStore();b.on('load',function(a,d,c){if(a.data.length==0){if(Ext.isEmpty(a.defaultFieldValue)){a.add({})}else {var b=JSON.parse(JSON.stringify(a.defaultFieldValue));a.add(b)}}},a)}});Ext.define('Rs.ext.grid.plugin.RelateStateControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.relatestatecontrolf',configs:{itemIds:'',relatePanelId:'',relateFields:'',checkFields:'',targetValues:'',controlRule:'',allRowEnable:!1,erroCode:''},init:function(a){var d=this,c,b=a.getPlugins();if(a.xtype=='gridpanel'){d.gridFunction(b,c)}},gridFunction:function(a,b){},relateStateControl:function(v,t,u){var a=this;var d=!1;var q=new Array();q=a.itemIds.split(",");var k=new Array();k=u.split(",");var n=new Array();n=a.checkFields.split(",");var h=new Array();h=a.targetValues.split(",");var o=new Array();o=a.controlRule.split(",");var e=new Array();e=a.relateFields.split(",");if(h.length!=n.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(h.length!=o.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}console.log(k);var p=!1;if(a.allRowEnable){p=!0}else {for(j=0;j<q.length;j++){for(i=0;i<k.length;i++){if(k[i]==q[j]){p=!0}}}}if(p){for(j=0;j<h.length;j++){var g=new Array();for(i=0;i<e.length;i++){g[i]=t.get(e[i])}var r=!0;for(i=0;i<g.length;i++){if(!isNaN(g[i])||!Ext.isEmpty(g[i])){r=!1}}if(r){return !0}var l;var s;var m=0;var c;Ext.getCmp(a.relatePanelId).getStore().each(function(a){l=!0;for(z=0;z<e.length;z++){if(a.get(e[z])!=undefined){s=a.get(e[z]).toString();if(s!=g[z]){l=!1}}else {l=!1}}if(l){c=a.get(n[j]).toString();m=m+1}});if(m==0){Ext.Msg.alert('提示','未找到关联的记录，请重新定义关联字段');return !1}else if(m>1){return !1;Ext.Msg.alert('提示','找到多个关联的记录，请重新定义关联字段')}var f=h[j].toString();var b=o[j];if(b=='>'){if(c>f){d=!0}}else if(b=='<'){if(c<f){d=!0}}else if(b=='>='){if(c>=f){d=!0}}else if(b=='<='){if(c<=f){d=!0}}else if(b=='='){if(c==f){d=!0}}else if(b=='<>'||b=='!='){if(c!=f){d=!0}}else {}}if(d){if(!Ext.isEmpty(a.erroCode)){Rs.Msg.messageAlert({stateCode:a.erroCode})}return !1}else {return !0}}else {return !0}}});Ext.define('Rs.ext.grid.plugin.RowDenormaliserPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.row-denormaliser-plugin',init:function(a){a.on('afterrender',function(b){var d=[],f=[],g=[],c=[],e={},i={};var h=[{dataIndex:"nodeType",text:"wff",itemId:"wtf"},{dataIndex:"seqNo",text:"qqq",itemId:"qqq"}];Ext.each(b.getStore().getModel().getFields(),function(e,g,f){var c={};if(e.name!=="id"){Ext.Object.each(e,function(h,d,i){c[h]=d});d.push(c)}});Ext.each(b.getColumns(),function(c){var d={};Ext.Object.each(c.getInitialConfig(),function(f,g,h){d[f]=g;if(c.isXType("actioncolumn")){d["items"]=c.items}if(!Ext.isEmpty(c.TransferFlag)){if(c.TransferFlag){console.log(f);if(f!=="itemId"&&f!=="dataIndex"&&f!=="text"&&f!=="TransferFlag"){e[f]=g}}}});f.push(d)});Ext.each(h,function(g,i,h){var f={};Ext.Object.merge(f,e);Ext.Object.merge(f,g);Ext.Object.each(g,function(e,c,f){if(e==="dataIndex"){d.push({name:c})}});c.push(f)});g=Ext.Array.merge(c,f);Ext.define(a.getStore().id+"model",{extend:'Ext.data.Model',requires:['Ext.data.field.Field'],fields:d});b.getStore().setModel(a.getStore().id+"model");b.reconfigure(b.getStore(),c)})}});Ext.define('Rs.ext.panel.plugin.SaveDraftPlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.savedraftplugin',requires:['Ext.toolbar.Toolbar','Rs.ext.button.RsButton'],configs:{panelIds:[],buttonText:'',buttonIcon:'',buttonStyle:{},url:'',personCodeField:'',personNameField:'',autoLoad:!0,needLoadPanels:[],needReplaceFields:{},beforeExecute:function(a){},executeSuccess:function(a,b){},executeFailures:function(a,b){}},init:function(a){var b=this;b.initAddButton(a)},initAddButton:function(c){var a=this,b={},b=Ext.Object.merge(b,a.buttonStyle);if(Ext.isEmpty(a.buttonIcon)){a.buttonIcon='saveAction-button-item'}if(Ext.isEmpty(a.buttonText)){a.buttonText='保存草稿'}var d=Ext.create('Rs.ext.button.RsButton',{text:a.buttonText,iconCls:a.buttonIcon,style:b,iconAlign:"left",handler:function(){a.beforeSave()}});if(Ext.isEmpty(a.autoLoad)){a.autoLoad=!0}if(c.xtype=='rs-pagingtoolbar'){c.insert(3,d)}else {c.add(d)}},beforeSave:function(){var a=this;if(!Ext.isEmpty(a.beforeExecute)){if(!a.beforeExecute(a)){return !1}}a.doSave()},doSave:function(){var a=this,b={},c=new Array();if(!a.checkPanelsModified(a.panelIds)){return !1}Ext.each(a.panelIds,function(b){panel=Ext.getCmp(b);store=Ext.getStore(panel.store);c.push(a.integratedData(b,store))});var d=a.url.indexOf("auto/");var e=a.url.indexOf("/crud");b.pagCode=a.url.substring(d+5,e);b.funCode=a.id;b.panels=c;b.draftFlag=!0;returnData=a.doExecuteAction(b);if(returnData.errorFlag){return !1}if(a.autoLoad){if(!Ext.isEmpty(a.needLoadPanels)){Ext.each(a.needLoadPanels,function(c){var b=Ext.getCmp(c),a=Ext.getStore(b.store);if(a.isDynamicStore||a.isCachedStore){if(!Ext.isEmpty(a.dynamicStore)){a.dynamicStore.cachedDataAllClear()}}if(a.isCachedStore){a.getDynamicStore().forceChangeStore=!0;a.loadPage(a.currentPage)}else {a.reload()}if(b.isXType('grid')){b.setSelection()}})}else {Ext.each(a.panelIds,function(a){panel=Ext.getCmp(a);store=Ext.getStore(panel.store);if(store.isDynamicStore||store.isCachedStore){if(!Ext.isEmpty(store.dynamicStore)){store.dynamicStore.cachedDataAllClear()}}if(store.isCachedStore){store.getDynamicStore().forceChangeStore=!0;store.loadPage(store.currentPage)}else {store.reload()}if(panel.isXType('grid')){panel.setSelection()}})}}else {a.replaceIdToal(b,returnData.responseData)}return},checkModifieData:function(b,f){var g=this,d=b.getUpdatedRecords(),e=b.getNewRecords(),a,c,h;if(b.isDynamicStore||b.isCachedStore){a=g.checkCaCheStoreModified(b)}else {if(d.length>0){if(f.xtype=='gridpanel'){return !0}else {Ext.each(d,function(d){c=Object.keys(d.modified);Ext.each(c,function(c){if(c!=b.model.idProperty&&d.data[c]!=d.modified[c]){if(d.data[c]==null&&d.modified[c]=='undefined'){}else {a=!0;return !1}}});if(a){return !1}});if(a){return !0}}}Ext.each(e,function(d){if(d.dirty){c=Object.keys(d.modified);Ext.each(c,function(c){if(!Ext.isEmpty(d.data[c])){a=!0}})}});if(a){return !0}b.each(function(c){if(c.deleteFlag=='D'){a=!0}},this)}if(a){return !0}return !1},checkCaCheStoreModified:function(b){var e=this,a,i,h,f,g,c,d;if(b.isCachedStore){c=b.noRelationStaticDataObj}else {c=b.cachedStore.noRelationStaticDataObj}h=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(h,function(d){i=c[d];if(d==b.currentPage){newRecordsP=e.getNewRecordsData(b);deleteRecordsP=e.getDeleteRecordsData(b);updateRecordsP=e.getUpdateRecordsData(b);if(!Ext.isEmpty(newRecordsP.recordData)||!Ext.isEmpty(deleteRecordsP.recordData)||!Ext.isEmpty(updateRecordsP.recordData)){a=!0}if(a){return !1}}else {Ext.each(i,function(c){if(c.crudState=='R'&&c.deleteFlag!='D'){}else if(c.deleteFlag=='D'){a=!0}else if(c.crudState=='U'){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(c.modified[e])&&Ext.isEmpty(c.data[e])){}else {if(c.data[e]==null&&c.modified[e]=='undefined'){}else {a=!0;return !1}}})}}if(c.phantom){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(c.data[e])){a=!0;return !1}})}}if(a){return !1}});if(a){return !1}}});if(a){return !0}}else {if(b.isCachedStore){d=b.relationStaticDataArry}else {d=b.cachedStore.relationStaticDataArry}f=Object.keys(d);Ext.each(f,function(c){g=d[c];Ext.each(g.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){a=!0}else if(d.crudState=='U'){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(d.modified[e])&&Ext.isEmpty(d.data[e])){}else {if(e!=b.model.idProperty&&d.data[e]!=d.modified[e]){if(d.data[e]==null&&d.modified[e]=='undefined'){}else {a=!0;return !1}}}})}}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(d.data[e])){a=!0;return !1}});if(a){a=!0}}}if(a){return !1}});if(a){return !1}});if(a){return !0}}},checkPanelsModified:function(c){var d=this,b,a;Ext.each(c,function(e){b=Ext.getCmp(e);store=Ext.getStore(b.store);a=d.checkModifieData(store,b);if(a){return !1}});if(a){return !0}else {Rs.Msg.messageAlert({title:'提示',message:'数据没有发生变化，不需要保存'});return !1}},integratedData:function(e,b){var a=this,f={},c={},d={};a.comCode=typeof (USERINFO)=='undefined'?'':USERINFO.COMPANYCODE;a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTCODE,a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTNAME;if(Ext.isEmpty(a.userCode)){a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.USERCODE;a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.USERNAME}if(!Ext.isEmpty(a.personCodeField)||!Ext.isEmpty(a.personNameField)){Ext.each(b.model.getFields(),function(c){if(c.name=='COM_CODE'){a.comFlag=!0}if(c.name==a.personCodeField){a.personFlag=!0}})}else {Ext.each(b.model.getFields(),function(c){if(c.name=='COM_CODE'){a.comFlag=!0}if(c.name=='UPD_CODE'){a.updFlag=!0}})}if(b.isDynamicStore||b.isCachedStore){d=a.getAllModifiedRecordsData(b);c.newRecords=d.newRecords;c.deleteRecords=d.deleteRecords;c.updateRecords=d.updateRecords}else {c.newRecords=this.getNewRecordsData(b);c.deleteRecords=this.getDeleteRecordsData(b);c.updateRecords=this.getUpdateRecordsData(b)}f.gridCode=e;f.panelData=c;if(!Ext.isEmpty(Ext.getCmp(e).relationGridPanelId)||!Ext.isEmpty(Ext.getCmp(e).moreRelationGridObj)){f.relationData=a.dealRelationData(Ext.getCmp(e))}return f},dealRelationData:function(a){var e={},b={};if(!Ext.isEmpty(a.relationGridPanelId)){if(a.isArrayItemObj(a.relationGridQueryFieldArray)){b[a.relationGridPanelId]=a.relationGridQueryFieldArray}else {var c={},d=[];Ext.each(a.relationGridQueryFieldArray,function(b){c.upField=b;c.downField=b;d.push(c)});b[a.relationGridPanelId]=d}}if(!Ext.isEmpty(a.moreRelationGridObj)){Ext.each(Ext.Object.getValues(a.moreRelationGridObj),function(c){if(a.isArrayItemObj(c.relationGridQueryFieldArray)){b[c.relationGridPanelId]=c.relationGridQueryFieldArray}else {var d={},e=[];Ext.each(c.relationGridQueryFieldArray,function(b){d.upField=b;d.downField=b;e.push(d)});b[c.relationGridPanelId]=e}})}return b},getNewRecordsData:function(f){var a=this,e=f.getNewRecords(),c={},d,b=new Array();Ext.each(e,function(e){if(e.dirty){modifieds=Object.keys(e.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(e.data[a])){d=!0;return !1}});if(d){var c=e.data;c.DRA_FLAG='Y';if(a.comFlag){c.COM_CODE=a.comCode}if(a.updFlag){c.UPD_CODE=a.userCode;c.UPD_NAME=a.userName}if(a.personFlag){c[a.personCodeField]=a.userCode;c[a.personNameField]=a.userName}b.push(c)}}});c.recordData=b;return c},getDeleteRecordsData:function(c){var d=this,b={},a=new Array();c.each(function(d){if(d.deleteFlag=='D'){var b=d.data;b.DRA_FLAG='Y';a.push(b)}});b.recordData=a;return b},getUpdateRecordsData:function(d){var a=this,h=d.getUpdatedRecords(),c={},f,g=new Array(),b={},e=new Array();Ext.each(h,function(h){f=Object.keys(h.modified);b={};Ext.each(f,function(a){if(Ext.isEmpty(h.modified[a])&&Ext.isEmpty(h.data[a])){}else {b[a]=h.data[a]}});if(!Ext.Object.isEmpty(b)){b[d.model.idProperty]=h.data[d.model.idProperty];b.DRA_FLAG='Y';var c=h.data;c.DRA_FLAG='Y';if(a.updFlag){c.UPD_CODE=a.userCode;c.UPD_NAME=a.userName;b.UPD_CODE=a.userCode;b.UPD_NAME=a.userName}if(a.personFlag){c[a.personCodeField]=a.userCode;c[a.personNameField]=a.userName;b[a.personCodeField]=a.userCode;b[a.personNameField]=a.userName}g.push(b);e.push(c)}});c.modifieds=g;c.recordData=e;return c},getAllModifiedRecordsData:function(b){var a=this,g,h,t,s,n,r,f={},m=!1,c={},d={},q={},p={},o={},e={},j=new Array(),k=new Array(),l=new Array(),i=new Array();if(b.isCachedStore){g=b.noRelationStaticDataObj}else {g=b.cachedStore.noRelationStaticDataObj}s=Object.keys(g);if(!Ext.Object.isEmpty(g)){Ext.each(s,function(c){pageData=g[c];if(c==b.currentPage){q=a.getNewRecordsData(b);o=a.getDeleteRecordsData(b);p=a.getUpdateRecordsData(b)}else {Ext.each(pageData,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){var g=d.data;g.DRA_FLAG='Y';i.push(g)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];modifiedData.DRA_FLAG='Y';var f=d.data;f.DRA_FLAG='Y';if(a.updFlag){f.UPD_CODE=a.userCode;f.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){f[a.personCodeField]=a.userCode;f[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}k.push(modifiedData);l.push(f)}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){m=!0;return !1}});if(m){var e=d.data;e.DRA_FLAG='Y';if(a.comFlag){e.COM_CODE=a.comCode}if(a.updFlag){e.UPD_CODE=a.userCode;e.UPD_NAME=a.userName}if(a.personFlag){e[a.personCodeField]=a.userCode;e[a.personNameField]=a.userName}j.push(e)}}}})}});c.modifieds=k;c.recordData=l;d.recordData=i;f.recordData=j;c=Ext.Object.merge(c,p),d=Ext.Object.merge(d,o),f=Ext.Object.merge(f,q),e.newRecords=f;e.deleteRecords=d;e.updateRecords=c;return e}else {if(b.isCachedStore){h=b.relationStaticDataArry}else {h=b.cachedStore.relationStaticDataArry}r=Object.keys(h);Ext.each(r,function(c){n=h[c];Ext.each(n.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){var g=d.data;g.DRA_FLAG='Y';i.push(g)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];modifiedData.DRA_FLAG='Y';var f=d.data;f.DRA_FLAG='Y';if(a.updFlag){f.UPD_CODE=a.userCode;f.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){f[a.personCodeField]=a.userCode;f[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}k.push(modifiedData);l.push(f)}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){m=!0;return !1}});if(m){var e=d.data;e.FUU_ID=n.queryRecord.id;e.DRA_FLAG='Y';if(a.comFlag){e.COM_CODE=a.comCode}if(a.updFlag){e.UPD_CODE=a.userCode;e.UPD_NAME=a.userName}if(a.personFlag){e[a.personCodeField]=a.userCode;e[a.personNameField]=a.userName}j.push(e)}}}})});c.modifieds=k;c.recordData=l;d.recordData=i;f.recordData=j;c=Ext.Object.merge(c,p),d=Ext.Object.merge(d,o),f=Ext.Object.merge(f,q),e.newRecords=f;e.deleteRecords=d;e.updateRecords=c;return e}},doExecuteAction:function(d){var a=this,e=a.url,b=!1,c={},f;Ext.Ajax.request({url:e,async:!1,jsonData:JSON.stringify(d),method:'POST',dataType:"json",success:function(c,f){var e=Ext.decode(c.responseText);if(e.success){if(!Ext.isEmpty(a.executeSuccess)){a.executeSuccess(a,c)}else {b=!1}}else {if(!Ext.isEmpty(a.executeFailures)){a.executeFailures(a,c)}else {Rs.Marker.mark(e.data)}b=!0}},failure:function(c,f){var e=Ext.decode(c.responseText);if(!Ext.isEmpty(a.executeFailures)){a.executeFailures(a,c)}else {Rs.Marker.mark(e.data)}b=!0}});c.errorFlag=b;return c},replaceIdToal:function(c,b){var a=this;Ext.each(c.panels,function(i){var e=i.gridCode;var h=Ext.getCmp(e);var g=h.getStore();if(!Ext.isEmpty(a.needReplaceFields)){if(!Ext.isEmpty(a.needReplaceFields[e])){var d=a.needReplaceFields[e];d=d.substr(1);d=d.substring(0,d.length-1);var f=d.split(',')}else {var f=null}}else {var f=null}if(g.isDynamicStore||g.isCachedStore){a.replaceIdC(g,b.data[e],f)}else {a.replaceIdN(g,b.data[e],f)}})},replaceIdN:function(a,b){a.each(function(c){if(c.deleteFlag=='D'){a.remove(c)}});Ext.each(b,function(c){var d=Ext.Object.getKeys(c);var e=a.getById(d);e.set(a.model.idProperty,c[d][a.model.idProperty]);Ext.each(replaceFields,function(f){if(!Ext.isEmpty(c[d][f])){e.set(f,c[d][f])}});e.id=c[d][a.model.idProperty]});a.commitChanges()},replaceIdC:function(a,b){var c,g,h,d,e,f;if(a.isCachedStore){c=a.noRelationStaticDataObj}else {c=a.cachedStore.noRelationStaticDataObj}g=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(g,function(d){h=c[d];Ext.each(h,function(c){if(c.deleteFlag=='D'){a.remove(c)}if(Ext.isEmpty(b)){return}if(c.phantom){if(!Ext.isEmpty(c.data[a.model.idProperty])){if(!Ext.isEmpty(c.get('HUU_ID'))){c.set('HUU_ID',b[c.id].HUU_ID)}Ext.each(replaceFields,function(e){if(!Ext.isEmpty(b[c.id][e])){c.set(e,b[c.id][e])}});c.set(a.model.idProperty,b[c.id].UU_ID);c.id=c.data[a.model.idProperty]}}})})}else {if(a.isCachedStore){d=a.relationStaticDataArry}else {d=a.cachedStore.relationStaticDataArry}e=Object.keys(d);Ext.each(e,function(c){f=d[c];Ext.each(f.cachedPageData.data,function(d){if(d.deleteFlag=='D'){a.remove(d)}if(Ext.isEmpty(b)){return}if(d.phantom){if(!Ext.isEmpty(d.data[a.model.idProperty])){if(!Ext.isEmpty(d.get('HUU_ID'))){d.set('HUU_ID',b[d.id].HUU_ID)}Ext.each(replaceFields,function(e){if(!Ext.isEmpty(b[d.id][e])){d.set(e,b[d.id][e])}});d.set(a.model.idProperty,b[d.id].UU_ID);d.id=d.data[a.model.idProperty]}}})})}a.commitChanges()}});Ext.define('Rs.ext.panel.plugin.SavePlugin',{extend:'Ext.plugin.Abstract',alias:'plugin.saveplugin',requires:['Ext.toolbar.Toolbar','Rs.ext.button.RsButton'],configs:{panelIds:[],buttonText:'',buttonIcon:'',buttonStyle:{},url:'',personCodeField:'',personNameField:'',autoLoad:!0,needLoadPanels:[],needReplaceFields:{},beforeExecute:function(a){},executeSuccess:function(a,b){},executeFailures:function(a,b){}},init:function(b){var a=this;a.initAddButton(b);Ext.defer(a.initAddPlugins,100,a)},initAddButton:function(c){var a=this,e,b={},b=Ext.Object.merge(b,a.buttonStyle);if(Ext.isEmpty(a.buttonIcon)){a.buttonIcon='saveAction-button-item'}if(Ext.isEmpty(a.buttonText)){a.buttonText='保存'}var d=Ext.create('Rs.ext.button.RsButton',{text:a.buttonText,iconCls:a.buttonIcon,style:b,iconAlign:"left",handler:function(){a.beforeSave()}});if(Ext.isEmpty(a.autoLoad)){a.autoLoad=!0}if(c.xtype=='rs-pagingtoolbar'){c.insert(2,d)}else {c.add(d)}},beforeSave:function(){var a=this;if(!Ext.isEmpty(a.beforeExecute)){if(!a.beforeExecute(a)){return !1}}a.doSave()},doSave:function(){var a=this,b={},c=new Array();if(!a.checkPanelsModified(a.panelIds)){return !1}if(!a.checkDatas()){return !1}Ext.each(a.panelIds,function(b){panel=Ext.getCmp(b);store=Ext.getStore(panel.store);c.push(a.integratedData(b,store))});var d=a.url.indexOf("auto/");var e=a.url.indexOf("/crud");b.pagCode=a.url.substring(d+5,e);b.funCode=a.id;b.panels=c;returnData=a.doExecuteAction(b);if(returnData.errorFlag){return !1}if(a.autoLoad){if(!Ext.isEmpty(a.needLoadPanels)){Ext.each(a.needLoadPanels,function(c){var b=Ext.getCmp(c),a=Ext.getStore(b.store);if(a.isDynamicStore||a.isCachedStore){if(!Ext.isEmpty(a.dynamicStore)){a.dynamicStore.cachedDataAllClear()}}if(a.isCachedStore){a.getDynamicStore().forceChangeStore=!0;a.loadPage(a.currentPage)}else {a.reload()}if(b.isXType('grid')){b.setSelection()}})}else {Ext.each(a.panelIds,function(a){panel=Ext.getCmp(a);store=Ext.getStore(panel.store);if(store.isDynamicStore||store.isCachedStore){if(!Ext.isEmpty(store.dynamicStore)){store.dynamicStore.cachedDataAllClear()}}if(store.isCachedStore){store.getDynamicStore().forceChangeStore=!0;store.loadPage(store.currentPage)}else {store.reload()}if(panel.isXType('grid')){panel.setSelection()}})}}else {a.replaceIdToal(b,returnData.responseData)}return},checkModifieData:function(b,f){var g=this,d=b.getUpdatedRecords(),e=b.getNewRecords(),a,c,h;if(b.isDynamicStore||b.isCachedStore){a=g.checkCaCheStoreModified(b)}else {if(d.length>0){if(f.xtype=='gridpanel'){return !0}else {Ext.each(d,function(d){c=Object.keys(d.modified);Ext.each(c,function(c){if(c!=b.model.idProperty&&d.data[c]!=d.modified[c]){if(d.data[c]==null&&d.modified[c]=='undefined'){}else {a=!0;return !1}}});if(a){return !1}});if(a){return !0}}}Ext.each(e,function(d){if(d.dirty){c=Object.keys(d.modified);Ext.each(c,function(c){if(!Ext.isEmpty(d.data[c])){a=!0}})}});if(a){return !0}b.each(function(c){if(c.deleteFlag=='D'){a=!0}},this)}if(a){return !0}return !1},checkCaCheStoreModified:function(b){var e=this,a,i,h,f,g,c,d;if(b.isCachedStore){c=b.noRelationStaticDataObj}else {c=b.cachedStore.noRelationStaticDataObj}h=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(h,function(d){i=c[d];if(d==b.currentPage){newRecordsP=e.getNewRecordsData(b);deleteRecordsP=e.getDeleteRecordsData(b);updateRecordsP=e.getUpdateRecordsData(b);justModeP=e.getJustModeRecordsData(b);if(!Ext.isEmpty(newRecordsP.recordData)||!Ext.isEmpty(deleteRecordsP.recordData)||!Ext.isEmpty(updateRecordsP.recordData)||!Ext.isEmpty(justModeP.recordData)){a=!0}if(a){return !1}}else {Ext.each(i,function(c){if(c.crudState=='R'&&c.deleteFlag!='D'){}else if(c.deleteFlag=='D'){a=!0}else if(c.crudState=='U'){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(c.modified[e])&&Ext.isEmpty(c.data[e])){}else {if(e!=b.model.idProperty&&c.data[e]!=c.modified[e]){if(c.data[e]==null&&c.modified[e]=='undefined'){}else {a=!0;return !1}}}})}}if(c.phantom){if(!Ext.isEmpty(c.modified)){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(c.data[e])){a=!0;return !1}})}}if(a){return !1}});if(a){return !1}}});if(a){return !0}}else {if(b.isCachedStore){d=b.relationStaticDataArry}else {d=b.cachedStore.relationStaticDataArry}f=Object.keys(d);Ext.each(f,function(c){g=d[c];Ext.each(g.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){a=!0}else if(d.crudState=='U'){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(Ext.isEmpty(d.modified[e])&&Ext.isEmpty(d.data[e])){}else {if(e!=b.model.idProperty&&d.data[e]!=d.modified[e]){if(d.data[e]==null&&d.modified[e]=='undefined'){}else {a=!0;return !1}}}})}}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(e){if(!Ext.isEmpty(d.data[e])){a=!0;return !1}});if(a){a=!0}}}if(a){return !1}});if(a){return !1}});if(a){return !0}}},checkPanelsModified:function(c){var d=this,b,a;Ext.each(c,function(e){b=Ext.getCmp(e);store=Ext.getStore(b.store);a=d.checkModifieData(store,b);if(a){return !1}});if(a){return !0}else {Rs.Msg.messageAlert({title:'提示',message:'数据没有发生变化，不需要保存'});return !1}},integratedData:function(e,c){var a=this,f={},b={},d={};a.comCode=typeof (USERINFO)=='undefined'?'':USERINFO.COMPANYCODE;a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTCODE,a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.ACCTNAME;if(Ext.isEmpty(a.userCode)){a.userCode=typeof (USERINFO)=='undefined'?'':USERINFO.USERCODE;a.userName=typeof (USERINFO)=='undefined'?'':USERINFO.USERNAME}if(!Ext.isEmpty(a.personCodeField)||!Ext.isEmpty(a.personNameField)){Ext.each(c.model.getFields(),function(b){if(b.name=='COM_CODE'){a.comFlag=!0}if(b.name==a.personCodeField){a.personFlag=!0}})}else {Ext.each(c.model.getFields(),function(b){if(b.name=='COM_CODE'){a.comFlag=!0}if(b.name=='UPD_CODE'){a.updFlag=!0}})}if(c.isDynamicStore||c.isCachedStore){d=a.getAllModifiedRecordsData(c);b.newRecords=d.newRecords;b.deleteRecords=d.deleteRecords;b.updateRecords=d.updateRecords;b.justMode=d.justMode}else {b.newRecords=this.getNewRecordsData(c);b.deleteRecords=this.getDeleteRecordsData(c);b.updateRecords=this.getUpdateRecordsData(c);b.justMode=this.getJustModeRecordsData(c)}f.gridCode=e;f.panelData=b;if(!Ext.isEmpty(Ext.getCmp(e).relationGridPanelId)||!Ext.isEmpty(Ext.getCmp(e).moreRelationGridObj)){f.relationData=a.dealRelationData(Ext.getCmp(e))}return f},dealRelationData:function(a){var e={},b={};if(!Ext.isEmpty(a.relationGridPanelId)){if(a.isArrayItemObj(a.relationGridQueryFieldArray)){b[a.relationGridPanelId]=a.relationGridQueryFieldArray}else {var c={},d=[];Ext.each(a.relationGridQueryFieldArray,function(b){c.upField=b;c.downField=b;d.push(c)});b[a.relationGridPanelId]=d}}if(!Ext.isEmpty(a.moreRelationGridObj)){Ext.each(Ext.Object.getValues(a.moreRelationGridObj),function(c){if(a.isArrayItemObj(c.relationGridQueryFieldArray)){b[c.relationGridPanelId]=c.relationGridQueryFieldArray}else {var d={},e=[];Ext.each(c.relationGridQueryFieldArray,function(b){d.upField=b;d.downField=b;e.push(d)});b[c.relationGridPanelId]=e}})}return b},getNewRecordsData:function(f){var a=this,e=f.getNewRecords(),c={},d,b=new Array();Ext.each(e,function(c){if(c.dirty){modifieds=Object.keys(c.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(c.data[a])){d=!0;return !1}});if(d){if(a.comFlag){c.data.COM_CODE=a.comCode}if(a.updFlag){c.data.UPD_CODE=a.userCode;c.data.UPD_NAME=a.userName}if(a.personFlag){c.data[a.personCodeField]=a.userCode;c.data[a.personNameField]=a.userName}b.push(c.data)}}});c.recordData=b;return c},getDeleteRecordsData:function(c){var d=this,b={},a=new Array();c.each(function(b){if(b.deleteFlag=='D'){a.push(b.data)}});b.recordData=a;return b},getJustModeRecordsData:function(e){var f=this,d=e.getUpdatedRecords(),a={},c,b=new Array();Ext.each(d,function(a){c=Object.keys(a.modified);if(c.length==1&&a.data.CHE_FLAG=='Y'){b.push(a.data)}});a.recordData=b;return a},getUpdateRecordsData:function(e){var a=this,h=e.getUpdatedRecords(),c={},d,g=new Array(),b={},f=new Array();Ext.each(h,function(c){d=Object.keys(c.modified);b={};if(d.length==1&&c.data.CHE_FLAG=='Y'){}else {Ext.each(d,function(a){if(Ext.isEmpty(c.modified[a])&&Ext.isEmpty(c.data[a])){}else {b[a]=c.data[a]}})}if(!Ext.Object.isEmpty(b)){b[e.model.idProperty]=c.data[e.model.idProperty];if(a.updFlag){c.data.UPD_CODE=a.userCode;c.data.UPD_NAME=a.userName;b.UPD_CODE=a.userCode;b.UPD_NAME=a.userName}if(a.personFlag){c.data[a.personCodeField]=a.userCode;c.data[a.personNameField]=a.userName;b[a.personCodeField]=a.userCode;b[a.personNameField]=a.userName}g.push(b);f.push(c.data)}});c.modifieds=g;c.recordData=f;return c},getAllModifiedRecordsData:function(b){var a=this,h,i,v,u,o,t,f={},n=!1,c={},e={},r={},q={},p={},g={},s={},d={},k=new Array(),l=new Array(),m=new Array(),j=new Array();justModeRecordData=new Array();if(b.isCachedStore){h=b.noRelationStaticDataObj}else {h=b.cachedStore.noRelationStaticDataObj}u=Object.keys(h);if(!Ext.Object.isEmpty(h)){Ext.each(u,function(c){pageData=h[c];if(c==b.currentPage){r=a.getNewRecordsData(b);p=a.getDeleteRecordsData(b);q=a.getUpdateRecordsData(b);s=a.getJustModeRecordsData(b)}else {Ext.each(pageData,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){j.push(d.data)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};if(fiedNameS.length==1&&d.data.CHE_FLAG=='Y'){justModeRecordData.push(d.data)}else {Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}l.push(modifiedData);m.push(d.data)}}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){n=!0;return !1}});if(n){if(a.comFlag){d.data.COM_CODE=a.comCode}if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName}k.push(d.data)}}}})}});c.modifieds=l;c.recordData=m;e.recordData=j;g.recordData=justModeRecordData;f.recordData=k;c=Ext.Object.merge(c,q),g=Ext.Object.merge(g,s),e=Ext.Object.merge(e,p),f=Ext.Object.merge(f,r),d.newRecords=f;d.deleteRecords=e;d.updateRecords=c;d.justMode=g;return d}else {if(b.isCachedStore){i=b.relationStaticDataArry}else {i=b.cachedStore.relationStaticDataArry}t=Object.keys(i);Ext.each(t,function(c){o=i[c];Ext.each(o.cachedPageData.data,function(d){if(d.crudState=='R'&&d.deleteFlag!='D'){}else if(d.deleteFlag=='D'){j.push(d.data)}else if(d.crudState=='U'){fiedNameS=Object.keys(d.modified);modifiedData={};if(fiedNameS.length==1&&d.data.CHE_FLAG=='Y'){justModeRecordData.push(d.data)}else {Ext.each(fiedNameS,function(a){modifiedData[a]=d.data[a]});modifiedData[b.model.idProperty]=d.data[b.model.idProperty];if(a.updFlag){d.data.UPD_CODE=a.userCode;d.data.UPD_NAME=a.userName;modifiedData.UPD_CODE=a.userCode;modifiedData.UPD_NAME=a.userName}if(a.personFlag){d.data[a.personCodeField]=a.userCode;d.data[a.personNameField]=a.userName;modifiedData[a.personCodeField]=a.userCode;modifiedData[a.personNameField]=a.userName}l.push(modifiedData);m.push(d.data)}}if(d.phantom){if(!Ext.isEmpty(d.modified)){modifieds=Object.keys(d.modified);Ext.each(modifieds,function(a){if(!Ext.isEmpty(d.data[a])){n=!0;return !1}});if(n){var e=d.data;e.FUU_ID=o.queryRecord.id;if(a.comFlag){e.COM_CODE=a.comCode}if(a.updFlag){e.UPD_CODE=a.userCode;e.UPD_NAME=a.userName}if(a.personFlag){e[a.personCodeField]=a.userCode;e[a.personNameField]=a.userName}k.push(e)}}}})});c.modifieds=l;c.recordData=m;e.recordData=j;f.recordData=k;g.recordData=justModeRecordData;c=Ext.Object.merge(c,q),e=Ext.Object.merge(e,p),f=Ext.Object.merge(f,r),g=Ext.Object.merge(g,s),d.newRecords=f;d.deleteRecords=e;d.updateRecords=c;d.justMode=g;return d}},doExecuteAction:function(d){var a=this,e=a.url,b=!1,c={},f;token=typeof (TOKEN)=='undefined'?'':TOKEN;Ext.Ajax.request({url:e,async:!1,headers:{Authorization:token},jsonData:JSON.stringify(d),method:'POST',dataType:"json",success:function(e,g){var f=Ext.decode(e.responseText);c.responseData=f;if(f.success){if(!Ext.isEmpty(a.executeSuccess)){b=a.executeSuccess(a,e)}else {b=!1}}else {if(!Ext.isEmpty(a.executeFailures)){a.executeFailures(a,e)}else {Rs.Msg.messageAlert({title:'提示',message:f.data,buttons:Ext.MessageBox.OK})}b=!0}},failure:function(c,f){var e=Ext.decode(c.responseText);if(!Ext.isEmpty(a.executeFailures)){b=a.executeFailures(a,c)}else {Rs.Marker.mark(e.data)}b=!0}});c.errorFlag=b;return c},checkDatas:function(){var e=this,a=new Array(),b,d={},c;window.RsPanelErrorMsg=[];Ext.each(e.panelIds,function(d){c=Ext.getCmp(d);Rs.Marker.unmark(c);b=e.checkPanelData(c);if(!Ext.isEmpty(b)&&b.success==!1){a.push(b)}});if(!Ext.isEmpty(a)){d.panelData=a;window.RsPanelErrorMsg=a;Rs.Marker.mark(a)}if(!Ext.Object.isEmpty(d)){return !1}else {return !0}},checkPanelData:function(d){var i=this,g=d.plugins,a,h=new Array(),b={},e=new Array(),c=new Array(),f=new Array();Ext.each(g,function(a){if("griddatamustinput"==a.ptype||'griddatacheckrepeat'==a.ptype||'sumCompare'==a.ptype||'formulaPlu'==a.ptype){f.push(a)}},this);Ext.each(f,function(f){a={};if("griddatamustinput"==f.ptype){a=f.checkMustInput(d)}else if("griddatacheckrepeat"==f.ptype){a=f.checkRepeat(d)}else if("sumCompare"==f.ptype){a=f.headDetailSumCompareControl()}else if("formulaPlu"==f.ptype){a=f.formulaPlu()}if(!Ext.isEmpty(a)&&a.success==!1){h.push(a);Ext.each(errArr,function(a){c.push(a)});e.push(a.errorMsg);b.panelId=a.panelID}},this);if(c.length>0){b.success=!1}else {b.success=!0}b.errArr=c;b.errorMsg=e;return b},initAddPlugins:function(){var a=this;Ext.each(a.panelIds,function(b){panel=Ext.getCmp(b.toString());if(!Ext.isEmpty(panel)&&panel.isXType('grid')){a.addControlPlugins(panel)}})},addControlPlugins:function(e){var c=this,d=e.plugins,a,b=new Array();Ext.each(d,function(c){if("fieldscompare"==c.ptype||"statecontrolf"==c.ptype||"relatestatecontrolf"==c.ptype||"fielddiffentcontrolf"==c.ptype||"fieldsamecontrolf"==c.ptype||"fieldsdifferentb"==c.ptype||"fieldsamecontrolb"==c.ptype||"calculateassign"==c.ptype||"headdetailcalculate"==c.ptype){b.push(c)}if("cellediting"===c.ptype){a=c}if("rowediting"===c.ptype){a=c}},this);if(!Ext.isEmpty(a)){a.on('edit',function(d,a){c.doControPlugis(b,a)},c);a.on('beforeedit',function(d,c){var a=!0;Ext.each(b,function(b){a=!0;if("statecontrolf"==b.ptype){a=b.gridStateControl(d,c.record,c.field)}if("relatestatecontrolf"==b.ptype){a=b.relateStateControl(d,c.record,c.field)}if(!a){return !1}});if(!a){return !1}},c)}},doControPlugis:function(c,b){var a=!0;Ext.each(c,function(d){a=!0;if("fieldscompare"==d.ptype){a=d.gridCompareControl(b)}if("fielddiffentcontrolf"==d.ptype){a=d.gridAttributeUnsame(b)}if("fieldsamecontrolf"==d.ptype){a=d.gridAttributeSame(b)}if("fieldsdifferentb"==d.ptype){a=d.gridFieldsDifferentControlB(b)}if("fieldsamecontrolb"==d.ptype){a=d.singleGridFunction('',b.record,b.field,b.rowIdx)}if("calculateassign"==d.ptype){a=d.gridCalculate(b)}if("headdetailcalculate"==d.ptype){a=d.headCalculate(b)}if(!a){return !1}});if(!a){return !1}},replaceIdToal:function(c,b){var a=this;Ext.each(c.panels,function(i){var e=i.gridCode;var h=Ext.getCmp(e);var g=h.getStore();if(!Ext.isEmpty(a.needReplaceFields)){if(!Ext.isEmpty(a.needReplaceFields[e])){var d=a.needReplaceFields[e];d=d.substr(1);d=d.substring(0,d.length-1);var f=d.split(',')}else {var f=null}}else {var f=null}if(g.isDynamicStore||g.isCachedStore){a.replaceIdC(g,b.data[e],f)}else {a.replaceIdN(g,b.data[e],f)}})},replaceIdN:function(a,c,b){a.each(function(d){if(d.deleteFlag=='D'){a.remove(d)}});Ext.each(c,function(d){var e=Ext.Object.getKeys(d);var f=a.getById(e);f.set(a.model.idProperty,d[e][a.model.idProperty]);Ext.each(b,function(g){if(!Ext.isEmpty(d[e][g])){f.set(g,d[e][g])}});f.id=d[e][a.model.idProperty]});a.commitChanges()},replaceIdC:function(a,b,h){var c,g,i,d,e,f;if(a.isCachedStore){c=a.noRelationStaticDataObj}else {c=a.cachedStore.noRelationStaticDataObj}g=Object.keys(c);if(!Ext.Object.isEmpty(c)){Ext.each(g,function(d){i=c[d];Ext.each(i,function(c){if(c.deleteFlag=='D'){a.remove(c)}if(Ext.isEmpty(b)){return}if(c.phantom){if(!Ext.isEmpty(c.data[a.model.idProperty])){if(!Ext.isEmpty(c.get('HUU_ID'))){c.set('HUU_ID',b[c.id].HUU_ID)}Ext.each(h,function(e){if(!Ext.isEmpty(b[c.id][e])){c.set(e,b[c.id][e])}});c.set(a.model.idProperty,b[c.id].UU_ID);c.id=c.data[a.model.idProperty]}}})})}else {if(a.isCachedStore){d=a.relationStaticDataArry}else {d=a.cachedStore.relationStaticDataArry}e=Object.keys(d);Ext.each(e,function(c){f=d[c];Ext.each(f.cachedPageData.data,function(d){if(d.deleteFlag=='D'){a.remove(d)}if(Ext.isEmpty(b)){return}if(d.phantom){if(!Ext.isEmpty(d.data[a.model.idProperty])){if(!Ext.isEmpty(d.get('HUU_ID'))){d.set('HUU_ID',b[d.id].HUU_ID)}Ext.each(h,function(e){if(!Ext.isEmpty(b[d.id][e])){d.set(e,b[d.id][e])}});d.set(a.model.idProperty,b[d.id].UU_ID);d.id=d.data[a.model.idProperty]}}})})}a.commitChanges()}});Ext.define('Rs.ext.grid.plugin.StateControlF',{extend:'Ext.plugin.Abstract',alias:'plugin.statecontrolf',configs:{itemIds:'',panelId:'',checkFields:'',targetValues:'',controlRule:'',allRowEnable:!1,erroCode:''},init:function(b){var a=this,d,c=b.getPlugins();if(b.isXType('grid')){a.gridFunction(c,d)}else {a.grid=b;a.grid.on('afterrender',function(g,h){var c=new Array();c=a.itemIds.split(",");var e=new Array();e=a.checkFields.split(",");var d=new Array();d=a.targetValues.split(",");var f=new Array();f=a.controlRule.split(",");if(c.length!=e.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(d.length!=f.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(c.length!=d.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}for(j=0;j<c.length;j++){a.panelFunction(c[j],a.panelId,e[j],d[j],f[j])}})}},panelFunction:function(a,g,f,e,b){var h=this;var d=Ext.getCmp(f).getValue().toString();var c=e.toString();if(b=='>'){if(d>c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<'){if(d<c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='>='){if(d>=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<='){if(d<=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='='){if(d==c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else if(b=='<>'||b=='!='){if(d!=c){Ext.getCmp(a).setReadOnly(!0)}else {Ext.getCmp(a).setReadOnly(!1)}}else {Ext.Msg.alert('提示','控制规则配置错误')}},gridStateControl:function(p,n,o){var c=this;var b=!1;var l=new Array();l=c.itemIds.split(",");var m=new Array();m=o.split(",");var f=new Array();f=c.checkFields.split(",");var g=new Array();g=c.targetValues.split(",");var h=new Array();h=c.controlRule.split(",");if(g.length!=f.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}if(g.length!=h.length){Ext.Msg.alert('提示','控制规则配置错误');return !1}var k=!1;if(c.allRowEnable){k=!0}else {for(j=0;j<l.length;j++){for(i=0;i<m.length;i++){if(m[i]==l[j]){k=!0}}}}if(k){for(j=0;j<f.length;j++){if(Ext.isEmpty(n.get(f[j]))){return !0}var e=n.get(f[j]).toString();var d=g[j].toString();var a=h[j];if(a=='>'){if(e>d){b=!0}}else if(a=='<'){if(e<d){b=!0}}else if(a=='>='){if(e>=d){b=!0}}else if(a=='<='){if(e<=d){b=!0}}else if(a=='='){if(e==d){b=!0}}else if(a=='<>'||a=='!='){if(e!=d){b=!0}}else {Ext.Msg.alert('提示','控制规则配置错误')}}}if(b){if(!Ext.isEmpty(c.erroCode)){Rs.Msg.messageAlert({stateCode:c.erroCode})}return !1}else {return !0}},gridFunction:function(a,b){}});Ext.define('Rs.ext.telescope.store.TeleStore',function(){return {extend:'Ext.data.Store',proxy:{type:'ajax',url:'/base/telescope/read',reader:{type:'json',rootProperty:'data.list',totalProperty:'data.total'}}}});Ext.define('Rs.ext.telescope.model.Base',{extend:'Ext.data.Model',schema:{namespace:'Rs.ext.telescope.model'}});Ext.define('Rs.ext.telescope.model.Head',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'prog_code',mapping:'progCode',type:'string'},{name:'prog_name',mapping:'progName',type:'string'}]});Ext.define('Rs.ext.telescope.model.Detail',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'seq_no',mapping:'seqNo',type:'int'},{name:'prog_code',mapping:'progCode',type:'string'},{name:'field_name',mapping:'fieldName',type:'string'},{name:'is_hidden',mapping:'isHidden',type:'string'},{name:'desc_zh',mapping:'descZh',type:'string'},{name:'desc_en',mapping:'descEn',type:'string'}]});Ext.define('Rs.ext.telescope.model.Criteria',{extend:'Rs.ext.telescope.model.Base',fields:[{name:'seq_no',mapping:'seqNo',type:'int'},{name:'prog_code',mapping:'progCode',type:'string'},{name:'field_name',mapping:'fieldName',type:'string'},{name:'desc_zh',mapping:'descZh',type:'string'},{name:'desc_en',mapping:'descEn',type:'string'}]});Ext.define('Rs.ext.telescope.model.Meta',{extend:'Rs.ext.telescope.model.Base',requires:['Rs.ext.telescope.model.Head','Rs.ext.telescope.model.Detail','Rs.ext.telescope.model.Criteria'],fields:[{name:'prog_code',mapping:'progCode',type:'string'}],hasOne:['Head'],hasMany:['Detail','Criteria']});Ext.define('Rs.ext.telescope.store.TeleMetaStore',function(){return {extend:'Ext.data.Store',model:'Rs.ext.telescope.model.Meta',proxy:{type:'ajax',url:'/base/telescope/meta',reader:{type:'json',rootProperty:'data'}}}});Ext.define('Rs.ext.telescope.view.TelescopeForm',{extend:'Ext.form.Panel',layout:'column',defaults:{margin:4,minWidth:100},mixins:['Ext.util.StoreHolder'],bodyPadding:4,collapsible:!0,titleCollapse:!0,onSpecialkey:function(b,a){console.log('onEnterKey',this,b);var c=this;if(a.getKey()==a.ENTER){c.doQuery()}},dockedItems:[{xtype:'toolbar',dock:'bottom',items:[{xtype:'tbfill'},{xtype:'button',itemId:'reset',text:'重置'},'-',{xtype:'button',itemId:'query',text:'查询'}]}],initComponent:function(){this.callParent(arguments);var a=this,b=a.getDockedItems('toolbar')[0],d=b.child('#reset'),c=b.child('#query');d.handler=a.reset.bind(a,d);c.handler=a.doQuery.bind(a,c)},setFields:function(b){var a=this;a.suspendLayout=!0;a.removeAll();var c=a.getDockedItems('toolbar')[0];if(Ext.isArray(b)&&b.length){Ext.each(b,function(c,d){b[d]=c=Ext.create(Ext.apply(c,{xtype:'textfield',columnWidth:0.25}));a.mon(c,'specialkey',a.onSpecialkey,a)});c.show()}else {c.hide()}a.suspendLayout=!1;this.add(b)},doQuery:function(d){var a=this,c=a.getStore(),b=a.getValues();a.fireEvent('query',b);c.loadPage(1)}});Ext.define('Rs.ext.telescope.view.TelescopeGrid',{extend:'Ext.grid.Panel',forceFit:!0,dockedItems:[{xtype:'pagingtoolbar',displayInfo:!1,dock:'bottom',items:[{xtype:'tbfill'},{xtype:'button',itemId:'clear',text:'清空'},'-',{xtype:'button',itemId:'close',text:'关闭'},'-',{xtype:'button',itemId:'ok',text:'确定'}]}]});Ext.define('Rs.ext.telescope.view.TelescopePanel',{extend:'Ext.container.Container',xtype:'rs-telescope-panel',requires:['Rs.ext.telescope.store.TeleStore','Rs.ext.telescope.store.TeleMetaStore','Rs.ext.telescope.view.TelescopeForm','Rs.ext.telescope.view.TelescopeGrid'],mixins:['Ext.util.StoreHolder'],minHeight:240,minWidth:380,height:320,width:480,resizable:{pinned:!0,handles:'nw se'},layout:'border',config:{progCode:'',gridConfig:{}},privates:{conditions:''},setConditions:function(a){var b=this;b.conditions=a},createStore:function(c){var d=this,a,b=[];c.each(function(d){var a=d.get('field_name'),e=a.split('.').pop();b.push({name:a,mapping:e.toUpperCase()})});a=Ext.create('Rs.ext.telescope.store.TeleStore',{fields:b});d.setStore(a);return a},createColumns:function(b){var c=this,a=[];b.each(function(c){a.push({minWidth:100,text:c.get('desc_zh'),dataIndex:c.get('field_name'),hidden:c.get('is_hidden')=='Y'})});a=c.initColumns(a);return a},initColumns:function(a){var b=this;a=[].concat(b.mergeColumns(a)||[]);b.afterMergeColumns(a);return a},mergeColumns:function(d){var e=this,a=[],c={},b=e.gridConfig||{};if(Ext.isArray(b.columns)){Ext.each(d,function(a){c[a.dataIndex]=a});Ext.each(b.columns,function(b){var e=b.dataIndex;a.push(Ext.apply(c[e],b))})}else {a=d}console.log(a.length,'columns===>',a);return a},afterMergeColumns:function(b){var c=this,a=[];Ext.each(b,function(c){var d=c.dataIndex;if(!c.hidden&&d){a.push(d)}});console.log('displayCols:',a);c.displayColumns=a},createFields:function(b){var c=this,a=[];b.each(function(d){var e=c.handlerSpecialKey(d.get('field_name'));a.push({name:e,emptyText:d.get('desc_zh')})});return a},handlerSpecialKey:function(a){var b=' AS ',c=a.toUpperCase().lastIndexOf(b);if(c!=-1){a=a.substring(c+b.length)}return a.trim()},createSelModel:function(){var b=this,a=b.multiSelect?{mode:'MULTI',checkOnly:!1,selType:'checkboxmodel'}:{mode:'SINGLE',selType:'rowmodel'};console.log('multiSelect====>',a);return a},createGrid:function(e,d){var b=this,c=b.createSelModel();var a=Ext.create('Rs.ext.telescope.view.TelescopeGrid',{store:e,columns:d,region:'center',selModel:c});b.initGrid(a);return a},initGrid:function(f){var a=this,b=f.getDockedItems('pagingtoolbar')[0],c=b.child('#ok'),d=b.child('#clear'),e=b.child('#close');c.setHidden(a.multiSelect?!1:!0);a.relayEvents(c,['click'],'pagingtbar-ok-');a.relayEvents(d,['click'],'pagingtbar-clear-');a.relayEvents(e,['click'],'pagingtbar-close-')},createForm:function(c,b){var d=this,a=Ext.create('Rs.ext.telescope.view.TelescopeForm',{region:'north',animCollapse:!1});a.setStore(c);a.setFields(b);a=d.initForm(a);return a},initForm:function(a){var b=this;a.on('query',b.onFormQuery,b);return a},onFormQuery:function(b){var c=this,a=[];Ext.iterate(b,function(d,c){if(!Ext.isEmpty(c)){a.push(d+" like '"+c+"%'")}});c.setConditions(a.join(' and '))},resetForm:function(){var a=this;a.form.reset()},initComponent:function(){this.callParent(arguments);var a=this,b=a.progCode;var c=a.meta=Ext.create('Rs.ext.telescope.store.TeleMetaStore',{prog_code:b});c.load({params:{prog_code:b},callback:function(l){var h=c.first();var b,j,e;var f=h.details();if(!Ext.isEmpty(f)){b=a.createStore(f);j=a.createColumns(f);e=a.createGrid(b,j);a.relayEvents(b,['load'],'store-');a.relayEvents(e,['deselect','beforeselect','select'],'grid-')}var d,g,k=h.getHead(),i=h.criterias();if(!Ext.isEmpty(i)){g=a.createFields(i)}console.log('fields:',g);d=a.createForm(b,g);if(!Ext.isEmpty(k)){d.setTitle(k.get('prog_name')||'')}a.grid=e;a.form=d;a.add([e,d]);b.loadPage(1);a.show()}})},refresh:function(){var b=this,a=b.getStore();if(a&&!a.isLoading()){a.loadPage(1)}},getStoreListeners:function(b){var a=this;return {beforeload:a.onBeforeload}},onBeforeload:function(e,c){var b=this,a=b.conditions,d=c.getParams();a=Ext.valueFrom(a,' 1 = 1 ');a=b.buildProgCondtion(a);c.setParams(Ext.apply({},{prog_code:b.progCode,prog_condition:a},d))},buildProgCondtion:Ext.identityFn});Ext.define('Rs.ext.telescope.Telescope',{extend:'Ext.form.field.Picker',alias:'widget.telescope',requires:['Rs.ext.telescope.view.TelescopePanel'],isTelescope:!0,matchFieldWidth:!1,config:{progCode:null,buildProgCondtion:Ext.identityFn,displayField:'',valueField:'',multiSelect:!1,separator:',',gridConfig:{},panelConfig:{},forceSelection:!0,recordPreSelection:!1,autoBackfill:!1},selection:[],previousValue:[],internelId:'telescope-model-id',setSelection:function(b){var c=this,a=[];Ext.each(b,function(c){c.isModel&&a.push(c)});c.selection=a},getSelection:function(){var a=this;return a.selection},initComponent:function(){var a=this;a.callParent();a.doQueryTask=new Ext.util.DelayedTask(a.doRawQuery,a);a.cached=Ext.create('Ext.util.Collection',{keyFn:function(b){return b[a.internelId]}})},setValue:function(a,g){var b=this,e=[],d=[],c=[],f=b.separator;if(Ext.isArray(a)){var h=a;Ext.each(h,function(f){if(Ext.isObject(f)&&f.isModel){c.push(f)}f=b.doBeforeSetValue(f);e.push(f[0]);d.push(f[1])});b.setSelection(c);b.callParent([e.join(f)]);b.setRawValue(d.join(f))}else {a=Ext.isEmpty(a)?[]:[a];return b.setValue(a,g)}b.previousValue=a},doBeforeSetValue:function(a){var b=this;if(Ext.isObject(a)&&a.isModel){var d=b.valueField,c=b.displayField;return [a.get(d),a.get(c)]}else {return [a,a]}},getValue:function(){var a=this;return a.value},onFocusLeave:function(d){var a=this,c=a.getValue(),b=a.getRawValue();a.doQueryTask.cancel();if(a.mutated){if(a.forceSelection){a.setValue(a.previousValue)}else {a.setValue(b)}a.mutated=!1}if(Ext.isEmpty(b)&&!Ext.isEmpty(c)){a.setValue(b)}a.callParent(arguments)},createPicker:function(){var a=this,b;b=Ext.create(Ext.apply({id:a.id+'-picker',hidden:!0,floating:!0},{xtype:'rs-telescope-panel',pickerField:a,progCode:a.progCode,gridConfig:a.gridConfig,multiSelect:a.multiSelect,buildProgCondtion:a.buildProgCondtion.bind(a)},a.panelConfig));b.on({scope:a,'grid-select':a.onSelect,'grid-deselect':a.onDeselect,'store-load':a.onStoreLoad,'pagingtbar-ok-click':a.onOk,'pagingtbar-clear-click':a.onClear,'pagingtbar-close-click':a.onClose});if(!a.multiSelect){b.on('grid-select',a.onSingleSelect,a)}return b},identifier:function(c){var d=this,b=d.picker,a=[];Ext.each(b.displayColumns,function(b){a.push(c.get(b))});return a.join()},onSelect:function(e,a){var b=this,c=b.cached,d=b.identifier(a);if(!c.containsKey(d)){a[b.internelId]=d;c.add(a)}},onDeselect:function(e,a){var b=this,c=b.cached,d=b.identifier(a);if(c.containsKey(d)){a[b.internelId]=d;c.remove(a)}},onOk:function(){var a=this,c=a.cached,b=c.getRange();if(a.fireEvent('ok',a,b)!=!1){a.setValue(b,!0);a.collapse()}},onClear:function(){var a=this;a.setValue([],!0);a.cached.removeAll();a.highlightSelection([]);if(!a.forceSelection){a.focus()}a.fireEvent('clear',a)},onClose:function(){var a=this;if(a.fireEvent('close',a)!=!1){a.collapse()}},onStoreLoad:function(f,c){var a=this,b=[],e=a.cached,d=a.getRawValue();if(a.recordPreSelection){Ext.each(c,function(d){var g=a.identifier(d);if(e.containsKey(g)){d[a.internelId]=g;b.push(d)}});if(!Ext.isEmpty(b)){a.syncSelection(b);a.highlightSelection(b)}}if(a.autoBackfill&&!a.multiSelect&&a.forceSelection){if(c&&c.length==1){if(!a.expandFromTrigger&&!Ext.isEmpty(d)){a.setValue(f.first(),!0);a.collapse()}}}},syncSelection:function(c){var b=this,a=b.cached;a.add(c);b.setSelection(a.getRange())},highlightSelection:function(b){var c=this,a=c.picker.grid;if(Ext.isEmpty(b)){b=!1}if(a&&a.rendered){a.suspendEvent('select','deselect');a.setSelection(b);a.resumeEvent('select','deselect')}},onSingleSelect:function(d,b){var a=this,e=a.valueField,c=a.displayField;if(a.fireEvent('beforeselect',a,b)!=!1){a.fireEvent('select',a,b,d);a.lastDisplayValue=b.get(c);a.setValue(b,!0);a.collapse()}},onCollapse:function(){var a=this;a.expandFromTrigger=!1;a.callParent(arguments);var b=a.picker;b.resetForm()},onExpand:function(){var a=this,c=a.cached,b=a.selection;c.removeAll().add(b);a.callParent(arguments)},onTriggerClick:function(){var b=this,a=b.picker;b.expandFromTrigger=!0;if(a){a.setConditions('');a.refresh()}b.callParent(arguments)},onFieldMutation:function(b){var a=this;a.callParent([b]);if(b.type=='keyup'){a.mutated=!0;if(!a.readOnly&&a.editable){a.doQueryTask.delay(500)}}},doRawQuery:function(){var a=this,b=a.getRawValue();a.doQuery(b,!1,!0)},doQuery:function(d){var a=this,b,g=a.valueField,f=a.displayField,c,e=[];a.expand();b=a.picker;if(!Ext.isEmpty(d)){Ext.each([g,f],function(a){e.push(a+" like '"+d+"%'")});c='('+e.join(' or ')+')'}b.setConditions(c);b.refresh()}});Ext.define('Rs.ext.toolbar.FormPaging',{extend:'Ext.toolbar.Toolbar',xtype:'formpagingtoolbar',alternateClassName:'Ext.FormPagingToolbar',requires:['Ext.toolbar.TextItem'],displayInfo:!0,prependButtons:!0,initComponent:function(){var a=this,c=a.items||a.buttons||[],b;b=a.getPagingItems();if(a.prependButtons){a.items=c.concat(b)}else {a.items=b.concat(c)}a.callParent()},getPagingItems:function(){var a=this,b={scope:a,blur:a.onPagingBlur};b[Ext.supports.SpecialKeyDownRepeat?'keydown':'keypress']=a.onPagingKeyDown;return ['->',{itemId:'prev',iconCls:Ext.baseCSSPrefix+'tbar-page-prev',disabled:!1,handler:a.movePrevious,scope:a},{disabled:!0,width:30},{itemId:'next',iconCls:Ext.baseCSSPrefix+'tbar-page-next',disabled:!1,handler:a.moveNext,scope:a},{disabled:!0,width:50},{itemId:'add',iconCls:'addAction-button-item',disabled:!1,handler:a.addRecord,scope:a},{disabled:!0,width:50},{itemId:'delete',iconCls:'deleteAction1-button-item',disabled:!1,handler:a.removeRecord,scope:a},{disabled:!0,width:50}]},addRecord:function(){var b=this,a=b.up();a.addNewRecord()},removeRecord:function(){var b=this,a=b.up();a.removeRecord()},movePrevious:function(){var d=this,a=d.up();if(a.page===0||Ext.isEmpty(a.page)){return !1}a.page=a.page-1;var c=a.items.items;Ext.each(c,function(a){a.setValue()});var b=Ext.getStore(a.store).data.items[a.page];if(Ext.isEmpty(b)){a.page+=1;return !1}a.loadRecord(b)},moveNext:function(){var d=this,a=d.up();if(Ext.isEmpty(a.page)||Ext.getStore(a.store).data.length===0||a.page===Ext.getStore(a.store).data.length-1){return !1}a.page=a.page+1;var b=Ext.getStore(a.store).data.items[a.page];var c=a.items.items;Ext.each(c,function(a){a.setValue()});a.loadRecord(b)}});Ext.define('Rs.ext.toolbar.Paging',{extend:'Ext.toolbar.Paging',xtype:'rs-pagingtoolbar',displayInfo:!0,prependButtons:!0,initComponent:function(){var a,c=this;c.callParent();if(c.displayInfo){var b=c.items;b.eachKey(function(d,c){if(d=='displayItem'){b.removeAll([a,c]);b.insert(0,[c,a]);return !1}a=c})}},getPagingItems:function(){var b=this,a=b.callParent();a.unshift('->');return a.slice(0,-2)}});